<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 6: stringr and RegExes – Toolbox CSS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c09f7992e7ad36c4a4c784d127ab2153.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="site_libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="site_libs/str_view-binding-1.5.1/str_view.js"></script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Toolbox CSS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href="./lectures-overview.html">
 <span class="dropdown-text">Overview – week by week</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lectures-week_1.html">
 <span class="dropdown-text">Week 1: What Is Computational Social Science (CSS)?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-script" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">R Script</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r-script">    
        <li>
    <a class="dropdown-item" href="./1_r_index.html">
 <span class="dropdown-text">Chapter 1: Preface</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./2_r_catch-up.html">
 <span class="dropdown-text">Chapter 2: Brief R Recap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./3_reticulate.html">
 <span class="dropdown-text">Chapter 3: <code>reticulate</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./4_python.html">
 <span class="dropdown-text">Chapter 4: Introduction to Python for R Users</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./5_pandas.html">
 <span class="dropdown-text">Chapter 5: <code>pandas</code></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./6_stringr_regex.html">
 <span class="dropdown-text">Chapter 6: <code>stringr</code> and RegExes</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#basic-manipulations" id="toc-basic-manipulations" class="nav-link active" data-scroll-target="#basic-manipulations">Basic manipulations</a>
  <ul class="collapse">
  <li><a href="#changing-the-case-of-the-words" id="toc-changing-the-case-of-the-words" class="nav-link" data-scroll-target="#changing-the-case-of-the-words">Changing the case of the words</a></li>
  <li><a href="#determining-a-strings-length" id="toc-determining-a-strings-length" class="nav-link" data-scroll-target="#determining-a-strings-length">Determining a string’s length</a></li>
  <li><a href="#extracting-particular-characters" id="toc-extracting-particular-characters" class="nav-link" data-scroll-target="#extracting-particular-characters">Extracting particular characters</a></li>
  <li><a href="#concatenating-strings" id="toc-concatenating-strings" class="nav-link" data-scroll-target="#concatenating-strings">Concatenating strings</a></li>
  <li><a href="#repetition" id="toc-repetition" class="nav-link" data-scroll-target="#repetition">Repetition</a></li>
  <li><a href="#removing-unnecessary-whitespaces" id="toc-removing-unnecessary-whitespaces" class="nav-link" data-scroll-target="#removing-unnecessary-whitespaces">Removing unnecessary whitespaces</a></li>
  <li><a href="#further-links" id="toc-further-links" class="nav-link" data-scroll-target="#further-links">Further links</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#regular-expressions" id="toc-regular-expressions" class="nav-link" data-scroll-target="#regular-expressions">Regular expressions</a>
  <ul class="collapse">
  <li><a href="#literal-characters" id="toc-literal-characters" class="nav-link" data-scroll-target="#literal-characters">Literal characters</a></li>
  <li><a href="#metacharacters" id="toc-metacharacters" class="nav-link" data-scroll-target="#metacharacters">Metacharacters</a></li>
  <li><a href="#sets-of-characters" id="toc-sets-of-characters" class="nav-link" data-scroll-target="#sets-of-characters">Sets of characters</a></li>
  <li><a href="#anchors" id="toc-anchors" class="nav-link" data-scroll-target="#anchors">Anchors</a></li>
  <li><a href="#further-links-1" id="toc-further-links-1" class="nav-link" data-scroll-target="#further-links-1">Further links</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">Exercises</a></li>
  </ul></li>
  <li><a href="#more-advanced-string-manipulation" id="toc-more-advanced-string-manipulation" class="nav-link" data-scroll-target="#more-advanced-string-manipulation">More advanced string manipulation</a>
  <ul class="collapse">
  <li><a href="#detect-matches" id="toc-detect-matches" class="nav-link" data-scroll-target="#detect-matches">Detect matches</a></li>
  <li><a href="#mutating-strings" id="toc-mutating-strings" class="nav-link" data-scroll-target="#mutating-strings">Mutating strings</a></li>
  <li><a href="#extracting-text" id="toc-extracting-text" class="nav-link" data-scroll-target="#extracting-text">Extracting text</a></li>
  <li><a href="#split-vectors" id="toc-split-vectors" class="nav-link" data-scroll-target="#split-vectors">Split vectors</a></li>
  <li><a href="#further-links-2" id="toc-further-links-2" class="nav-link" data-scroll-target="#further-links-2">Further links</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">Exercises</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 6: <code>stringr</code> and RegExes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(tidyverse, rvest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When working with data, a significant number of variables will be in some sort of text format. When you want to manipulate these variables, an easy approach would be exporting the data to MS Excel and then just performing those manipulations by hand. This is very time-consuming, though, and, hence, we rather recommend the R way which scales well and works fast for data sets of varying sizes.</p>
<p>Quick reminder: a string is an element of a character vector and can be created by simply wrapping some text in quotation marks:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>string <span class="ot">&lt;-</span> <span class="st">"Hi, how are you doing?"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>vector_of_strings <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Hi, how are you doing?"</span>, <span class="st">"I'm doing well, HBY?"</span>, <span class="st">"Me too, thanks for asking."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that you can either wrap your text in double quotation marks and use single ones in the string and vice versa:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>single_ones <span class="ot">&lt;-</span> <span class="st">"what's up"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>double_ones <span class="ot">&lt;-</span> <span class="st">'he said: "I am fine"'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>stringr</code> package <span class="citation" data-cites="wickham_stringr_2019">(<a href="#ref-wickham_stringr_2019" role="doc-biblioref">Wickham 2019</a>)</span> contains a multitude of commands (49 in total) that can be used to achieve a couple of things, mainly manipulating character vectors, and finding and matching patterns. These goals can also be achieved with base R functions, but <code>stringr</code>’s advantage is its consistency. The makers of <code>stringr</code> describe it as</p>
<blockquote class="blockquote">
<p>A consistent, simple and easy-to-use set of wrappers around the fantastic <code>stringi</code> package. All function and argument names (and positions) are consistent, all functions deal with <code>NA</code>’s and zero-length vectors in the same way, and the output from one function is easy to feed into the input of another.</p>
</blockquote>
<p>Every <code>stringr</code> function starts with <code>str_</code> – which facilitates finding the proper command: just type <code>str_</code> and RStudio’s auto-suggest function should take care of the rest (if it doesn’t pop up by itself, you can trigger it by hitting the tab key). Also, they take a vector of strings as their first argument, which facilitates using them in a <code>|&gt;</code>-pipeline and adding them to a <code>mutate()</code>-call.</p>
<p>One important component of <code>stringr</code> functions is regular expressions which will be introduced later as well.</p>
<section id="basic-manipulations" class="level2">
<h2 class="anchored" data-anchor-id="basic-manipulations">Basic manipulations</h2>
<p>In the following, we will introduce you to several different operations that can be performed on strings.</p>
<section id="changing-the-case-of-the-words" class="level3">
<h3 class="anchored" data-anchor-id="changing-the-case-of-the-words">Changing the case of the words</h3>
<p>A basic operation is changing words’ cases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_lower</span>(vector_of_strings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hi, how are you doing?"     "i'm doing well, hby?"      
[3] "me too, thanks for asking."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_upper</span>(vector_of_strings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "HI, HOW ARE YOU DOING?"     "I'M DOING WELL, HBY?"      
[3] "ME TOO, THANKS FOR ASKING."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_title</span>(vector_of_strings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hi, How Are You Doing?"     "I'm Doing Well, Hby?"      
[3] "Me Too, Thanks For Asking."</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_sentence</span>(vector_of_strings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hi, how are you doing?"     "I'm doing well, hby?"      
[3] "Me too, thanks for asking."</code></pre>
</div>
</div>
</section>
<section id="determining-a-strings-length" class="level3">
<h3 class="anchored" data-anchor-id="determining-a-strings-length">Determining a string’s length</h3>
<p>Determining the string’s number of characters goes as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(vector_of_strings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22 20 26</code></pre>
</div>
</div>
</section>
<section id="extracting-particular-characters" class="level3">
<h3 class="anchored" data-anchor-id="extracting-particular-characters">Extracting particular characters</h3>
<p>Characters can be extracted (by position) using <code>str_sub</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(vector_of_strings, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">5</span>) <span class="co"># extracting first to fifth character</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hi, h" "I'm d" "Me to"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(vector_of_strings, <span class="at">start =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="co"># extracting fifth-to-last to last character</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "oing?" " HBY?" "king."</code></pre>
</div>
</div>
<p>You can also use <code>str_sub()</code> to replace strings. E.g., to replace the last character by a full stop, you can do the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(vector_of_strings, <span class="at">start =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="ot">&lt;-</span> <span class="st">"."</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>vector_of_strings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hi, how are you doing."     "I'm doing well, HBY."      
[3] "Me too, thanks for asking."</code></pre>
</div>
</div>
<p>However, in everyday use, you would probably go with <code>str_replace()</code> and regular expressions.</p>
</section>
<section id="concatenating-strings" class="level3">
<h3 class="anchored" data-anchor-id="concatenating-strings">Concatenating strings</h3>
<p>Similar to how <code>c()</code> puts together different elements (or vectors of length 1) and other vectors into a single vector, <code>str_c()</code> can be used to concatenate several strings into a single string. This can, for instance, be used to write some birthday invitations.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Inger"</span>, <span class="st">"Peter"</span>, <span class="st">"Kalle"</span>, <span class="st">"Ingrid"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"Hi"</span>, names, <span class="st">"I hope you're doing well. As per this letter, I invite you to my birthday party."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "HiIngerI hope you're doing well. As per this letter, I invite you to my birthday party." 
[2] "HiPeterI hope you're doing well. As per this letter, I invite you to my birthday party." 
[3] "HiKalleI hope you're doing well. As per this letter, I invite you to my birthday party." 
[4] "HiIngridI hope you're doing well. As per this letter, I invite you to my birthday party."</code></pre>
</div>
</div>
<p>Well, this looks kind of ugly, as there are no spaces, and commas are lacking as well. You can fix that by determining a separator using the <code>sep</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">"Hi"</span>, names, <span class="st">"I hope you're doing well. As per this letter, I invite you to my birthday party."</span>, <span class="at">sep =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hi, Inger, I hope you're doing well. As per this letter, I invite you to my birthday party." 
[2] "Hi, Peter, I hope you're doing well. As per this letter, I invite you to my birthday party." 
[3] "Hi, Kalle, I hope you're doing well. As per this letter, I invite you to my birthday party." 
[4] "Hi, Ingrid, I hope you're doing well. As per this letter, I invite you to my birthday party."</code></pre>
</div>
</div>
<p>You could also collapse the strings contained in a vector together into one single string using the <code>collapse</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(names, <span class="at">collapse =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Inger, Peter, Kalle, Ingrid"</code></pre>
</div>
</div>
</section>
<section id="repetition" class="level3">
<h3 class="anchored" data-anchor-id="repetition">Repetition</h3>
<p>Repeating (or duplicating) strings is performed using <code>str_dup()</code>. The function takes two arguments: the string to be duplicated and the number of times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_dup</span>(<span class="st">"felix"</span>, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "felixfelix"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_dup</span>(<span class="st">"felix"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "felix"           "felixfelix"      "felixfelixfelix"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_dup</span>(names, <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "IngerInger"   "PeterPeter"   "KalleKalle"   "IngridIngrid"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_dup</span>(names, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Inger"                    "PeterPeter"              
[3] "KalleKalleKalle"          "IngridIngridIngridIngrid"</code></pre>
</div>
</div>
</section>
<section id="removing-unnecessary-whitespaces" class="level3">
<h3 class="anchored" data-anchor-id="removing-unnecessary-whitespaces">Removing unnecessary whitespaces</h3>
<p>Often text contains unnecessary whitespaces.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>unnecessary_whitespaces <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"    on the left"</span>, <span class="st">"on the right    "</span>, <span class="st">"    on both sides   "</span>, <span class="st">"   literally    everywhere  "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Removing the ones at the beginning or the end of a string can be accomplished using <code>str_trim()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(unnecessary_whitespaces, <span class="at">side =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "on the left"               "on the right    "         
[3] "on both sides   "          "literally    everywhere  "</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(unnecessary_whitespaces, <span class="at">side =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "    on the left"            "on the right"              
[3] "    on both sides"          "   literally    everywhere"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(unnecessary_whitespaces, <span class="at">side =</span> <span class="st">"both"</span>) <span class="co"># the default option</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "on the left"             "on the right"           
[3] "on both sides"           "literally    everywhere"</code></pre>
</div>
</div>
<p><code>str_trim()</code> could not fix the last string though, where unnecessary whitespaces were also present in between words. Here, <code>str_squish</code> is more appropriate. It removes leading or trailing whitespaces as well as duplicated ones in between words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_squish</span>(unnecessary_whitespaces)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "on the left"          "on the right"         "on both sides"       
[4] "literally everywhere"</code></pre>
</div>
</div>
</section>
<section id="further-links" class="level3">
<h3 class="anchored" data-anchor-id="further-links">Further links</h3>
<ul>
<li>R for Data Science <a href="https://r4ds.hadley.nz/strings">chapter on <code>stringr</code></a></li>
<li>The <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf"><code>stringr</code> cheatsheet</a>.</li>
</ul>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li>Run the following code that downloads movies from IMDb. Clean up the column “year” in the resulting film data set. Think about how you could do it with <code>str_sub()</code>. Could you also use it for the dot in the “rank” column?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(rvest, tidyverse)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>imdb_top250 <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.imdb.com/chart/top/?ref_=nv_mv_250"</span>)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>movies <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">title_raw =</span> imdb_top250 <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">".cli-title .ipc-title__text"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>(),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_raw =</span> imdb_top250 <span class="sc">|&gt;</span> </span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">".cli-title-metadata"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(title_raw, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"rank"</span>, <span class="st">"title"</span>), <span class="at">extra =</span> <span class="st">"merge"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>movies_clean <span class="ot">&lt;-</span> movies <span class="sc">|&gt;</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">str_sub</span>(year_raw, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">as.double</span>(),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">rank =</span> <span class="fu">str_sub</span>(rank, <span class="at">start =</span> <span class="sc">-</span><span class="dv">4</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="2" type="1">
<li>Convert the following sentence to different cases:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>sentence <span class="ot">&lt;-</span> <span class="st">"The quick brown fox jumps over the lazy dog."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_lower</span>(sentence)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_sentence</span>(sentence)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_title</span>(sentence)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">str_to_upper</span>(sentence)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="3" type="1">
<li>What’s the length of the following string?</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="st">"I enjoy studying Sociology at Leipzig University."</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="4" type="1">
<li>Using the following vectors, create a full sentence:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="st">"I am a large language model and I am"</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>attributes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"powerful."</span>, <span class="st">"dumb."</span>, <span class="st">"worse at coding than your instructor."</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="st">"Haha, do you really think I asked ChatGPT to give you these exercises?"</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="st">"(Of course I did, I am lazy AF.)"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(start, attributes, end, ps, <span class="at">sep =</span> <span class="st">" "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
</section>
<section id="regular-expressions" class="level2">
<h2 class="anchored" data-anchor-id="regular-expressions">Regular expressions</h2>
<p>Up to now, you have been introduced to the more basic functions of the <code>stringr</code> package. Those are useful, for sure, yet limited. However, to make use of the full potential of <code>stringr</code>, you will first have to acquaint yourself with regular expressions (also often abbreviated as “RegEx” with plural “RegExes”).</p>
<p>Those regular expressions are patterns that can be used to describe certain strings. Exemplary use cases of RegExes are the identification of phone numbers, email addresses, or whether a password you choose on a web page consists of enough characters, an uppercase character, and at least one special character. Hence, if you want to replace certain words with another one, you can write the proper RegEx and it will identify the strings you want to replace, and the <code>stringr</code> functions (i.e., <code>str_replace()</code>) will take care of the rest.</p>
<p>Before you dive into RegExes, beware that they are quite complicated at the beginning<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Yet, mastering them is very rewarding and will pay off in the future.</p>
<section id="literal-characters" class="level3">
<h3 class="anchored" data-anchor-id="literal-characters">Literal characters</h3>
<p>The most basic RegEx patterns consist of literal characters only. <code>str_view()</code> tells you which parts of a string match a pattern is present in the element.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>five_largest_cities <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Stockholm"</span>, <span class="st">"Göteborg"</span>, <span class="st">"Malmö"</span>, <span class="st">"Uppsala"</span>, <span class="st">"Västerås"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that RegExes are case-sensitive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(five_largest_cities, <span class="st">"stockholm"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-5ed907810fd9b0770d2b" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-5ed907810fd9b0770d2b">{"x":{"html":"<ul>\n  <li><pre>Stockholm<\/pre><\/li>\n  <li><pre>Göteborg<\/pre><\/li>\n  <li><pre>Malmö<\/pre><\/li>\n  <li><pre>Uppsala<\/pre><\/li>\n  <li><pre>Västerås<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(five_largest_cities, <span class="st">"Stockholm"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-8410cfc396cef596c676" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-8410cfc396cef596c676">{"x":{"html":"<ul>\n  <li><pre><span class='match'>Stockholm<\/span><\/pre><\/li>\n  <li><pre>Göteborg<\/pre><\/li>\n  <li><pre>Malmö<\/pre><\/li>\n  <li><pre>Uppsala<\/pre><\/li>\n  <li><pre>Västerås<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>They also match parts of words:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(five_largest_cities, <span class="st">"borg"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-935fb3c0a9860758ad19" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-935fb3c0a9860758ad19">{"x":{"html":"<ul>\n  <li><pre>Stockholm<\/pre><\/li>\n  <li><pre>Göte<span class='match'>borg<\/span><\/pre><\/li>\n  <li><pre>Malmö<\/pre><\/li>\n  <li><pre>Uppsala<\/pre><\/li>\n  <li><pre>Västerås<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Moreover, they are “greedy,” they only match the first occurrence. <code>str_locate()</code> locates the pattern. Look at Stockholm – we should have two matches here:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(five_largest_cities, <span class="st">"o"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> five_largest_cities)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 3
  start   end city     
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;    
1     3     3 Stockholm
2     6     6 Göteborg 
3    NA    NA Malmö    
4    NA    NA Uppsala  
5    NA    NA Västerås </code></pre>
</div>
</div>
<p>This can be addressed in the <code>stringr</code> package by using <code>str_._all()</code> functions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate_all</span>(five_largest_cities, <span class="st">"o"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(five_largest_cities, \(x, y) x <span class="sc">|&gt;</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">city =</span> y)) <span class="sc">|&gt;</span> </span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 3
  start   end city     
  &lt;int&gt; &lt;int&gt; &lt;chr&gt;    
1     3     3 Stockholm
2     7     7 Stockholm
3     6     6 Göteborg </code></pre>
</div>
</div>
<p>If you want to match multiple literal characters (or words, for that sake), you can connect them using the <code>|</code> meta character (more on meta characters later).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(five_largest_cities, <span class="st">"Stockholm|Göteborg"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-2481fb588846e7a02460" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-2481fb588846e7a02460">{"x":{"html":"<ul>\n  <li><pre><span class='match'>Stockholm<\/span><\/pre><\/li>\n  <li><pre><span class='match'>Göteborg<\/span><\/pre><\/li>\n  <li><pre>Malmö<\/pre><\/li>\n  <li><pre>Uppsala<\/pre><\/li>\n  <li><pre>Västerås<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Every letter of the English alphabet (or number/or combination of those) can serve as a literal character. Those literal characters <em>match themselves</em>. This is, however, not the case with the other sort of characters, so-called meta characters.</p>
</section>
<section id="metacharacters" class="level3">
<h3 class="anchored" data-anchor-id="metacharacters">Metacharacters</h3>
<p>When using RegExes, the following characters are considered meta characters and have a special meaning:</p>
<p><code>. \ | ( ) { } [ ] ^ $ - * + ?</code></p>
<section id="the-wildcard" class="level4">
<h4 class="anchored" data-anchor-id="the-wildcard">The wildcard</h4>
<p>Did you notice how we used the dot to refer to the entirety of the <code>str_._all()</code> functions? This is basically what the <code>.</code> meta-character does: it matches every character except for a new line. The first call extracts all function names from the <code>stringr</code> package, the second one shows the matches (i.e., the elements of the vector where it can find the pattern).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>stringr_functions <span class="ot">&lt;-</span> <span class="fu">ls</span>(<span class="st">"package:stringr"</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(stringr_functions, <span class="st">"str_._all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[13] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[61] FALSE FALSE</code></pre>
</div>
</div>
<p>Well, as you can see, there are none. This is because the <code>.</code> can only replace one character. We need some sort of multiplier to find them. The ones available are:</p>
<ul>
<li><code>?</code> – zero or one</li>
<li><code>*</code> – zero or more</li>
<li><code>+</code> – one or more</li>
<li><code>{n}</code> – exactly n</li>
<li><code>{n,}</code> – n or more</li>
<li><code>{n,m}</code> – between n and m</li>
</ul>
<p>In our case, the appropriate one is <code>+</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(stringr_functions, <span class="st">"str_.+_all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
[13] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
[25] FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE
[37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
[49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
[61] FALSE FALSE</code></pre>
</div>
</div>
<p>However, what if you want to match the character “.”? This problem might come up when searching for clock time. A naive RegEx might look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>vectors_with_time <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"13500"</span>, <span class="st">"13M00"</span>, <span class="st">"13.00"</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(vectors_with_time, <span class="st">"13.00"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
<p>Yet, it matches everything. We need some sort of literal dot. Here, the metacharacter <code>\</code> comes in handy. By putting <code>\</code> in front of the metacharacter that we want to be treated as literal – the <code>.</code> in our case – the <code>.</code> loses its special meaning and is interpreted as a literal character. This procedure is referred to as “escaping.” Hence, <code>\</code> is also referred to as the “escape character.” Note that, in R, you will need to escape <code>\</code> as well, and therefore in code escaping will look like this: <code>\\.</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(vectors_with_time, <span class="st">"13</span><span class="sc">\\</span><span class="st">.00"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE  TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="sets-of-characters" class="level3">
<h3 class="anchored" data-anchor-id="sets-of-characters">Sets of characters</h3>
<p>You can also define sets of multiple characters using the <code>[ ]</code> meta characters. This can be used to define multiple possible characters that can appear in the same place.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sp_ce <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"spice"</span>, <span class="st">"space"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(sp_ce, <span class="st">"sp[ai]ce"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-e212bd1550cb082c75f5" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-e212bd1550cb082c75f5">{"x":{"html":"<ul>\n  <li><pre><span class='match'>spice<\/span><\/pre><\/li>\n  <li><pre><span class='match'>space<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>You can also define certain ranges of characters using the <code>-</code> metacharacter:</p>
<p>Same holds for numbers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>american_phone_number <span class="ot">&lt;-</span> <span class="st">"(555) 555-1234"</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(american_phone_number, <span class="st">"</span><span class="sc">\\</span><span class="st">([:digit:]{3}</span><span class="sc">\\</span><span class="st">) [0-9]{3}-[0-9]{4}"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-e14abe4e4aca11b89a4a" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-e14abe4e4aca11b89a4a">{"x":{"html":"<ul>\n  <li><pre><span class='match'>(555) 555-1234<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>There are also predefined sets of characters, for instance, digits or letters, which are called <em>character classes</em>. You can find them on the <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf"><code>stringr</code> cheatsheet</a>.</p>
<p>Furthermore, you can put almost every meta character inside the square brackets without escaping them. This does not apply to the caret (<code>^</code>) in the first position, the dash <code>-</code>, the closing square bracket <code>]</code>, and the backslash <code>\</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(vector_of_strings, <span class="st">"[.]"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-1b5f5addac5dad595668" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-1b5f5addac5dad595668">{"x":{"html":"<ul>\n  <li><pre>Hi, how are you doing<span class='match'>.<\/span><\/pre><\/li>\n  <li><pre>I'm doing well, HBY<span class='match'>.<\/span><\/pre><\/li>\n  <li><pre>Me too, thanks for asking<span class='match'>.<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="negating-sets-of-characters" class="level4">
<h4 class="anchored" data-anchor-id="negating-sets-of-characters">Negating sets of characters</h4>
<p>Sometimes you will also want to exclude certain sets of characters or words. To achieve this, you can use the <code>^</code> meta character at the beginning of the range or set you are defining.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(sp_ce, <span class="st">"sp[^i]ce"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-8a8e5fb7b1da52b777c0" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-8a8e5fb7b1da52b777c0">{"x":{"html":"<ul>\n  <li><pre>spice<\/pre><\/li>\n  <li><pre><span class='match'>space<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="anchors" class="level3">
<h3 class="anchored" data-anchor-id="anchors">Anchors</h3>
<p>There is also a way to define whether you want the pattern to be present in the beginning <code>^</code> or at the end <code>$</code> of a string. <code>sentences</code> are a couple of (i.e., 720) predefined example sentences. If we were now interested in the number of sentences that begin with a “the,” we could write the following RegEx:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>shortened_sentences <span class="ot">&lt;-</span> sentences[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(shortened_sentences, <span class="st">"^The"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-8327a98920cc75a1dc80" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-8327a98920cc75a1dc80">{"x":{"html":"<ul>\n  <li><pre><span class='match'>The<\/span> birch canoe slid on the smooth planks.<\/pre><\/li>\n  <li><pre>Glue the sheet to the dark blue background.<\/pre><\/li>\n  <li><pre>It's easy to tell the depth of a well.<\/pre><\/li>\n  <li><pre><span class='match'>The<\/span>se days a chicken leg is a rare dish.<\/pre><\/li>\n  <li><pre>Rice is often served in round bowls.<\/pre><\/li>\n  <li><pre><span class='match'>The<\/span> juice of lemons makes fine punch.<\/pre><\/li>\n  <li><pre><span class='match'>The<\/span> box was thrown beside the parked truck.<\/pre><\/li>\n  <li><pre><span class='match'>The<\/span> hogs were fed chopped corn and garbage.<\/pre><\/li>\n  <li><pre>Four hours of steady work faced us.<\/pre><\/li>\n  <li><pre>A large size in stockings is hard to sell.<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>If we wanted to know how many start with a “The” and end with a full stop, we could do this one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(shortened_sentences, <span class="st">"^The.+</span><span class="sc">\\</span><span class="st">.$"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-28b3fddab2a0a511db55" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-28b3fddab2a0a511db55">{"x":{"html":"<ul>\n  <li><pre><span class='match'>The birch canoe slid on the smooth planks.<\/span><\/pre><\/li>\n  <li><pre>Glue the sheet to the dark blue background.<\/pre><\/li>\n  <li><pre>It's easy to tell the depth of a well.<\/pre><\/li>\n  <li><pre><span class='match'>These days a chicken leg is a rare dish.<\/span><\/pre><\/li>\n  <li><pre>Rice is often served in round bowls.<\/pre><\/li>\n  <li><pre><span class='match'>The juice of lemons makes fine punch.<\/span><\/pre><\/li>\n  <li><pre><span class='match'>The box was thrown beside the parked truck.<\/span><\/pre><\/li>\n  <li><pre><span class='match'>The hogs were fed chopped corn and garbage.<\/span><\/pre><\/li>\n  <li><pre>Four hours of steady work faced us.<\/pre><\/li>\n  <li><pre>A large size in stockings is hard to sell.<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<section id="boundaries" class="level4">
<h4 class="anchored" data-anchor-id="boundaries">Boundaries</h4>
<p>Note that right now, the RegEx also matches the sentence which starts with a “These.” To address this, we need to tell the machine that it should only accept a “The” if there starts a new word thereafter. In RegEx syntax, this is done using so-called boundaries. Those are defined as <code>\b</code> as a word boundary and <code>\B</code> as no word boundary. (Note that you will need an additional escape character as you will have to escape the escape character itself.)</p>
<p>In my example, we would include the former if we were to search for sentences that begin with a single “The” and the latter if we were to search for sentences that begin with a word that starts with a “The” but are not “The” – such as “These.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(shortened_sentences, <span class="st">"^The</span><span class="sc">\\</span><span class="st">b.+</span><span class="sc">\\</span><span class="st">.$"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-55aa95bb354f94c8e775" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-55aa95bb354f94c8e775">{"x":{"html":"<ul>\n  <li><pre><span class='match'>The birch canoe slid on the smooth planks.<\/span><\/pre><\/li>\n  <li><pre>Glue the sheet to the dark blue background.<\/pre><\/li>\n  <li><pre>It's easy to tell the depth of a well.<\/pre><\/li>\n  <li><pre>These days a chicken leg is a rare dish.<\/pre><\/li>\n  <li><pre>Rice is often served in round bowls.<\/pre><\/li>\n  <li><pre><span class='match'>The juice of lemons makes fine punch.<\/span><\/pre><\/li>\n  <li><pre><span class='match'>The box was thrown beside the parked truck.<\/span><\/pre><\/li>\n  <li><pre><span class='match'>The hogs were fed chopped corn and garbage.<\/span><\/pre><\/li>\n  <li><pre>Four hours of steady work faced us.<\/pre><\/li>\n  <li><pre>A large size in stockings is hard to sell.<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(shortened_sentences, <span class="st">"^The</span><span class="sc">\\</span><span class="st">B.+</span><span class="sc">\\</span><span class="st">.$"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-fe6a9c4881898d60de31" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-fe6a9c4881898d60de31">{"x":{"html":"<ul>\n  <li><pre>The birch canoe slid on the smooth planks.<\/pre><\/li>\n  <li><pre>Glue the sheet to the dark blue background.<\/pre><\/li>\n  <li><pre>It's easy to tell the depth of a well.<\/pre><\/li>\n  <li><pre><span class='match'>These days a chicken leg is a rare dish.<\/span><\/pre><\/li>\n  <li><pre>Rice is often served in round bowls.<\/pre><\/li>\n  <li><pre>The juice of lemons makes fine punch.<\/pre><\/li>\n  <li><pre>The box was thrown beside the parked truck.<\/pre><\/li>\n  <li><pre>The hogs were fed chopped corn and garbage.<\/pre><\/li>\n  <li><pre>Four hours of steady work faced us.<\/pre><\/li>\n  <li><pre>A large size in stockings is hard to sell.<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="lookarounds" class="level4">
<h4 class="anchored" data-anchor-id="lookarounds">Lookarounds</h4>
<p>A final common task is to extract certain words or values based on what comes before or after them. Look at the following example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>heights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1m30cm"</span>, <span class="st">"2m01cm"</span>, <span class="st">"3m10cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, to identify the height in meters, the first task is to identify all the numbers that are followed by an “m”. The RegEx syntax for this looks like this: <code>A(?=pattern)</code> with <code>A</code> being the entity that is supposed to be found (hence, in this case, [0-9]+).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(heights, <span class="st">"[0-9]+(?=m)"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-c9d0229f50230d3f211d" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-c9d0229f50230d3f211d">{"x":{"html":"<ul>\n  <li><pre><span class='match'>1<\/span>m30cm<\/pre><\/li>\n  <li><pre><span class='match'>2<\/span>m01cm<\/pre><\/li>\n  <li><pre><span class='match'>3<\/span>m10cm<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The second step now is to identify the centimeters. This could of course be achieved using the same RegEx and replacing <code>m</code> with <code>cm</code>. However, we can also harness a so-called negative look ahead <code>A(?!pattern)</code>, a so-called look behind <code>(?&lt;=pattern)A</code>. The negative counterpart, the negative look behind <code>(?&lt;!pattern)A</code> could be used to extract the meters.</p>
<p>The negative lookahead returns everything that is not followed by the defined pattern. The look behind returns everything that is preceded by the pattern, the negative look behind returns everything that is not preceded by the pattern.</p>
<p>In the following, we demonstrate how you could extract the centimeters using negative look ahead and look behind.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(heights, <span class="st">"[0-9]+(?!m)"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>) <span class="co"># negative look ahead</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-29358bc927d9ffc0a65f" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-29358bc927d9ffc0a65f">{"x":{"html":"<ul>\n  <li><pre>1m<span class='match'>30<\/span>cm<\/pre><\/li>\n  <li><pre>2m<span class='match'>01<\/span>cm<\/pre><\/li>\n  <li><pre>3m<span class='match'>10<\/span>cm<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(heights, <span class="st">"(?&lt;=m)[0-9]+"</span>, <span class="at">match =</span> <span class="cn">NA</span>, <span class="at">html =</span> <span class="cn">TRUE</span>) <span class="co"># look behind</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-4700f41749709f861ec8" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-4700f41749709f861ec8">{"x":{"html":"<ul>\n  <li><pre>1m<span class='match'>30<\/span>cm<\/pre><\/li>\n  <li><pre>2m<span class='match'>01<\/span>cm<\/pre><\/li>\n  <li><pre>3m<span class='match'>10<\/span>cm<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="further-links-1" class="level3">
<h3 class="anchored" data-anchor-id="further-links-1">Further links</h3>
<ul>
<li>R for Data Science <a href="https://r4ds.hadley.nz/RegExps">chapter on RegExes</a></li>
<li>A <a href="https://www.youtube.com/watch?v=NvHjYOilOf8">YouTube video</a> on RegExes by Johns Hopkins professor Roger Peng.</li>
<li>And a <a href="https://bookdown.org/rdpeng/rprogdatascience/regular-expressions.html#the-stringr-package">chapter</a> by Roger Peng.</li>
<li>A <a href="https://RegExone.com">website for practicing RegExes</a>.</li>
</ul>
</section>
<section id="exercises-1" class="level3">
<h3 class="anchored" data-anchor-id="exercises-1">Exercises</h3>
<ol type="1">
<li>Write a RegEx for Swedish mobile numbers. Test it with <code>str_detect("+46 71-738 25 33", "[insert your RegEx here]")</code>.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">"+46 71-738 25 33"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">+46 [0-9]{2}</span><span class="sc">\\</span><span class="st">-[0-9]{3} [0-9]{2} [0-9]{2}"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="2" type="1">
<li>Given the vector <code>c("apple", "banana", "cherry", "date", "elderberry")</code>, use a regular expression to identify fruits that contain the letter “a” exactly three times.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>fruits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"apple"</span>, <span class="st">"banana"</span>, <span class="st">"cherry"</span>, <span class="st">"date"</span>, <span class="st">"elderberry"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(fruits, <span class="st">"a[^a]*a(&lt;=[^a]|</span><span class="sc">\\</span><span class="st">b)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="3" type="1">
<li>Given the sentence vector <code>c("The cat sat on the mat.", "Mat is what it sat on.", "On the mat, it sat.")</code>, write a regular expression to identify sentences that start with “The” and end with “mat.”.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>cats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"The cat sat on the mat."</span>, <span class="st">"Mat is what it sat on."</span>, <span class="st">"On the mat, it sat."</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(cats, <span class="st">"^The.*mat.$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="4" type="1">
<li>Extract all email addresses from the following vector: <code>c("john.doe@example.com", "alice_smith@company.net", "r.user@domain.org", "I am @ the office RN", "facebook.com")</code>.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>addresses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"john.doe@example.com"</span>, <span class="st">"alice_smith@company.net"</span>, <span class="st">"r.user@domain.org"</span>, <span class="st">"I am @ the office RN"</span>, <span class="st">"facebook.com"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(addresses, <span class="st">"[a-z.</span><span class="sc">\\</span><span class="st">_]+</span><span class="sc">\\</span><span class="st">@[a-z]+</span><span class="sc">\\</span><span class="st">.[a-z]+"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="5" type="1">
<li>Check a vector of passwords for strength. A strong password should have at least 8 characters, include an uppercase and a lowercase letter, a number, and a special character (e.g., !@#$%^&amp;*).</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>password <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Hi!123456"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">str_detect</span>(password, <span class="st">"[A-Z]{1,}"</span>) <span class="sc">&amp;</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(password, <span class="st">"[a-z]{1,}"</span>) <span class="sc">&amp;</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(password, <span class="st">"[0-9]{1,}"</span>) <span class="sc">&amp;</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(password, <span class="st">"[</span><span class="sc">\\</span><span class="st">!</span><span class="sc">\\</span><span class="st">@</span><span class="sc">\\</span><span class="st">#</span><span class="sc">\\</span><span class="st">$</span><span class="sc">\\</span><span class="st">%</span><span class="sc">\\</span><span class="st">^</span><span class="sc">\\</span><span class="st">&amp;</span><span class="sc">\\</span><span class="st">*]{1,}"</span>) <span class="sc">&amp;</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_length</span>(password) <span class="sc">&gt;</span> <span class="dv">7</span>){</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"strong password"</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"weak password"</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="6" type="1">
<li>From “The theme of this theater is therapeutic.”, extract all words that start with “the” but are not followed by “me”.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>sentence <span class="ot">&lt;-</span> <span class="st">"The theme of this theater is therapeutic."</span> <span class="sc">|&gt;</span> <span class="fu">str_to_lower</span>()</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_extract_all</span>(sentence, <span class="st">"</span><span class="sc">\\</span><span class="st">bthe(?!me)</span><span class="sc">\\</span><span class="st">w*</span><span class="sc">\\</span><span class="st">b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
</section>
</section>
<section id="more-advanced-string-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="more-advanced-string-manipulation">More advanced string manipulation</h2>
<p>Now that you have learned about RegExes, you can unleash the full power of <code>stringr</code>.</p>
<p>The basic syntax of a <code>stringr</code> function looks as follows: <code>str_.*(string, regex(""))</code>. Some <code>stringr</code> functions also have the suffix <code>_all</code> which implies that they operate not only on the first match (“greedy”) but on every match.</p>
<p>To demonstrate the different functions, we will again rely on the subset of example sentences.</p>
<section id="detect-matches" class="level3">
<h3 class="anchored" data-anchor-id="detect-matches">Detect matches</h3>
<p><code>str_detect</code> can be used to determine whether a certain pattern is present in the string.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(shortened_sentences, <span class="st">"The</span><span class="sc">\\</span><span class="st">b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
</div>
</div>
<p>This also works very well in a <code>dplyr::filter()</code> call. Finding all action movies in the IMDB data set can be solved like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://www.dropbox.com/s/81o3zzdkw737vt0/imdb2006-2016.csv?dl=1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1000 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (5): Title, Genre, Description, Director, Actors
dbl (7): Rank, Year, Runtime (Minutes), Rating, Votes, Revenue (Millions), M...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="sc">|&gt;</span> </span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(Genre, <span class="st">"Action"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 303 × 12
    Rank Title       Genre Description Director Actors  Year `Runtime (Minutes)`
   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;  &lt;dbl&gt;               &lt;dbl&gt;
 1     1 Guardians … Acti… A group of… James G… Chris…  2014                 121
 2     5 Suicide Sq… Acti… A secret g… David A… Will …  2016                 123
 3     6 The Great … Acti… European m… Yimou Z… Matt …  2016                 103
 4     9 The Lost C… Acti… A true-lif… James G… Charl…  2016                 141
 5    13 Rogue One   Acti… The Rebel … Gareth … Felic…  2016                 133
 6    15 Colossal    Acti… Gloria is … Nacho V… Anne …  2016                 109
 7    18 Jason Bour… Acti… The CIA's … Paul Gr… Matt …  2016                 123
 8    25 Independen… Acti… Two decade… Roland … Liam …  2016                 120
 9    27 Bahubali: … Acti… In ancient… S.S. Ra… Prabh…  2015                 159
10    30 Assassin's… Acti… When Callu… Justin … Micha…  2016                 115
# ℹ 293 more rows
# ℹ 4 more variables: Rating &lt;dbl&gt;, Votes &lt;dbl&gt;, `Revenue (Millions)` &lt;dbl&gt;,
#   Metascore &lt;dbl&gt;</code></pre>
</div>
</div>
<p>If you want to know whether there are multiple matches present in each string, you can use <code>str_count</code>. Here, it might be advisable to set the <code>ignore_case</code> option to <code>TRUE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(shortened_sentences, <span class="fu">regex</span>(<span class="st">"the</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2 2 1 0 0 1 2 1 0 0</code></pre>
</div>
</div>
<p>If you want to locate the match in the string, use <code>str_locate</code>. This returns a matrix, which is a vector of multiple dimensions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate</span>(shortened_sentences, <span class="fu">regex</span>(<span class="st">"The</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      start end
 [1,]     1   3
 [2,]     6   8
 [3,]    19  21
 [4,]    NA  NA
 [5,]    NA  NA
 [6,]     1   3
 [7,]     1   3
 [8,]     1   3
 [9,]    NA  NA
[10,]    NA  NA</code></pre>
</div>
</div>
<p>Moreover, this is a good example for the greediness of <code>stringr</code> functions. Hence, it is advisable to use <code>str_locate_all</code> which returns a list with one matrix for each element of the original vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_locate_all</span>(shortened_sentences, <span class="fu">regex</span>(<span class="st">"The</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     start end
[1,]     1   3
[2,]    25  27</code></pre>
</div>
</div>
</section>
<section id="mutating-strings" class="level3">
<h3 class="anchored" data-anchor-id="mutating-strings">Mutating strings</h3>
<p>Mutating strings usually implies the replacement of certain elements (e.g., words) with other elements (or removing them, which is a special case of replacing them with nothing). In <code>stringr</code> this is performed using <code>str_replace(string, pattern, replacement)</code> and <code>str_replace_all(string, pattern, replacement)</code>.</p>
<p>If we wanted, for instance, to replace the first occurrence of “m” letters with “meters,” we would go about this the following way:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(heights, <span class="st">"m"</span>, <span class="st">"meters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1meters30cm" "2meters01cm" "3meters10cm"</code></pre>
</div>
</div>
<p>Note that <code>str_replace_all</code> would have lead to the following outcome:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(heights, <span class="st">"m"</span>, <span class="st">"meters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1meters30cmeters" "2meters01cmeters" "3meters10cmeters"</code></pre>
</div>
</div>
<p>However, we also want to replace the “cm” with “centimeters,” hence, we can harness another feature of <code>str_replace_all()</code>, providing multiple replacements:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(heights, <span class="fu">c</span>(<span class="st">"m"</span> <span class="ot">=</span> <span class="st">"meters"</span>, <span class="st">"cm"</span> <span class="ot">=</span> <span class="st">"centimeters"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1meters30centimeterseters" "2meters01centimeterseters"
[3] "3meters10centimeterseters"</code></pre>
</div>
</div>
<p>What becomes obvious is that a “simple” RegEx containing just literal characters more often than not does not suffice. It will be your task to fix this. And while on it, you can also address the meter/meters problem – a “1” needs meter instead of meters. Another feature is that the replacements are performed in order. You can harness this for solving the problem.</p>
</section>
<section id="extracting-text" class="level3">
<h3 class="anchored" data-anchor-id="extracting-text">Extracting text</h3>
<p><code>str_extract(_all)()</code> can be used to extract matching strings. In the <code>mtcars</code> data set, the first word describes the car brand. Here, we harness another RegEx, the <code>\\w</code> which stands for any word character. Its opponent is <code>\\W</code> for any non-word character.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"car_model"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">manufacturer =</span> <span class="fu">str_extract</span>(car_model, <span class="st">"^</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">b"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  manufacturer
1        Mazda
2        Mazda
3       Datsun
4       Hornet
5       Hornet
6      Valiant</code></pre>
</div>
</div>
</section>
<section id="split-vectors" class="level3">
<h3 class="anchored" data-anchor-id="split-vectors">Split vectors</h3>
<p>Another use case here would have been to split it into two columns: manufacturer and model. One approach would be to use <code>str_split()</code>. This function splits the string at every occurrence of the predefined pattern. In this example, we use a word boundary as the pattern:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>manufacturer_model <span class="ot">&lt;-</span> <span class="fu">rownames</span>(mtcars)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split</span>(manufacturer_model, <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] ""      "Mazda" " "     "RX4"   ""     

[[2]]
[1] ""      "Mazda" " "     "RX4"   " "     "Wag"   ""     

[[3]]
[1] ""       "Datsun" " "      "710"    ""      

[[4]]
[1] ""       "Hornet" " "      "4"      " "      "Drive"  ""      

[[5]]
[1] ""           "Hornet"     " "          "Sportabout" ""          

[[6]]
[1] ""        "Valiant" ""       </code></pre>
</div>
</div>
<p>This outputs a list containing the different singular words/special characters. This doesn’t make sense in this case. Here, however, the structure of the string is always roughly the same: “\[manufacturer\]\[ \]\[model description\]”. Moreover, the manufacturer is only one word. Hence, the task can be fixed by splitting the string after the first word, which should indicate the manufacturer. This can be accomplished using <code>str_split_fixed()</code>. Fixed means that the number of splits is predefined. This returns a matrix that can easily become a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split_fixed</span>(manufacturer_model, <span class="st">"(?&lt;=</span><span class="sc">\\</span><span class="st">w)</span><span class="sc">\\</span><span class="st">b"</span>, <span class="at">n =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">manufacturer =</span> V1,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">model =</span> V2) <span class="sc">|&gt;</span> </span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">str_squish</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `x` argument of `as_tibble.matrix()` must have unique column names if
`.name_repair` is omitted as of tibble 2.0.0.
ℹ Using compatibility `.name_repair`.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 32 × 2
   manufacturer model       
   &lt;chr&gt;        &lt;chr&gt;       
 1 Mazda        "RX4"       
 2 Mazda        "RX4 Wag"   
 3 Datsun       "710"       
 4 Hornet       "4 Drive"   
 5 Hornet       "Sportabout"
 6 Valiant      ""          
 7 Duster       "360"       
 8 Merc         "240D"      
 9 Merc         "230"       
10 Merc         "280"       
# ℹ 22 more rows</code></pre>
</div>
</div>
</section>
<section id="further-links-2" class="level3">
<h3 class="anchored" data-anchor-id="further-links-2">Further links</h3>
<p>Look at the “Further links” provided above.</p>
</section>
<section id="exercises-2" class="level3">
<h3 class="anchored" data-anchor-id="exercises-2">Exercises</h3>
<ol type="1">
<li>Run the following code that downloads movies from IMDb. Create a tibble with the two columns “rank” and “title” by extracting the respective part of the raw title.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(rvest, tidyverse)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>imdb_top250 <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://www.imdb.com/chart/top/?ref_=nv_mv_250"</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>raw_title <span class="ot">&lt;-</span> imdb_top250 <span class="sc">|&gt;</span> </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_elements</span>(<span class="st">".cli-title .ipc-title__text"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">html_text2</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">rank =</span> raw_title <span class="sc">|&gt;</span> <span class="fu">str_extract</span>(<span class="st">"^[0-9]{1,3}"</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> raw_title <span class="sc">|&gt;</span> <span class="fu">str_remove</span>(<span class="st">"^[0-9]{1,3}</span><span class="sc">\\</span><span class="st">. "</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="2" type="1">
<li>Replace m and cm appropriately in the vector of heights.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>heights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1m30cm"</span>, <span class="st">"2m01cm"</span>, <span class="st">"3m10cm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(heights, <span class="fu">c</span>(<span class="st">"(?&lt;=[2-9]{1})m"</span> <span class="ot">=</span> <span class="st">"meters"</span>, </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"(?&lt;=[0-9]{2})m"</span> <span class="ot">=</span> <span class="st">"meters"</span>, </span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"(?&lt;=1)m"</span> <span class="ot">=</span> <span class="st">"meter"</span>, </span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"(?&lt;=01)cm$"</span> <span class="ot">=</span> <span class="st">"centimeter"</span>, </span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>                           <span class="st">"cm$"</span> <span class="ot">=</span> <span class="st">"centimeters"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="3" type="1">
<li>Run the following code and clean up the resulting table.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(rvest, janitor, lubridate, tidyverse)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>senator_table_raw <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">"https://en.wikipedia.org/wiki/List_of_current_United_States_senators"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_elements</span>(<span class="at">css =</span> <span class="st">"#senators"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() <span class="sc">|&gt;</span> </span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>() <span class="sc">|&gt;</span> </span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, senator, <span class="at">party =</span> party_2, born, <span class="at">occupations =</span> occupation_s, assumed_office)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="a">
<li>Remove the footnotes in the “party” column.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>senator_table_party_cleaned <span class="ot">&lt;-</span> senator_table_raw <span class="sc">|&gt;</span> </span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">party =</span> <span class="fu">str_remove_all</span>(party, <span class="st">"</span><span class="sc">\\</span><span class="st">[.</span><span class="sc">\\</span><span class="st">]|</span><span class="sc">\\</span><span class="st">(.+</span><span class="sc">\\</span><span class="st">)"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="2" type="a">
<li>Bring their date of birth (“born”) in proper shape.</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>senator_table_born_party_cleaned <span class="ot">&lt;-</span> senator_table_party_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">born =</span> <span class="fu">str_extract</span>(born, <span class="st">"19[0-9]{2}</span><span class="sc">\\</span><span class="st">-[01][0-9]</span><span class="sc">\\</span><span class="st">-[0-3][0-9]"</span>) <span class="sc">|&gt;</span> <span class="fu">ymd</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>
<ol start="3" type="a">
<li>Bonus: fix their “occupation” by separating the single jobs (combine look-ahead and -behind for that.)</li>
</ol>
<details>
<summary>
Solution. Click to expand!
</summary>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>senator_table_cleaned <span class="ot">&lt;-</span> senator_table_born_party_cleaned <span class="sc">|&gt;</span> </span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">occupation_clean =</span> <span class="fu">str_replace_all</span>(occupations, <span class="fu">c</span>(<span class="st">"(?&lt;=[a-z])(?=[A-Z])"</span> <span class="ot">=</span> <span class="st">"; "</span>, <span class="st">"CEO"</span> <span class="ot">=</span> <span class="st">"CEO "</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_squish</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</details>



</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-wickham_stringr_2019" class="csl-entry" role="listitem">
Wickham, Hadley. 2019. <span>“Stringr: <span>Simple</span>, <span>Consistent Wrappers</span> for <span>Common String Operations</span>.”</span>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>comment from Felix: “honestly, I was quite overwhelmed when I encountered them first”<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/fellennert\.github\.io\/toolbox_css\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Felix Lennert (<a href="mailto:felix.lennert@uni-leipzig.de">felix.lennert@uni-leipzig.de</a>)</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>