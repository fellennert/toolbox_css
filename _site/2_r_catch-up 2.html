<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Chapter 2: Brief R Recap – Toolbox CSS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c09f7992e7ad36c4a4c784d127ab2153.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Toolbox CSS</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lectures" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Lectures</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lectures">    
        <li>
    <a class="dropdown-item" href="./lectures-overview.html">
 <span class="dropdown-text">Overview – week by week</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./lectures-week_1.html">
 <span class="dropdown-text">Week 1: What Is Computational Social Science (CSS)?</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-r-script" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">R Script</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-r-script">    
        <li>
    <a class="dropdown-item" href="./1_r_index.html">
 <span class="dropdown-text">Chapter 1: Preface</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./2_r_catch-up.html">
 <span class="dropdown-text">Chapter 2: Brief R Recap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./3_reticulate.html">
 <span class="dropdown-text">Chapter 3: <code>reticulate</code></span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#rstudio-projects" id="toc-rstudio-projects" class="nav-link active" data-scroll-target="#rstudio-projects">RStudio Projects</a>
  <ul class="collapse">
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">Motivation</a></li>
  <li><a href="#how-to-create-an-rstudio-project" id="toc-how-to-create-an-rstudio-project" class="nav-link" data-scroll-target="#how-to-create-an-rstudio-project">How to create an RStudio Project?</a></li>
  </ul></li>
  <li><a href="#r-scripts-and-quarto" id="toc-r-scripts-and-quarto" class="nav-link" data-scroll-target="#r-scripts-and-quarto">R scripts and Quarto</a>
  <ul class="collapse">
  <li><a href="#r-scripts" id="toc-r-scripts" class="nav-link" data-scroll-target="#r-scripts">R scripts</a></li>
  <li><a href="#quarto" id="toc-quarto" class="nav-link" data-scroll-target="#quarto">Quarto</a></li>
  <li><a href="#further-links" id="toc-further-links" class="nav-link" data-scroll-target="#further-links">Further links</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#reading-data-into-r" id="toc-reading-data-into-r" class="nav-link" data-scroll-target="#reading-data-into-r">Reading data into R</a>
  <ul class="collapse">
  <li><a href="#further-links-1" id="toc-further-links-1" class="nav-link" data-scroll-target="#further-links-1">Further links</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">Exercises</a></li>
  </ul></li>
  <li><a href="#tidy-data-with-tidyr" id="toc-tidy-data-with-tidyr" class="nav-link" data-scroll-target="#tidy-data-with-tidyr">Tidy data with <code>tidyr</code></a>
  <ul class="collapse">
  <li><a href="#the-concept-of-tidy-data" id="toc-the-concept-of-tidy-data" class="nav-link" data-scroll-target="#the-concept-of-tidy-data">The concept of <em>tidy data</em></a></li>
  <li><a href="#making-messy-data-tidy" id="toc-making-messy-data-tidy" class="nav-link" data-scroll-target="#making-messy-data-tidy">Making messy data tidy</a></li>
  <li><a href="#insertion-the-pipe" id="toc-insertion-the-pipe" class="nav-link" data-scroll-target="#insertion-the-pipe">Insertion: the pipe</a></li>
  <li><a href="#splitting-and-merging-cells" id="toc-splitting-and-merging-cells" class="nav-link" data-scroll-target="#splitting-and-merging-cells">Splitting and merging cells</a></li>
  <li><a href="#further-links-2" id="toc-further-links-2" class="nav-link" data-scroll-target="#further-links-2">Further links</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">Exercises</a></li>
  </ul></li>
  <li><a href="#wrangling-data-with-dplyr" id="toc-wrangling-data-with-dplyr" class="nav-link" data-scroll-target="#wrangling-data-with-dplyr">Wrangling data with <code>dplyr</code></a>
  <ul class="collapse">
  <li><a href="#select" id="toc-select" class="nav-link" data-scroll-target="#select"><code>select()</code></a></li>
  <li><a href="#filter" id="toc-filter" class="nav-link" data-scroll-target="#filter"><code>filter()</code></a></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate"><code>mutate()</code></a></li>
  <li><a href="#summarize-group_by-and-reframe" id="toc-summarize-group_by-and-reframe" class="nav-link" data-scroll-target="#summarize-group_by-and-reframe"><code>summarize()</code>, <code>group_by()</code>, and <code>reframe()</code></a></li>
  <li><a href="#arrange" id="toc-arrange" class="nav-link" data-scroll-target="#arrange"><code>arrange()</code></a></li>
  <li><a href="#introducing-joins" id="toc-introducing-joins" class="nav-link" data-scroll-target="#introducing-joins">Introducing <code>joins</code></a></li>
  <li><a href="#bind_rows-and-bind_cols" id="toc-bind_rows-and-bind_cols" class="nav-link" data-scroll-target="#bind_rows-and-bind_cols"><code>bind_rows()</code> and <code>bind_cols()</code></a></li>
  <li><a href="#further-links-3" id="toc-further-links-3" class="nav-link" data-scroll-target="#further-links-3">Further links</a></li>
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3">Exercises</a></li>
  </ul></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualizations with <code>ggplot2</code></a>
  <ul class="collapse">
  <li><a href="#the-layered-grammar-of-graphics" id="toc-the-layered-grammar-of-graphics" class="nav-link" data-scroll-target="#the-layered-grammar-of-graphics">The “layered grammar of graphics”</a></li>
  <li><a href="#the-layers" id="toc-the-layers" class="nav-link" data-scroll-target="#the-layers">The layers</a></li>
  <li><a href="#making-graphs-publishable" id="toc-making-graphs-publishable" class="nav-link" data-scroll-target="#making-graphs-publishable">Making graphs “publishable”</a></li>
  <li><a href="#exporting-graphics" id="toc-exporting-graphics" class="nav-link" data-scroll-target="#exporting-graphics">Exporting graphics</a></li>
  <li><a href="#further-readings" id="toc-further-readings" class="nav-link" data-scroll-target="#further-readings">Further readings</a></li>
  <li><a href="#exercises-4" id="toc-exercises-4" class="nav-link" data-scroll-target="#exercises-4">Exercises</a></li>
  </ul></li>
  <li><a href="#iteration" id="toc-iteration" class="nav-link" data-scroll-target="#iteration">Iteration</a></li>
  <li><a href="#functionalprogramming" id="toc-functionalprogramming" class="nav-link" data-scroll-target="#functionalprogramming">Flow Control, Functional programming, and iterations</a>
  <ul class="collapse">
  <li><a href="#flow-control" id="toc-flow-control" class="nav-link" data-scroll-target="#flow-control">Flow control</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  <li><a href="#iteration-1" id="toc-iteration-1" class="nav-link" data-scroll-target="#iteration-1">Iteration</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Chapter 2: Brief R Recap</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>I assume your familiarity with R. However, I am fully aware that nobody can have all these things avaible in their head all the time (that’s what they invented StackOverflow for, new AI helpers are also pretty good). In the following, I show some basics of how I use R (i.e., RStudio Projects, scripts, Quarto) as well as some data wrangling stuff (<code>readr</code>, <code>tidyr</code>, <code>dplyr</code>), visualization with <code>ggplot2</code>, functions, loops, and <code>purrr</code>. If you need more info, check out the “further links” I have added after each section. There are also exercises after each section.</p>
<p>You can find the files for this chapter in the <a href="https://github.com/fellennert/toolbox_css/tree/main/data">GitHub repository</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(tidyverse, lubridate, fs, socviz)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>One quick thing upfront: AI coding helpers have become increasingly popular. You can, for instance, use GitHub Copilot in RStudio (if you have access to it) or ChatGPT/Claude (the free versions are already pretty good). However, please note that those tools are not perfect and can produce wrong code. Hence, you need to understand what they do and check the code they provide you with. If you do not understand what a piece of code does, do not use it. If you want to learn R properly, I strongly recommend you to try to write the code yourself first and only use those tools if you get stuck.</p>
<section id="rstudio-projects" class="level2">
<h2 class="anchored" data-anchor-id="rstudio-projects">RStudio Projects</h2>
<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation">Motivation</h3>
<p>Disclaimer: those things might not be entirely clear right away. However, I am deeply convinced that it is important that you use R and RStudio properly from the start. Otherwise it won’t be as easy to re-build the right habits.</p>
<p>If you analyze data with R, one of the first things you do is to load in the data that you want to perform your analyses on. Then, you perform your analyses on them, and save the results in the (probably) same directory.<br>
When you load a data set into R, you might use the <code>readr</code> package and do <code>read_csv(absolute_file_path.csv)</code>. This becomes fairly painful if you need to read in more than one data set. Then, relative paths (i.e., where you start from a certain point in your file structure, e.g., your file folder) become more useful. How you CAN go across this is to use the <code>setwd(absolute_file_path_to_your_directory)</code> function. Here, <code>set</code> stands for set and <code>wd</code> stands for working directory. If you are not sure about what the current working directory actually is, you can use <code>getwd()</code> which is the equivalent to <code>setwd(file_path)</code>. This enables you to read in a data set – if the file is in the working directory – by only using <code>read_csv(file_name.csv)</code>.<br>
However, if you have ever worked on an R project with other people in a group and exchanged scripts regularly, you may have encountered one of the big problems with this <code>setwd(file_path)</code> approach: as it only takes absolute paths like this one: “/Users/felixlennert/Library/Mobile Documents/com<sub>apple</sub>CloudDocs/phd/teaching/hhs-stockholm/fall2021/scripts/”, no other person will be able to run this script without making any changes<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Just to be clear: there are no two machines which have the exact same file structure.</p>
<p>This is where RStudio Projects come into play: they make every file path relative. The Project file (ends with .Rproj) basically sets the working directory to the folder it is in. Hence, if you want to send your work to a peer or a teacher, just send a folder which also contains the .Rproj file and they will be able to work on your project without the hassle of pasting file paths into <code>setwd()</code> commands.</p>
</section>
<section id="how-to-create-an-rstudio-project" class="level3">
<h3 class="anchored" data-anchor-id="how-to-create-an-rstudio-project">How to create an RStudio Project?</h3>
<p>I strongly suggest that you set up a project which is dedicated to this course.</p>
<ol type="1">
<li>In RStudio, click File &gt;&gt; New Project…</li>
<li>A window pops up which lets you select between “New Directory”, “Existing Directory”, and “Version Control.” The first option creates a new folder which is named after your project, the second one “associates a project with an existing working directory,” and the third one only applies to version control (like, for instance, GitHub) users. I suggest that you click “New Directory”.</li>
<li>Now you need to specify the type of the project (Empty project, R package, or Shiny Web Application). In our case, you will need a “new project.” Hit it!<br>
</li>
<li>The final step is to choose the folder the project will live in. If you have already created a folder which is dedicated to this course, choose this one, and let the project live in there as a sub-directory.</li>
<li>When you write code for our course in the future, you <em>first</em> open the R project – by double-clicking the .Rproj file – and then create either a new script or open a former one (e.g., by going through the “Files” tab in the respective pane which will show the right directory already.)</li>
</ol>
</section>
</section>
<section id="r-scripts-and-quarto" class="level2">
<h2 class="anchored" data-anchor-id="r-scripts-and-quarto">R scripts and Quarto</h2>
<p>In this course, you will work with two sorts of documents to store your code in: R scripts (suffix <code>.R</code>) and Quarto documents (suffix <code>.qmd</code>). In the following, I will briefly introduce you to both of them.</p>
<section id="r-scripts" class="level3">
<h3 class="anchored" data-anchor-id="r-scripts">R scripts</h3>
<p>The console, where you can only execute your code, is great for experimenting with R. If you want to store it – e.g., for sharing – you need something different. This is where R scripts come in handy. When you are in RStudio, you create a new script by either clicking <code>File &gt;&gt; New File &gt;&gt; R Script</code> or ctrl/cmd+shift+n.&nbsp;There are multiple ways to run code in the script:</p>
<ul>
<li>cmd/ctrl+return (Mac/Windows) – execute entire expression and jump to next line<br>
</li>
<li>option/alt+return (Mac/Windows) – execute entire expression and remain in line<br>
</li>
<li>cmd/ctrl+shift+return (Mac/Windows) – execute entire script from the beginning to the end (rule: every script you hand in or send to somebody else should run smoothly from the beginning to the end)</li>
</ul>
<p>If you want to make annotations to your code (which you should do because it makes everything easier to read and understand), just insert ‘#’ into your code. Every expression that stands to the right of the ‘#’ sign will not be executed when you run the code.</p>
</section>
<section id="quarto" class="level3">
<h3 class="anchored" data-anchor-id="quarto">Quarto</h3>
<p>A time will come where you will not just do analyses for yourself in R, but you will also have to communicate them. Let’s take a master’s thesis as an example: you need a type of document that is able to encapsulate: text (properly formatted), visualizations (tables, graphs, maybe images), and references. An RMarkdown document can do it all, plus, your entire analysis can live in there as well. So there is no need anymore for the cumbersome process of copying data from MS Excel or IBM SPSS into an MS Word table. You just tell RMarkdown what it should communicate and what not.</p>
<p>In the following, I will not provide you with an exhaustive introduction to RMarkdown. Instead, I will focus on getting you started and then referring you to better, more exhaustive resources. It is not that I am too lazy to write a big tutorial, but there are state-of-the-art tutorials and resources (which mainly come straight from people who work on the forefront of the development of these tools) which are available for free. By linking to them, I want to encourage you to get involved and dig into this stuff. So, let’s get you started!</p>
<p>You create a Quarto document file by clicking <code>File &gt;&gt; New File &gt;&gt; Quarto Document</code>…. Then, a window pops up that looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/quarto_new.png" class="img-fluid figure-img"></p>
<figcaption>New Quarto</figcaption>
</figure>
</div>
<p>Note that you could also do a presentation (with the <code>beamer</code> package), a <code>shiny</code> app, a website (like this one), or use templates. We will focus on simple Quarto documents. Here, you can type in a title, the name(s) of the author(s), and choose the default output format. For now you have to choose one, but later you can switch to one of the others whenever you want to.</p>
<ul>
<li><em>HTML</em> is handy for lightweight, quickly rendered files, or if you want to publish it on a website.</li>
<li><em>PDF</em> is good if you are experienced with LaTeX and want to further modify it in terms of formatting etc., or simply want to get a more formally looking document (I use it if I need to hand in something that is supposed to be graded). If you want to knit to PDF, you need a running LaTeX version on your machine. If you do not have one, I recommend you to install <code>tinytex.</code> I linked installation instructions down below.</li>
<li><em>Word</em> puts out an MS Word document – especially handy if you collaborate with people who are either not experienced in R, like older faculty, or want some parts to be proof-read (remember the Track-Changes function?). Note that you need to have MS Word or LibreOffice installed on your machine.</li>
</ul>
<p>Did you notice the term render? The logic behind Quarto documents is that you edit them in RStudio and then render them. This means that it calls the <code>knitr</code> package. Thereby, all the code you include into the document is executed from scratch. If the code does not work and throws an error, the document will not knit – hence, it needs to be properly written to avoid head-scratching. The <code>knitr</code> package creates a markdown file (suffix: .md). This is then processed by <code>pandoc</code>, a universal document converter. The big advantage of this two-step approach is that it enables a wide range of output formats.</p>
<p>For your first Quarto document, choose HTML and click “OK”. Then, you see a new plain-text file which looks like this:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/quarto_empty.png" class="img-fluid figure-img"></p>
<figcaption>A fresh and clean Quarto document</figcaption>
</figure>
</div>
<p>The visual editor is quite similar to what we know from word processing software such as Microsoft Word. I will run you through the features in a quick video.</p>
</section>
<section id="further-links" class="level3">
<h3 class="anchored" data-anchor-id="further-links">Further links</h3>
<ul>
<li>Chapter on <a href="https://r4ds.hadley.nz/workflow-scripts.html">Scripts and Projects in R4DS</a></li>
<li>More on <a href="https://support.posit.co/hc/en-us/articles/200526207-Using-RStudio-Projects">RStudio Projects on the posit website</a></li>
<li><a href="https://r4ds.hadley.nz/quarto">Chapter on Quarto</a> in R4DS</li>
<li>All things <a href="https://quarto.org/docs/get-started/">Quarto</a> on its dedicated website</li>
<li>Yihui Xie published a <a href="https://yihui.org/tinytex/">manual</a> for installing the <code>tinytex</code> package</li>
</ul>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<ul>
<li>Create a project for this course.</li>
<li>Create a Quarto file to work on the exercises. Add the exercises and answer them <em>in code</em> in the document.</li>
<li>Render it. Does it work?</li>
</ul>
</section>
</section>
<section id="reading-data-into-r" class="level2">
<h2 class="anchored" data-anchor-id="reading-data-into-r">Reading data into R</h2>
<p>Data is typically stored in csv-files and can be read in using <code>readr</code>. For “normal,” comma-separated values <code>read_csv("file_path")</code> suffices. Sometimes, a semicolon is used instead of a comma (e.g., in countries that use the commas as a decimal sign). For these files, <code>read_csv2("file_path)</code> is the way to go.</p>
<p>If you encounter other data types, you just need to find the right <code>tidyverse</code> package to read the data in. Their syntax will be the same, it will just be the function names that differ.</p>
<section id="further-links-1" class="level3">
<h3 class="anchored" data-anchor-id="further-links-1">Further links</h3>
<ul>
<li>the <a href="https://r4ds.hadley.nz/data-import">section on reading in data in R4DS</a></li>
</ul>
</section>
<section id="exercises-1" class="level3">
<h3 class="anchored" data-anchor-id="exercises-1">Exercises</h3>
<p>First, download and extract <a href="https://www.dropbox.com/scl/fi/7apmtufeft01h02yip8e6/training-files.zip?rlkey=k86yaijrfmd5oz4her8jks5gs&amp;dl=1">the zip file</a> by clicking the link. Then…</p>
<p>Read them in using the right functions. Specify the parameters properly. Hints can be found in <code>hints.md</code>. Each file should be stored in an object, names should correspond to the file names.</p>
<p>Note: this is challenging, absolutely. If you have problems, try to google the different functions and think about what the different parameters indicate. If that is to no avail, send me an e-mail. I am very happy to provide you further assistance.</p>
</section>
</section>
<section id="tidy-data-with-tidyr" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data-with-tidyr">Tidy data with <code>tidyr</code></h2>
<p>Before you learn how to tidy and wrangle data, you need to know how you want your data set to actually look like, i.e., what the desired outcome of the entire process of tidying your data set is. The <code>tidyverse</code> is a collection of packages which share an underlying philosophy: they are tidy. This means, that they (preferably) take tidy data as inputs and output tidy data. In the following, I will, first, introduce you to the concept of tidy data as developed by Hadley Wickham <span class="citation" data-cites="wickham_tidy_2014">(<a href="#ref-wickham_tidy_2014" role="doc-biblioref">Wickham 2014</a>)</span>. Second, <code>tidyr</code> is introduced <span class="citation" data-cites="wickham_tidyr_2020">(<a href="#ref-wickham_tidyr_2020" role="doc-biblioref">Wickham 2020b</a>)</span>. Its goal is to provide you with functions that facilitate tidying data sets. Beyond, I will provide you some examples of how to create tibbles using functions from the <code>tibble</code> package <span class="citation" data-cites="muller_tibble_2020">(<a href="#ref-muller_tibble_2020" role="doc-biblioref">Müller, Wickham, and François 2020</a>)</span>. Moreover, the pipe is introduced.</p>
<p>Please note that tidying and cleaning data are not equivalent: I refer to tidying data as to bringing data in a tidy format. Cleaning data, however, can encompass way more than this: parsing columns in the right format (using <code>readr</code>, for instance), imputation of missing values, address the problem of typos, etc.</p>
<section id="the-concept-of-tidy-data" class="level3">
<h3 class="anchored" data-anchor-id="the-concept-of-tidy-data">The concept of <em>tidy data</em></h3>
<p>data sets can be structured in many ways. To make them tidy, they must be organized in the following way (this is taken from the R for Data Science book <span class="citation" data-cites="wickham_data_2016">(<a href="#ref-wickham_data_2016" role="doc-biblioref">Wickham and Grolemund 2016</a>)</span>):</p>
<ol type="1">
<li>Each variable must have its own column.<br>
</li>
<li>Each observation must have its own row.<br>
</li>
<li>Each value must have its own cell.</li>
</ol>
<p>They can even be boiled further down:</p>
<ol type="1">
<li>Put each data set in a tibble.</li>
<li>Put each variable in a column.</li>
</ol>
<p>This can also be visually depicted:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/tidy_data.png" class="img-fluid figure-img"></p>
<figcaption>The three rules that make a data set tidy (taken from Wickham and Grolemund 2016: 149)</figcaption>
</figure>
</div>
<p>This way of storing data has two big advantages:</p>
<ul>
<li>you can easily access, and hence manipulate, variables as vectors</li>
<li>if you perform vectorized operations on the tibble, cases are preserved.</li>
</ul>
</section>
<section id="making-messy-data-tidy" class="level3">
<h3 class="anchored" data-anchor-id="making-messy-data-tidy">Making messy data tidy</h3>
<p>So what are the most common problems with data sets? The following list is taken from the <code>tidyr</code> vignette<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>:</p>
<ul>
<li>Column headers are values, not variable names.<br>
</li>
<li>Variables are stored in both rows and columns.<br>
</li>
<li>Multiple variables are stored in one column.<br>
</li>
<li>Multiple types of observational units are stored in the same table.<br>
</li>
<li>A single observational unit is stored in multiple tables.</li>
</ul>
<p>I will go across the former three types of problems, because the latter two require some more advanced data wrangling techniques you haven’t learned yet (i.e., functions from the <code>dplyr</code> package: <code>select()</code>, <code>mutate()</code>, <code>left_join()</code>, among others).</p>
<p>In the following, I will provide you with examples on how this might look like and how you can address the respective problem using functions from the <code>tidyr</code> package. This will serve as an introduction to the two most important functions of the <code>tidyr</code> package: <code>pivot_longer()</code> and its counterpart <code>pivot_wider()</code>. Beyond that, <code>separate()</code> will be introduced as well. At the beginning of every part, I will build the tibble using functions from the tibble package. This should suffice as a quick refresher for and introduction to creating tibbles.</p>
<p><code>tidyr</code> has some more functions in stock. They do not necessarily relate to transforming messy data sets into tidy ones, but also serve you well for some general cleaning tasks. They will be introduced, too.</p>
<section id="column-headers-are-values" class="level4">
<h4 class="anchored" data-anchor-id="column-headers-are-values">Column headers are values</h4>
<p>A data set of this form would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>tibble_value_headers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">manufacturer =</span> <span class="fu">c</span>(<span class="st">"Audi"</span>, <span class="st">"BMW"</span>, <span class="st">"Mercedes"</span>, <span class="st">"Opel"</span>, <span class="st">"VW"</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">3 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">20</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">4 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">50</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">5 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">6 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">30</span><span class="sc">:</span><span class="dv">50</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">8 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">20</span><span class="sc">:</span><span class="dv">40</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">10 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">12 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">20</span>, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">16 cyl</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>tibble_value_headers</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 9
  manufacturer `3 cyl` `4 cyl` `5 cyl` `6 cyl` `8 cyl` `10 cyl` `12 cyl`
  &lt;chr&gt;          &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;    &lt;int&gt;    &lt;int&gt;
1 Audi               2      88       2      41      30        8        1
2 BMW                5      93       9      49      29        8        7
3 Mercedes           2      50       6      49      22        2        8
4 Opel               3      54       3      43      25       10       19
5 VW                 4      70      10      35      39        3       19
# ℹ 1 more variable: `16 cyl` &lt;dbl&gt;</code></pre>
</div>
</div>
<p>You can create a tibble <em>by column</em> using the <code>tibble</code> function. Column names need to be specified and linked to vectors of either the same length or length one.</p>
<p>This data set basically consists of three variables: <code>German car manufacturer</code>, <code>number of cylinders</code>, and <code>frequency</code>. To make the data set tidy, it has to consist of three columns depicting the three respective variables. This operation is called pivoting the non-variable columns into two-column key-value pairs. As the data set will thereafter contain fewer columns and more rows than before, it will have become longer (or taller). Hence, the tidyr function is called <code>pivot_longer()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer <span class="ot">&lt;-</span> tibble_value_headers <span class="sc">|&gt;</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>manufacturer, <span class="at">names_to =</span> <span class="st">"cylinders"</span>, <span class="at">values_to =</span> <span class="st">"frequency"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 3
   manufacturer cylinders frequency
   &lt;chr&gt;        &lt;chr&gt;         &lt;dbl&gt;
 1 Audi         3 cyl             2
 2 Audi         4 cyl            88
 3 Audi         5 cyl             2
 4 Audi         6 cyl            41
 5 Audi         8 cyl            30
 6 Audi         10 cyl            8
 7 Audi         12 cyl            1
 8 Audi         16 cyl            0
 9 BMW          3 cyl             5
10 BMW          4 cyl            93
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>In the function call, you need to specify the following: if you were not to use the pipe, the first argument would be the tibble you are manipulating. Then, you look at the column you want to <strong>keep</strong>. Here, it is the car manufacturer. This means that all columns but <code>manufacturer</code> will be crammed into two new ones: one will contain the columns’ names, the other one their values. How are those new column supposed to be named? That can be specified in the <code>names_to =</code> and <code>values_to =</code>arguments. Please note that you need to provide them a character vector, hence, surround your parameters with quotation marks. As a rule of thumb for all <code>tidyverse</code> packages: If it is a new column name you provide, surround it with quotation marks. If it is one that already exists – like, here, manufacturer, then you do not need the quotation marks.</p>
</section>
<section id="variables-in-both-rows-and-columns" class="level4">
<h4 class="anchored" data-anchor-id="variables-in-both-rows-and-columns">Variables in both rows and columns</h4>
<p>You have this data set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>car_models_fuel <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>manufacturer, <span class="sc">~</span>model, <span class="sc">~</span>cylinders, <span class="sc">~</span>fuel_consumption_type, <span class="sc">~</span>fuel_consumption_per_100km,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VW"</span>, <span class="st">"Golf"</span>, <span class="dv">4</span>, <span class="st">"urban"</span>, <span class="fl">5.2</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"VW"</span>, <span class="st">"Golf"</span>, <span class="dv">4</span>, <span class="st">"extra urban"</span>, <span class="fl">4.5</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Opel"</span>, <span class="st">"Adam"</span>, <span class="dv">4</span>, <span class="st">"urban"</span>, <span class="fl">4.9</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Opel"</span>, <span class="st">"Adam"</span>, <span class="dv">4</span>, <span class="st">"extra urban"</span>, <span class="fl">4.1</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>car_models_fuel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 5
  manufacturer model cylinders fuel_consumption_type fuel_consumption_per_100km
  &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;                                      &lt;dbl&gt;
1 VW           Golf          4 urban                                        5.2
2 VW           Golf          4 extra urban                                  4.5
3 Opel         Adam          4 urban                                        4.9
4 Opel         Adam          4 extra urban                                  4.1</code></pre>
</div>
</div>
<p>It was created using the <code>tribble</code> function: tibbles can also be created <em>by row</em>. First, the column names need to be specified by putting a tilde (<code>~</code>) in front of them. Then, you can put in values separated by commas. Please note that the number of values needs to be a multiple of the number of columns.</p>
<p>In this data set, there are basically five variables: manufacturer, model, cylinders, urban fuel consumption, and extra urban fuel consumption. However, the column <code>fuel_consumption_type</code> does not store a variable but the names of two variables. Hence, you need to fix this to make the data set tidy. Because this encompasses reducing the number of rows, the data set becomes wider. The function to achieve this is therefore called <code>pivot_wider()</code> and the inverse of <code>pivot_longer()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>car_models_fuel_tidy <span class="ot">&lt;-</span> car_models_fuel <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> fuel_consumption_type, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> fuel_consumption_per_100km</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>car_models_fuel_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  manufacturer model cylinders urban `extra urban`
  &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
1 VW           Golf          4   5.2           4.5
2 Opel         Adam          4   4.9           4.1</code></pre>
</div>
</div>
<p>Here, you only need to specify the columns you fetch the names and values from. As they both do already exist, you do not need to wrap them in quotation marks.</p>
</section>
<section id="multiple-variables-in-one-column" class="level4">
<h4 class="anchored" data-anchor-id="multiple-variables-in-one-column">Multiple variables in one column</h4>
<p>Now, however, there is a problem with the cylinders: their number should be depicted in a numeric vector. We could achieve this by either parsing it to a numeric vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer<span class="sc">$</span>cylinders <span class="ot">&lt;-</span> <span class="fu">parse_number</span>(ger_car_manufacturer_longer<span class="sc">$</span>cylinders)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On the other hand, we can also use a handy function from <code>tidyr</code> called <code>separate()</code> and afterwards drop the unnecessary column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer_sep_cyl <span class="ot">&lt;-</span> ger_car_manufacturer_longer <span class="sc">|&gt;</span> <span class="co"># first, take the tibble</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(cylinders, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cylinders"</span>, <span class="st">"drop_it"</span>), <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">|&gt;</span> <span class="co"># and then split the column "cylinders" into two</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>drop_it) <span class="co"># you will learn about this in the lesson on dplyr  # and then drop one column from the tibble</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 2 pieces. Missing pieces filled with `NA` in 40 rows [1, 2, 3, 4, 5,
6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
</div>
<p>If there are two (or actually more) relevant values in one column, you can simply let out the dropping process and easily split them into multiple columns. By default, the <code>sep =</code> argument divides the content by all non-alphanumeric characters (every character that is not a letter, number, or space) it contains.</p>
<p>Please note that the new column is still in character format. We can change this using <code>as.numeric()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer_sep_cyl<span class="sc">$</span>cylinders <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ger_car_manufacturer_longer_sep_cyl<span class="sc">$</span>cylinders)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Furthermore, you might want to sort your data in a different manner. If you want to do this by cylinders, it would look like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(ger_car_manufacturer_longer_sep_cyl, cylinders)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 3
   manufacturer cylinders frequency
   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
 1 Audi                 3         2
 2 BMW                  3         5
 3 Mercedes             3         2
 4 Opel                 3         3
 5 VW                   3         4
 6 Audi                 4        88
 7 BMW                  4        93
 8 Mercedes             4        50
 9 Opel                 4        54
10 VW                   4        70
# ℹ 30 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="insertion-the-pipe" class="level3">
<h3 class="anchored" data-anchor-id="insertion-the-pipe">Insertion: the pipe</h3>
<p>Have you noticed the <code>|&gt;</code>? That’s the pipe. It can be considered a conjunction in coding. Usually, you will use it when working with tibbles. What it does is pretty straight-forward: it takes what is on its left – the input – and provides it to the function on its right as the first argument. Hence, the code in the last chunk, which looks like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(ger_car_manufacturer_longer_sep_cyl, cylinders)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 3
   manufacturer cylinders frequency
   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
 1 Audi                 3         2
 2 BMW                  3         5
 3 Mercedes             3         2
 4 Opel                 3         3
 5 VW                   3         4
 6 Audi                 4        88
 7 BMW                  4        93
 8 Mercedes             4        50
 9 Opel                 4        54
10 VW                   4        70
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>could have also been written like this</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer_sep_cyl <span class="sc">|&gt;</span> <span class="fu">arrange</span>(cylinders)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 40 × 3
   manufacturer cylinders frequency
   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;
 1 Audi                 3         2
 2 BMW                  3         5
 3 Mercedes             3         2
 4 Opel                 3         3
 5 VW                   3         4
 6 Audi                 4        88
 7 BMW                  4        93
 8 Mercedes             4        50
 9 Opel                 4        54
10 VW                   4        70
# ℹ 30 more rows</code></pre>
</div>
</div>
<p>because the tibble is the first argument in the function call.</p>
<p>Because the pipe (its precedessor was <code>%&gt;%</code>) has really gained traction in the R community, many functions are now optimized for being used with the pipe. However, there are still some around which are not. A function for fitting a basic linear model with one dependent and one independent variable which are both stored in a tibble looks like this: <code>lm(formula = dv ~ iv, data = tibble)</code>. Here, the tibble is not the first argument. To be able to fit a linear model in a “pipeline,” you need to employ a little hack: you can use an underscore <code>_</code> as a placeholder. Here, it is important that the argument is named.</p>
<p>Let’s check out the effect the number of cylinders has on the number of models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ger_car_manufacturer_longer_sep_cyl <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(frequency <span class="sc">~</span> cylinders, <span class="at">data =</span> _) <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = frequency ~ cylinders, data = ger_car_manufacturer_longer_sep_cyl)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.852 -15.302  -0.957  10.285  61.678 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  41.4435     7.7946   5.317 4.91e-06 ***
cylinders    -2.5304     0.8647  -2.926  0.00576 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 22.71 on 38 degrees of freedom
Multiple R-squared:  0.1839,    Adjusted R-squared:  0.1624 
F-statistic: 8.563 on 1 and 38 DF,  p-value: 0.005762</code></pre>
</div>
</div>
<p>As <code>|&gt;</code> is a bit tedious to type, a shortcut exists: <code>shift-ctrl-m</code>.</p>
</section>
<section id="splitting-and-merging-cells" class="level3">
<h3 class="anchored" data-anchor-id="splitting-and-merging-cells">Splitting and merging cells</h3>
<p>If there are multiple values in one column/cell and you want to split them and put them into two rows instead of columns, <code>tidyr</code> offers you the <code>separate_rows()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>german_cars_vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Audi =</span> <span class="st">"A1, A3, A4, A5, A6, A7, A8"</span>, </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">BMW =</span> <span class="st">"1 Series, 2 Series, 3 Series, 4 Series, 5 Series, 6 Series, 7 Series, 8 Series"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>german_cars_tbl <span class="ot">&lt;-</span> <span class="fu">enframe</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  german_cars_vec, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="st">"brand"</span>, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="st">"model"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>german_cars_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  brand model                                                                   
  &lt;chr&gt; &lt;chr&gt;                                                                   
1 Audi  A1, A3, A4, A5, A6, A7, A8                                              
2 BMW   1 Series, 2 Series, 3 Series, 4 Series, 5 Series, 6 Series, 7 Series, 8…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>tidy_german_cars_tbl <span class="ot">&lt;-</span> german_cars_tbl <span class="sc">|&gt;</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(model, <span class="at">sep =</span> <span class="st">", "</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>enframe()</code> enables you to create a tibble from a (named) vector. It outputs a tibble with two columns (<code>name</code> and <code>value</code> by default): <code>name</code> contains the names of the elements (if the elements are unnamed, it contains a serial number), <code>value</code> the element. Both can be renamed in the function call by providing a character vector.</p>
<p>If you want to achieve the opposite, i.e., merge cells’ content, you can use the counterpart, <code>unite()</code>. Let’s take the following dataframe which consists of the names of the professors of the Institute for Political Science of the University of Regensburg:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>professor_names_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">first_name =</span> <span class="fu">c</span>(<span class="st">"Karlfriedrich"</span>, <span class="st">"Martin"</span>, <span class="st">"Jerzy"</span>, <span class="st">"Stephan"</span>, <span class="st">"Melanie"</span>),</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">last_name =</span> <span class="fu">c</span>(<span class="st">"Herb"</span>, <span class="st">"Sebaldt"</span>, <span class="st">"Maćków"</span>, <span class="st">"Bierling"</span>, <span class="st">"Walter-Rogg"</span>))</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>professor_names_tbl <span class="ot">&lt;-</span> professor_names_df <span class="sc">|&gt;</span> </span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(first_name, last_name, <span class="at">col =</span> <span class="st">"name"</span>, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>professor_names_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 1
  name               
  &lt;chr&gt;              
1 Karlfriedrich Herb 
2 Martin Sebaldt     
3 Jerzy Maćków       
4 Stephan Bierling   
5 Melanie Walter-Rogg</code></pre>
</div>
</div>
<p><code>unite()</code> takes the tibble it should be applied to as the first argument (not necessary if you use the pipe). Then, it takes the two or more columns as arguments (actually, this is not necessary if you want to unite all columns). <code>col =</code> takes a character vector to specify the name of the resulting, new column. <code>remove = TRUE</code> indicates that the columns that are united are removed as well. You can, of course, set it to false, too. <code>na.rm = FALSE</code> finally indicates that missing values are not to be removed prior to the uniting process.</p>
<p>Here, the final variant of creating tibbles is introduced as well: you can apply the function <code>as_tibble()</code> to a data frame and it will then be transformed into a tibble.</p>
</section>
<section id="further-links-2" class="level3">
<h3 class="anchored" data-anchor-id="further-links-2">Further links</h3>
<ul>
<li>Hadley on <a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a><br>
</li>
<li>The two <code>pivot_*()</code> functions lie at the heart of <code>tidyr</code>. <a href="https://www.storybench.org/pivoting-data-from-columns-to-rows-and-back-in-the-tidyverse/">This article</a> from the Northeastern University’s School of Journalism explains it in further detail.</li>
</ul>
</section>
<section id="exercises-2" class="level3">
<h3 class="anchored" data-anchor-id="exercises-2">Exercises</h3>
<p>Bring the data sets you read into R in the “Reading data in R” section into a tidy format. Store the tidy data sets in a new object, named like the former object plus the suffix “_tidy” – e.g., <code>books_tidy</code>. If no tidying is needed, you do not have to create a new object. The pipe operator should be used to connect the different steps.</p>
</section>
</section>
<section id="wrangling-data-with-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="wrangling-data-with-dplyr">Wrangling data with <code>dplyr</code></h2>
<p>The last chapter showed you four things: how you get data sets into R, a couple of ways to create tibbles, how to pass data to functions using the pipe (<code>|&gt;</code>), and an introduction to tidy data and how to make data sets tidy using the <code>tidyr</code> package <span class="citation" data-cites="wickham_tidyr_2020">(<a href="#ref-wickham_tidyr_2020" role="doc-biblioref">Wickham 2020b</a>)</span>. What you haven’t learned was how you can actually manipulate the data themselves. In the <code>tidyverse</code> framework <span class="citation" data-cites="wickham_welcome_2019">(<a href="#ref-wickham_welcome_2019" role="doc-biblioref">Wickham et al. 2019</a>)</span>, the package which enables you to accomplish those tasks is <code>dplyr</code> <span class="citation" data-cites="wickham_dplyr_2020">(<a href="#ref-wickham_dplyr_2020" role="doc-biblioref">Wickham 2020a</a>)</span>.</p>
<p><code>dplyr</code> joined the party in 2014, building upon the <code>plyr</code> package. The d in <code>dplyr</code> stands for data set and <code>dplyr</code> works with tibbles (or data frames) only.</p>
<p>It consists of five main functions, the “verbs”:</p>
<ul>
<li><code>arrange()</code> – sort values</li>
<li><code>filter()</code> – pick observations</li>
<li><code>mutate()</code> – create new variables (columns)</li>
<li><code>select()</code> – select variables</li>
<li><code>summarize()</code> – create summaries from multiple values</li>
</ul>
<p>They are joined by <code>group_by()</code>, a function that changes the scope on which entities the functions are applied to.</p>
<p>Furthermore, diverse <code>bind_</code> functions and <code>_join</code>s enable you to combine multiple tibbles into one. They will be introduced later.</p>
<p>In the following, I will guide you through how you can use the verbs to accomplish whatever goals which require data wrangling you might have.</p>
<p>The data set I will use here consists of the 1,000 most popular movies on IMDb which were published between 2006 and 2016 and some data on them. It was created by PromptCloud and DataStock and published on Kaggle, more information can be found <a href="https://www.kaggle.com/PromptCloudHQ/imdb-data">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/imdb2006-2016.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data set hasn’t been modified by me before. I will show you how I would go across it using a couple of <code>dplyr</code> functions.</p>
<section id="select" class="level3">
<h3 class="anchored" data-anchor-id="select"><code>select()</code></h3>
<p><code>select</code> enables you to <em>select</em> columns. Since we are dealing with tidy data, every variable has its own column.</p>
<p><code>glimpse()</code> provides you with an overview of the data set and its columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(imdb_raw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 12
$ Rank                 &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15…
$ Title                &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split",…
$ Genre                &lt;chr&gt; "Action,Adventure,Sci-Fi", "Adventure,Mystery,Sci…
$ Description          &lt;chr&gt; "A group of intergalactic criminals are forced to…
$ Director             &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan…
$ Actors               &lt;chr&gt; "Chris Pratt, Vin Diesel, Bradley Cooper, Zoe Sal…
$ Year                 &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2…
$ `Runtime (Minutes)`  &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, …
$ Rating               &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0,…
$ Votes                &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258…
$ `Revenue (Millions)` &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 15…
$ Metascore            &lt;dbl&gt; 76, 65, 62, 59, 40, 42, 93, 71, 78, 41, 66, 74, 6…</code></pre>
</div>
</div>
<p>The columns I want to keep are: <code>Title</code>, <code>Director</code>, <code>Year</code>, <code>Runtime (Minutes)</code>, <code>Rating</code>, <code>Votes</code>, and <code>Revenue (Millions)</code>. Furthermore, I want to rename the columns: every column’s name should be in lowercase and a regular name that does not need to be surrounded by back ticks – i.e., a name that only consists of characters, numbers, underscores, or dots.</p>
<p>This can be achieved in a couple of ways:</p>
<p>First, by choosing the columns column by column and subsequently renaming them:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="sc">|&gt;</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Title, Director, Year, <span class="st">`</span><span class="at">Runtime (Minutes)</span><span class="st">`</span>, Rating, Votes, <span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">title =</span> Title, <span class="at">director =</span> Director, <span class="at">year =</span> Year, <span class="at">runtime =</span> <span class="st">`</span><span class="at">Runtime (Minutes)</span><span class="st">`</span>, <span class="at">rating =</span> Rating, <span class="at">votes =</span> Votes, <span class="at">revenue_million =</span> <span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<p>Second, the columns can also be chosen vice versa: unnecessary columns can be dropped using a minus:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="sc">|&gt;</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Rank, <span class="sc">-</span>Genre, <span class="sc">-</span>Description, <span class="sc">-</span>Actors, <span class="sc">-</span>Metascore) <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">title =</span> Title, <span class="at">director =</span> Director, <span class="at">year =</span> Year, <span class="at">runtime =</span> <span class="st">`</span><span class="at">Runtime (Minutes)</span><span class="st">`</span>, <span class="at">rating =</span> Rating, <span class="at">votes =</span> Votes, <span class="at">revenue_million =</span> <span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<p>Columns can also be renamed in the selecting process:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="sc">|&gt;</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">title =</span> Title, <span class="at">director =</span> Director, <span class="at">year =</span> Year, <span class="at">runtime =</span> <span class="st">`</span><span class="at">Runtime (Minutes)</span><span class="st">`</span>, <span class="at">rating =</span> Rating, <span class="at">votes =</span> Votes, <span class="at">revenue_million =</span> <span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<p>You can also make your expressions shorter by using a couple of hacks:</p>
<p><code>:</code> can be used to select all columns between two:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>imdb_raw <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Title, Director, Year<span class="sc">:</span><span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">title =</span> Title, <span class="at">director =</span> Director, <span class="at">year =</span> Year, <span class="at">runtime =</span> <span class="st">`</span><span class="at">Runtime (Minutes)</span><span class="st">`</span>, <span class="at">rating =</span> Rating, <span class="at">votes =</span> Votes, <span class="at">revenue_million =</span> <span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<p><code>starts_with()</code> select columns whose names start with the same character string:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="ot">&lt;-</span> imdb_raw <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Title, Director, Votes, Year, <span class="fu">starts_with</span>(<span class="st">"R"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Rank) <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">title =</span> Title, <span class="at">director =</span> Director, <span class="at">year =</span> Year, <span class="at">runtime =</span> <span class="st">`</span><span class="at">Runtime (Minutes)</span><span class="st">`</span>, <span class="at">rating =</span> Rating, <span class="at">votes =</span> Votes, <span class="at">revenue_million =</span> <span class="st">`</span><span class="at">Revenue (Millions)</span><span class="st">`</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<p>As you may have noticed, the order in the <code>select()</code> matters: columns will be ordered in the same order as they are chosen.</p>
<p>A couple of further shortcuts for <code>select()</code> do exist. An overview can be found in the <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf"><code>dplyr</code> cheatsheet</a>.</p>
</section>
<section id="filter" class="level3">
<h3 class="anchored" data-anchor-id="filter"><code>filter()</code></h3>
<p>Whereas <code>select()</code> enables you to choose variables (i.e., columns), <code>filter()</code> lets you choose observations (i.e., rows).</p>
<p>In this case, I only want movies with a revenue above $100,000,000:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(revenue_million <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 250
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 258682, 192177,…
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 128, 116, 133, 127, 133, 107,…
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 8.3, 7.0, 7.5, 7.8, 7.9, 7.7,…
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 151.06, 100.01…</code></pre>
</div>
</div>
<p>Besides, I am especially interested in the director Christopher Nolan. Therefore, I want to look at movies that were directed by him and made more than $100,000,000:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(revenue_million <span class="sc">&gt;</span> <span class="dv">100</span> <span class="sc">&amp;</span> director <span class="sc">==</span> <span class="st">"Christopher Nolan"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4
Columns: 7
$ title           &lt;chr&gt; "Interstellar", "The Dark Knight", "Inception", "The D…
$ director        &lt;chr&gt; "Christopher Nolan", "Christopher Nolan", "Christopher…
$ votes           &lt;dbl&gt; 1047747, 1791916, 1583625, 1222645
$ year            &lt;dbl&gt; 2014, 2008, 2010, 2012
$ runtime         &lt;dbl&gt; 169, 152, 148, 164
$ rating          &lt;dbl&gt; 8.6, 9.0, 8.8, 8.5
$ revenue_million &lt;dbl&gt; 187.99, 533.32, 292.57, 448.13</code></pre>
</div>
</div>
<p>The following overview is taken from the <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf"><code>dplyr</code> cheatsheet</a> and shows the operators you can use in <code>filter()</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/operators.png" class="img-fluid figure-img"></p>
<figcaption>Overview of comparison operators</figcaption>
</figure>
</div>
<section id="exemplary-application" class="level4">
<h4 class="anchored" data-anchor-id="exemplary-application">Exemplary application</h4>
<p>To demonstrate how a real-world application of this stuff could look like, I will now provide you a brief insight into my private life and how I organize movie nights. JK. You could definitely try this at home and surprise your loved ones with such hot applications. If you are brave and surprise your latest Tinder match with an .RDS file containing suggestions for Netflix&amp;Chill, please let me know what their response looked like.</p>
<p>Tonight, I will hang out with a real nerd. Probably because they (nerds have all kinds of genders) know about my faible for R, they have sent me a vector containing a couple of movies we could watch tonight:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># guarantees that movie_vec will always be the same thing</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>movie_vec <span class="ot">&lt;-</span> imdb_raw<span class="sc">$</span>Title[<span class="fu">sample</span>(<span class="dv">1000</span>, <span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>)]</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>movie_vec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Mechanic: Resurrection" "Denial"                 "The Conjuring 2"       
 [4] "Birth of the Dragon"    "Warrior"                "Super"                 
 [7] "127 Hours"              "Dangal"                 "The Infiltrator"       
[10] "Maleficent"            </code></pre>
</div>
</div>
<p>However, I want to make a more informed decision and decide to obtain some more information on the movies from my IMDb data set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(title <span class="sc">%in%</span> movie_vec) <span class="sc">|&gt;</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 10
Columns: 7
$ title           &lt;chr&gt; "Dangal", "The Conjuring 2", "Warrior", "Maleficent", …
$ director        &lt;chr&gt; "Nitesh Tiwari", "James Wan", "Gavin O'Connor", "Rober…
$ votes           &lt;dbl&gt; 48969, 137203, 355722, 268877, 43929, 48161, 8229, 552…
$ year            &lt;dbl&gt; 2016, 2016, 2011, 2014, 2016, 2016, 2016, 2016, 2010, …
$ runtime         &lt;dbl&gt; 161, 134, 140, 97, 127, 98, 109, 103, 94, 96
$ rating          &lt;dbl&gt; 8.8, 7.4, 8.2, 7.0, 7.1, 5.6, 6.6, 3.9, 7.6, 6.8
$ revenue_million &lt;dbl&gt; 11.15, 102.46, 13.65, 241.41, 15.43, 21.20, 4.07, 93.0…</code></pre>
</div>
</div>
<p>I have convinced them to watch either one of the movies they have suggested or one directed by Christopher Nolan or one with a rating greater or equal to 8.5 and send them back this data set:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(title <span class="sc">%in%</span> movie_vec <span class="sc">|</span> director <span class="sc">==</span> <span class="st">"Christopher Nolan"</span> <span class="sc">|</span> rating <span class="sc">&gt;=</span> <span class="fl">8.5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 21
Columns: 7
$ title           &lt;chr&gt; "Interstellar", "The Dark Knight", "The Prestige", "In…
$ director        &lt;chr&gt; "Christopher Nolan", "Christopher Nolan", "Christopher…
$ votes           &lt;dbl&gt; 1047747, 1791916, 913152, 1583625, 34110, 937414, 4896…
$ year            &lt;dbl&gt; 2014, 2008, 2006, 2010, 2016, 2006, 2016, 2012, 2014, …
$ runtime         &lt;dbl&gt; 169, 152, 130, 148, 106, 151, 161, 164, 107, 134, 140,…
$ rating          &lt;dbl&gt; 8.6, 9.0, 8.5, 8.8, 8.6, 8.5, 8.8, 8.5, 8.5, 7.4, 8.2,…
$ revenue_million &lt;dbl&gt; 187.99, 533.32, 53.08, 292.57, 4.68, 132.37, 11.15, 44…</code></pre>
</div>
</div>
<p>“I deteste ‘Interstellar’,” is the response. “All right,” I say to myself, “I can easily exclude it.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(title <span class="sc">%in%</span> movie_vec <span class="sc">|</span> director <span class="sc">==</span> <span class="st">"Christopher Nolan"</span> <span class="sc">|</span> rating <span class="sc">&gt;=</span> <span class="fl">8.5</span> <span class="sc">&amp;</span> title <span class="sc">!=</span> <span class="st">"Interstellar"</span>) <span class="sc">|&gt;</span> <span class="co"># if you want to negate something, put the ! in front of it</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 21
Columns: 7
$ title           &lt;chr&gt; "Interstellar", "The Dark Knight", "The Prestige", "In…
$ director        &lt;chr&gt; "Christopher Nolan", "Christopher Nolan", "Christopher…
$ votes           &lt;dbl&gt; 1047747, 1791916, 913152, 1583625, 34110, 937414, 4896…
$ year            &lt;dbl&gt; 2014, 2008, 2006, 2010, 2016, 2006, 2016, 2012, 2014, …
$ runtime         &lt;dbl&gt; 169, 152, 130, 148, 106, 151, 161, 164, 107, 134, 140,…
$ rating          &lt;dbl&gt; 8.6, 9.0, 8.5, 8.8, 8.6, 8.5, 8.8, 8.5, 8.5, 7.4, 8.2,…
$ revenue_million &lt;dbl&gt; 187.99, 533.32, 53.08, 292.57, 4.68, 132.37, 11.15, 44…</code></pre>
</div>
</div>
<p>Oh, that did not work. I should wrap them in columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((title <span class="sc">%in%</span> movie_vec <span class="sc">|</span> director <span class="sc">==</span> <span class="st">"Christopher Nolan"</span> <span class="sc">|</span> rating <span class="sc">&gt;=</span> <span class="fl">8.5</span>) <span class="sc">&amp;</span> title <span class="sc">!=</span> <span class="st">"Interstellar"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 20
Columns: 7
$ title           &lt;chr&gt; "The Dark Knight", "The Prestige", "Inception", "Kimi …
$ director        &lt;chr&gt; "Christopher Nolan", "Christopher Nolan", "Christopher…
$ votes           &lt;dbl&gt; 1791916, 913152, 1583625, 34110, 937414, 48969, 122264…
$ year            &lt;dbl&gt; 2008, 2006, 2010, 2016, 2006, 2016, 2012, 2014, 2016, …
$ runtime         &lt;dbl&gt; 152, 130, 148, 106, 151, 161, 164, 107, 134, 140, 97, …
$ rating          &lt;dbl&gt; 9.0, 8.5, 8.8, 8.6, 8.5, 8.8, 8.5, 8.5, 7.4, 8.2, 7.0,…
$ revenue_million &lt;dbl&gt; 533.32, 53.08, 292.57, 4.68, 132.37, 11.15, 448.13, 13…</code></pre>
</div>
</div>
<p>They come up with a new idea: we have a Scottish evening with a movie directed by the Scottish director Gillies MacKinnon:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(director <span class="sc">==</span> <span class="st">"Gillies MacKinnon"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 7
$ title           &lt;chr&gt; "Whisky Galore"
$ director        &lt;chr&gt; "Gillies MacKinnon"
$ votes           &lt;dbl&gt; 102
$ year            &lt;dbl&gt; 2016
$ runtime         &lt;dbl&gt; 98
$ rating          &lt;dbl&gt; 5
$ revenue_million &lt;dbl&gt; NA</code></pre>
</div>
</div>
<p>“Well, apparently there is a problem in the data set,” I notice. “There is an NA in the revenue column. I should probably have a further look at this.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(revenue_million)) <span class="sc">|&gt;</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 128
Columns: 7
$ title           &lt;chr&gt; "Mindhorn", "Hounds of Love", "Paris pieds nus", "5- 2…
$ director        &lt;chr&gt; "Sean Foley", "Ben Young", "Dominique Abel", "Patrick …
$ votes           &lt;dbl&gt; 2490, 1115, 222, 241, 496, 5103, 987, 35870, 149791, 7…
$ year            &lt;dbl&gt; 2016, 2016, 2016, 2007, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 89, 108, 83, 113, 73, 91, 130, 86, 133, 106, 105, 118,…
$ rating          &lt;dbl&gt; 6.4, 6.7, 6.8, 7.1, 2.7, 5.6, 3.7, 6.8, 5.9, 7.9, 5.8,…
$ revenue_million &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</code></pre>
</div>
</div>
<p>Well, that’s quite a significant number of NAs. I will need to exclude these cases:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(revenue_million)) <span class="sc">|&gt;</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 872
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 141, 116, 133, 127,…
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 7.1, 7.0, 7.5, 7.8,…
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
</section>
<section id="other-possibilities-to-subset-observations" class="level4">
<h4 class="anchored" data-anchor-id="other-possibilities-to-subset-observations">Other possibilities to subset observations</h4>
<p><code>slice()</code> selects rows by positions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 10
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(revenue_million, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 10
Columns: 7
$ title           &lt;chr&gt; "A Kind of Murder", "Dead Awake", "Wakefield", "Loveso…
$ director        &lt;chr&gt; "Andy Goddard", "Phillip Guzman", "Robin Swicord", "So…
$ votes           &lt;dbl&gt; 3305, 523, 291, 616, 80415, 10220, 36091, 54027, 4155,…
$ year            &lt;dbl&gt; 2016, 2016, 2016, 2016, 2014, 2015, 2010, 2012, 2015, …
$ runtime         &lt;dbl&gt; 95, 99, 106, 84, 102, 101, 98, 95, 93, 110
$ rating          &lt;dbl&gt; 5.2, 4.7, 7.5, 6.4, 7.2, 5.9, 6.5, 6.9, 5.6, 5.9
$ revenue_million &lt;dbl&gt; 0.00, 0.01, 0.01, 0.01, 0.01, 0.01, 0.02, 0.02, 0.02, …</code></pre>
</div>
</div>
<p><code>distinct</code> removes duplicate rows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(director) <span class="sc">|&gt;</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 644
Columns: 1
$ director &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "Christop…</code></pre>
</div>
</div>
<p>By default, it will remove all other columns apart from the one(s) you have specified. You can avoid that by setting <code>.keep_all = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(title, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 999
Columns: 7
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…</code></pre>
</div>
</div>
<p>Oh, interesting, there is apparently one movie which is in there twice. How could we find this movie?</p>
</section>
</section>
<section id="mutate" class="level3">
<h3 class="anchored" data-anchor-id="mutate"><code>mutate()</code></h3>
<p>My data set looks pretty nice already, but one flaw catches the eye: the column <code>revenue_million</code> should probably be converted to <code>revenue</code>. Hence, I need to create a new variable which contains the values from <code>revenue_million</code> multiplied by 1,000,000 and drop the now obsolete <code>revenue_million</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">revenue =</span> revenue_million <span class="sc">*</span> <span class="dv">1000000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>revenue_million) <span class="sc">|&gt;</span> </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 7
$ title    &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sing", "Su…
$ director &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "Christop…
$ votes    &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, 2490, 7…
$ year     &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2016, 2…
$ runtime  &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, 127, 13…
$ rating   &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5, 7.8, 7…
$ revenue  &lt;dbl&gt; 333130000, 126460000, 138120000, 270320000, 325020000, 451300…</code></pre>
</div>
</div>
<p>The structure of the <code>mutate()</code> call looks like this: first, you need to provide the name of the new variable. If the variable exists already, it will be replaced. Second, the equal sign tells R what the new variable should contain. Third, a function that outputs a vector which is as long as the tibble has rows or 1.</p>
<p>If we want to drop all other columns and just keep the new one: <code>transmute()</code> drops all the original columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">revenue =</span> revenue_million <span class="sc">*</span> <span class="dv">1000000</span>) <span class="sc">|&gt;</span> </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 1
$ revenue &lt;dbl&gt; 333130000, 126460000, 138120000, 270320000, 325020000, 4513000…</code></pre>
</div>
</div>
<p><code>mutate()</code> uses so-called <em>window functions</em>. They take one vector of values and return another vector of values. An overview – again, from the cheat sheet:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/window_functions.png" class="img-fluid figure-img"></p>
<figcaption>Window functions</figcaption>
</figure>
</div>
<p>Another feature of <code>dplyr</code>, which is useful in combination with <code>mutate()</code>, is <code>case_when()</code>.</p>
<p><code>case_when()</code> can for instance be used to create binary indicator variables. In this example I want it to be 0 if the movie was made before 2010 and 1 if not. <code>case_when()</code> works like this: first, you provide a condition (e.g., <code>year &lt; 2010</code>). Second, you provide what the output should be if the condition is met (here, <code>0</code>). Third, you can provide as many conditions as you want. Finally, you can provide a default value using <code>TRUE ~ value</code>. If none of the conditions are met, the default value will be assigned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">indicator =</span> <span class="fu">case_when</span>(year <span class="sc">&lt;</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>                               year <span class="sc">&gt;=</span> <span class="dv">2010</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,000
Columns: 8
$ title           &lt;chr&gt; "Guardians of the Galaxy", "Prometheus", "Split", "Sin…
$ director        &lt;chr&gt; "James Gunn", "Ridley Scott", "M. Night Shyamalan", "C…
$ votes           &lt;dbl&gt; 757074, 485820, 157606, 60545, 393727, 56036, 258682, …
$ year            &lt;dbl&gt; 2014, 2012, 2016, 2016, 2016, 2016, 2016, 2016, 2016, …
$ runtime         &lt;dbl&gt; 121, 124, 117, 108, 123, 103, 128, 89, 141, 116, 133, …
$ rating          &lt;dbl&gt; 8.1, 7.0, 7.3, 7.2, 6.2, 6.1, 8.3, 6.4, 7.1, 7.0, 7.5,…
$ revenue_million &lt;dbl&gt; 333.13, 126.46, 138.12, 270.32, 325.02, 45.13, 151.06,…
$ indicator       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</code></pre>
</div>
</div>
<p>Keep in mind that you can throw any function into <code>mutate()</code> as long as it is vectorized and the output has the same length as the tibble or 1.</p>
<p><code>case_when()</code> also has a sibling called <code>case_match()</code>. It is used when you want to create a new variable based on the values of a categorical variable. It works similar to <code>case_when()</code>, but instead of providing conditions, you provide the exact values you want to match. <code>case_match()</code> provides a cleaner syntax when you’re matching exact values. It’s particularly useful when you want to recode or map specific values to new ones.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Match specific years to decades</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">decade =</span> <span class="fu">case_match</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>      year,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2006</span><span class="sc">:</span><span class="dv">2009</span> <span class="sc">~</span> <span class="st">"2000s"</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2010</span><span class="sc">:</span><span class="dv">2016</span> <span class="sc">~</span> <span class="st">"2010s"</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="st">"Unknown"</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(decade)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  decade     n
  &lt;chr&gt;  &lt;int&gt;
1 2000s    200
2 2010s    800</code></pre>
</div>
</div>
<p>You can also use case_match() with character values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">director_type =</span> <span class="fu">case_match</span>(</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>      director,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="st">"Christopher Nolan"</span>, <span class="st">"Steven Spielberg"</span>, <span class="st">"Martin Scorsese"</span>) <span class="sc">~</span> <span class="st">"Famous"</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">.default =</span> <span class="st">"Other"</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(director_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  director_type     n
  &lt;chr&gt;         &lt;int&gt;
1 Famous           14
2 Other           986</code></pre>
</div>
</div>
<p>Key differences between <code>case_when()</code> and <code>case_match()</code>:</p>
<ul>
<li>Syntax: <code>case_match()</code> uses the value to match on the left side, while <code>case_when()</code> uses conditions</li>
<li>Use case: <code>case_match()</code> is for exact matching, <code>case_when()</code> is for complex conditions</li>
<li>Performance: <code>case_match()</code> can be faster for simple value matching</li>
<li>Readability: <code>case_match()</code> is often cleaner when recoding variables</li>
</ul>
</section>
<section id="summarize-group_by-and-reframe" class="level3">
<h3 class="anchored" data-anchor-id="summarize-group_by-and-reframe"><code>summarize()</code>, <code>group_by()</code>, and <code>reframe()</code></h3>
<p>When you analyze data, you often want to compare entities according to some sort of summary statistic. This means that you, first, need to split up your data set into certain groups which share one or more characteristics, and, second, collapse the rows together into single-row summaries. The former challenge is accomplished using <code>group_by()</code> whose argument is one or more variables, the latter requires the <code>summarize()</code> function. This function works similar to <code>mutate()</code> but uses <em>summary functions</em> – which take a vector of multiple values and return a single value – instead of window functions – which return a vector of the same length as the input.</p>
<p>Let me provide you an example.</p>
<p>I am interested in the director’s average ratings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(director, year) <span class="sc">|&gt;</span> </span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_rating =</span> <span class="fu">mean</span>(rating),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_revenue =</span> <span class="fu">mean</span>(revenue_million, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'director'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 987 × 4
# Groups:   director [644]
   director             year avg_rating avg_revenue
   &lt;chr&gt;               &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt;
 1 Aamir Khan           2007        8.5        1.2 
 2 Abdellatif Kechiche  2013        7.8        2.2 
 3 Adam Leon            2016        6.5      NaN   
 4 Adam McKay           2006        6.6      148.  
 5 Adam McKay           2008        6.9      100.  
 6 Adam McKay           2010        6.7      119.  
 7 Adam McKay           2015        7.8       70.2 
 8 Adam Shankman        2007        6.7      119.  
 9 Adam Shankman        2012        5.9       38.5 
10 Adam Wingard         2014        6.7        0.32
# ℹ 977 more rows</code></pre>
</div>
</div>
<p>In general, <code>summarize()</code> always works like this: first, you change the scope from the entire tibble to different groups. Then, you calculate your summary. If you then want to further manipulate your data or calculate something else based on the new summary, you need to call <code>ungroup()</code>.</p>
<p>You can see the summary functions below:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/summary_functions.png" class="img-fluid figure-img"></p>
<figcaption>Summary functions in R</figcaption>
</figure>
</div>
<p>Another handy function akin to this is <code>count()</code>. It counts all occurrences of a singular value in the tibble.</p>
<p>If I were interested in how many movies of the different directors have made it into the data set, I could use this code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(director)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 644 × 2
   director                n
   &lt;chr&gt;               &lt;int&gt;
 1 Aamir Khan              1
 2 Abdellatif Kechiche     1
 3 Adam Leon               1
 4 Adam McKay              4
 5 Adam Shankman           2
 6 Adam Wingard            2
 7 Afonso Poyart           1
 8 Aisling Walsh           1
 9 Akan Satayev            1
10 Akiva Schaffer          1
# ℹ 634 more rows</code></pre>
</div>
</div>
<p>While <code>summarize()</code> is powerful, it has a limitation: it always returns exactly one row per group. Sometimes you need more flexibility - that’s where <code>reframe()</code> comes in. Introduced in dplyr 1.1.0, <code>reframe()</code> allows you to return any number of rows per group.</p>
<p>With reframe(), we can for instance calculate the rating quantiles per director:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(director) <span class="sc">|&gt;</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">rating_quantiles =</span> <span class="fu">quantile</span>(rating, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)),</span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">quantile =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>))</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,932 × 3
   director            rating_quantiles quantile
   &lt;chr&gt;                          &lt;dbl&gt;    &lt;dbl&gt;
 1 Aamir Khan                      8.5      0.25
 2 Aamir Khan                      8.5      0.5 
 3 Aamir Khan                      8.5      0.75
 4 Abdellatif Kechiche             7.8      0.25
 5 Abdellatif Kechiche             7.8      0.5 
 6 Abdellatif Kechiche             7.8      0.75
 7 Adam Leon                       6.5      0.25
 8 Adam Leon                       6.5      0.5 
 9 Adam Leon                       6.5      0.75
10 Adam McKay                      6.68     0.25
# ℹ 1,922 more rows</code></pre>
</div>
</div>
<p>This example calculates the 25th, 50th, and 75th percentiles of ratings. Each director will have one row with their average rating and a list of quantiles.</p>
<p>When to use reframe() vs summarize():</p>
<p>Use <code>summarize()</code> when you want:</p>
<ul>
<li>One summary value per group (mean, sum, count, etc.)</li>
<li>A single row of results per group</li>
</ul>
<p>Use <code>reframe()</code> when you need:</p>
<ul>
<li>Multiple rows per group</li>
<li>To return quantiles, ranges, or other multi-value summaries</li>
<li>More flexibility in your output structure</li>
</ul>
<p>Note that both functions return a grouped tibble, so you may want to <code>ungroup()</code> afterwards if you’re doing further operations.</p>
</section>
<section id="arrange" class="level3">
<h3 class="anchored" data-anchor-id="arrange"><code>arrange()</code></h3>
<p>Finally, you can also sort values using <code>arrange()</code>. In the last section, I was interested in directors’ respective average ratings. The values were ordered according to their name (hence, “Aamir Khan” was first). In this case, the order dos not make too much sense, because the first name does not say too much about the director’s ratings. Therefore, I want to sort them according to their average ratings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(director) <span class="sc">|&gt;</span> </span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_rating =</span> <span class="fu">mean</span>(rating)) <span class="sc">|&gt;</span> </span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(avg_rating)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 644 × 2
   director           avg_rating
   &lt;chr&gt;                   &lt;dbl&gt;
 1 Jason Friedberg           1.9
 2 James Wong                2.7
 3 Shawn Burkett             2.7
 4 Jonathan Holbrook         3.2
 5 Femi Oyeniran             3.5
 6 Micheal Bafaro            3.5
 7 Jeffrey G. Hunt           3.7
 8 Rolfe Kanefsky            3.9
 9 Joey Curtis               4  
10 Sam Taylor-Johnson        4.1
# ℹ 634 more rows</code></pre>
</div>
</div>
<p>All right, Jason Friedberg is apparently the director of the worst rated movie in my data set. But it would be more handy, if they were arranged in descending order. I can use <code>desc()</code> for this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>imdb_selected <span class="sc">|&gt;</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(director) <span class="sc">|&gt;</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">avg_rating =</span> <span class="fu">mean</span>(rating)) <span class="sc">|&gt;</span> </span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>avg_rating)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 644 × 2
   director                         avg_rating
   &lt;chr&gt;                                 &lt;dbl&gt;
 1 Nitesh Tiwari                          8.8 
 2 Christopher Nolan                      8.68
 3 Makoto Shinkai                         8.6 
 4 Olivier Nakache                        8.6 
 5 Aamir Khan                             8.5 
 6 Florian Henckel von Donnersmarck       8.5 
 7 Damien Chazelle                        8.4 
 8 Naoko Yamada                           8.4 
 9 Amber Tamblyn                          8.3 
10 Lee Unkrich                            8.3 
# ℹ 634 more rows</code></pre>
</div>
</div>
<p>Chapeau, Nitesh Tiwari!</p>
</section>
<section id="introducing-joins" class="level3">
<h3 class="anchored" data-anchor-id="introducing-joins">Introducing <code>joins</code></h3>
<p>The last session showed you three things: how you get data sets into R, a couple of ways to create tibbles, and an introduction to tidy data and how to make data sets tidy using the <code>tidyr</code> package. As you may recall from the last session, it was not able to solve the last two problems with only the tools <code>tidyr</code> offers. In particular, the problems were:</p>
<ul>
<li>Multiple types of observational units are stored in the same table.</li>
<li>A single observational unit is stored in multiple tables.</li>
</ul>
<p>Both problems need some different kind of tools: joins. Joins can be used to merge tibbles together. This tutorial, again, builds heavily on the R for Data Science book <span class="citation" data-cites="wickham_data_2016">(<a href="#ref-wickham_data_2016" role="doc-biblioref">Wickham and Grolemund 2016</a>)</span></p>
<section id="multiple-types-of-units-are-in-the-same-table" class="level4">
<h4 class="anchored" data-anchor-id="multiple-types-of-units-are-in-the-same-table">Multiple types of units are in the same table</h4>
<p>Let’s look at the following data set. It contains the billboard charts in 2000 and was obtained from the <a href="https://github.com/tidyverse/tidyr/blob/master/data/billboard.rda"><code>tidyr</code> GitHub repo</a>. The example below is taken from the <code>tidyr</code> vignette which can be loaded using <code>vignette("tidy-data", package = "tidyr")</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/billboard.rda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(billboard)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 317
Columns: 79
$ artist       &lt;chr&gt; "2 Pac", "2Ge+her", "3 Doors Down", "3 Doors Down", "504 …
$ track        &lt;chr&gt; "Baby Don't Cry (Keep...", "The Hardest Part Of ...", "Kr…
$ date.entered &lt;date&gt; 2000-02-26, 2000-09-02, 2000-04-08, 2000-10-21, 2000-04-…
$ wk1          &lt;dbl&gt; 87, 91, 81, 76, 57, 51, 97, 84, 59, 76, 84, 57, 50, 71, 7…
$ wk2          &lt;dbl&gt; 82, 87, 70, 76, 34, 39, 97, 62, 53, 76, 84, 47, 39, 51, 6…
$ wk3          &lt;dbl&gt; 72, 92, 68, 72, 25, 34, 96, 51, 38, 74, 75, 45, 30, 28, 5…
$ wk4          &lt;dbl&gt; 77, NA, 67, 69, 17, 26, 95, 41, 28, 69, 73, 29, 28, 18, 4…
$ wk5          &lt;dbl&gt; 87, NA, 66, 67, 17, 26, 100, 38, 21, 68, 73, 23, 21, 13, …
$ wk6          &lt;dbl&gt; 94, NA, 57, 65, 31, 19, NA, 35, 18, 67, 69, 18, 19, 13, 3…
$ wk7          &lt;dbl&gt; 99, NA, 54, 55, 36, 2, NA, 35, 16, 61, 68, 11, 20, 11, 34…
$ wk8          &lt;dbl&gt; NA, NA, 53, 59, 49, 2, NA, 38, 14, 58, 65, 9, 17, 1, 29, …
$ wk9          &lt;dbl&gt; NA, NA, 51, 62, 53, 3, NA, 38, 12, 57, 73, 9, 17, 1, 27, …
$ wk10         &lt;dbl&gt; NA, NA, 51, 61, 57, 6, NA, 36, 10, 59, 83, 11, 17, 2, 30,…
$ wk11         &lt;dbl&gt; NA, NA, 51, 61, 64, 7, NA, 37, 9, 66, 92, 1, 17, 2, 36, N…
$ wk12         &lt;dbl&gt; NA, NA, 51, 59, 70, 22, NA, 37, 8, 68, NA, 1, 3, 3, 37, N…
$ wk13         &lt;dbl&gt; NA, NA, 47, 61, 75, 29, NA, 38, 6, 61, NA, 1, 3, 3, 39, N…
$ wk14         &lt;dbl&gt; NA, NA, 44, 66, 76, 36, NA, 49, 1, 67, NA, 1, 7, 4, 49, N…
$ wk15         &lt;dbl&gt; NA, NA, 38, 72, 78, 47, NA, 61, 2, 59, NA, 4, 10, 12, 57,…
$ wk16         &lt;dbl&gt; NA, NA, 28, 76, 85, 67, NA, 63, 2, 63, NA, 8, 17, 11, 63,…
$ wk17         &lt;dbl&gt; NA, NA, 22, 75, 92, 66, NA, 62, 2, 67, NA, 12, 25, 13, 65…
$ wk18         &lt;dbl&gt; NA, NA, 18, 67, 96, 84, NA, 67, 2, 71, NA, 22, 29, 15, 68…
$ wk19         &lt;dbl&gt; NA, NA, 18, 73, NA, 93, NA, 83, 3, 79, NA, 23, 29, 18, 79…
$ wk20         &lt;dbl&gt; NA, NA, 14, 70, NA, 94, NA, 86, 4, 89, NA, 43, 40, 20, 86…
$ wk21         &lt;dbl&gt; NA, NA, 12, NA, NA, NA, NA, NA, 5, NA, NA, 44, 43, 30, NA…
$ wk22         &lt;dbl&gt; NA, NA, 7, NA, NA, NA, NA, NA, 5, NA, NA, NA, 50, 40, NA,…
$ wk23         &lt;dbl&gt; NA, NA, 6, NA, NA, NA, NA, NA, 6, NA, NA, NA, NA, 39, NA,…
$ wk24         &lt;dbl&gt; NA, NA, 6, NA, NA, NA, NA, NA, 9, NA, NA, NA, NA, 44, NA,…
$ wk25         &lt;dbl&gt; NA, NA, 6, NA, NA, NA, NA, NA, 13, NA, NA, NA, NA, NA, NA…
$ wk26         &lt;dbl&gt; NA, NA, 5, NA, NA, NA, NA, NA, 14, NA, NA, NA, NA, NA, NA…
$ wk27         &lt;dbl&gt; NA, NA, 5, NA, NA, NA, NA, NA, 16, NA, NA, NA, NA, NA, NA…
$ wk28         &lt;dbl&gt; NA, NA, 4, NA, NA, NA, NA, NA, 23, NA, NA, NA, NA, NA, NA…
$ wk29         &lt;dbl&gt; NA, NA, 4, NA, NA, NA, NA, NA, 22, NA, NA, NA, NA, NA, NA…
$ wk30         &lt;dbl&gt; NA, NA, 4, NA, NA, NA, NA, NA, 33, NA, NA, NA, NA, NA, NA…
$ wk31         &lt;dbl&gt; NA, NA, 4, NA, NA, NA, NA, NA, 36, NA, NA, NA, NA, NA, NA…
$ wk32         &lt;dbl&gt; NA, NA, 3, NA, NA, NA, NA, NA, 43, NA, NA, NA, NA, NA, NA…
$ wk33         &lt;dbl&gt; NA, NA, 3, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk34         &lt;dbl&gt; NA, NA, 3, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk35         &lt;dbl&gt; NA, NA, 4, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk36         &lt;dbl&gt; NA, NA, 5, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk37         &lt;dbl&gt; NA, NA, 5, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk38         &lt;dbl&gt; NA, NA, 9, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk39         &lt;dbl&gt; NA, NA, 9, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
$ wk40         &lt;dbl&gt; NA, NA, 15, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk41         &lt;dbl&gt; NA, NA, 14, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk42         &lt;dbl&gt; NA, NA, 13, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk43         &lt;dbl&gt; NA, NA, 14, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk44         &lt;dbl&gt; NA, NA, 16, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk45         &lt;dbl&gt; NA, NA, 17, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk46         &lt;dbl&gt; NA, NA, 21, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk47         &lt;dbl&gt; NA, NA, 22, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk48         &lt;dbl&gt; NA, NA, 24, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk49         &lt;dbl&gt; NA, NA, 28, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk50         &lt;dbl&gt; NA, NA, 33, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk51         &lt;dbl&gt; NA, NA, 42, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk52         &lt;dbl&gt; NA, NA, 42, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk53         &lt;dbl&gt; NA, NA, 49, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk54         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk55         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk56         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk57         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk58         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk59         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk60         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk61         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk62         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk63         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk64         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk65         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk66         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk67         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk68         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk69         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk70         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk71         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk72         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk73         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk74         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk75         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ wk76         &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</code></pre>
</div>
</div>
<p>Here, you can immediately see the problem: it contains two types of observations: songs and ranks. Hence, the data set needs to be split up. However, there should be a pointer from the rank data set to the song data set. First, I add an ID column to <code>song_tbl</code>. Then, I can add it to <code>rank_tbl</code> and drop the unnecessary columns which contain the name of the artist and the track.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>song_tbl <span class="ot">&lt;-</span> billboard <span class="sc">|&gt;</span> </span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowid_to_column</span>(<span class="st">"song_id"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(artist, track, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(song_id<span class="sc">:</span>track)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(song_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 317
Columns: 3
$ song_id &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,…
$ artist  &lt;chr&gt; "2 Pac", "2Ge+her", "3 Doors Down", "3 Doors Down", "504 Boyz"…
$ track   &lt;chr&gt; "Baby Don't Cry (Keep...", "The Hardest Part Of ...", "Krypton…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>rank_tbl <span class="ot">&lt;-</span> billboard <span class="sc">|&gt;</span> </span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"wk"</span>), </span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"week"</span>, </span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"wk"</span>, </span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"rank"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">as.numeric</span>(week),</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> date.entered <span class="sc">+</span> (week<span class="dv">-1</span>) <span class="sc">*</span> <span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(song_tbl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"artist"</span>, <span class="st">"track"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(song_id, date, week, rank)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(rank_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5,307
Columns: 4
$ song_id &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3,…
$ date    &lt;date&gt; 2000-02-26, 2000-03-04, 2000-03-11, 2000-03-18, 2000-03-25, 2…
$ week    &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 1, 2, 3, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 1…
$ rank    &lt;dbl&gt; 87, 82, 72, 77, 87, 94, 99, 91, 87, 92, 81, 70, 68, 67, 66, 57…</code></pre>
</div>
</div>
</section>
<section id="one-unit-is-in-multiple-tables" class="level4">
<h4 class="anchored" data-anchor-id="one-unit-is-in-multiple-tables">One unit is in multiple tables</h4>
<p>For this example, I have split up a data set from the <code>socviz</code> package containing data on the 2016 elections in the U.S. according to census region and stored them in a folder. I can scrape the file names in the folder and read it into a list in an automated manner. (Note that the functions used to read the files in in an automated fashion are beyond the scope of this course. They come from the <a href="https://github.com/r-lib/fs"><code>fs</code></a> <span class="citation" data-cites="hester_fs_2021">(<a href="#ref-hester_fs_2021" role="doc-biblioref">Hester, Wickham, and Csárdi 2021</a>)</span> and the <a href="https://r4ds.had.co.nz/iteration.html"><code>purrr</code></a> package <span class="citation" data-cites="henry_purrr_2020">(<a href="#ref-henry_purrr_2020" role="doc-biblioref">Henry and Wickham 2020</a>)</span>.)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">dir_ls</span>(<span class="at">path =</span> <span class="st">"data/socviz_us"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map</span>(read_csv,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">col_types =</span> <span class="fu">cols</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">id =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">name =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">state =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">census_region =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop_dens =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop_dens4 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop_dens6 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">pct_black =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">pop =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">female =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">white =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">black =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">travel_time =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">land_area =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">hh_income =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">su_gun4 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">su_gun6 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">fips =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">votes_dem_2016 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">votes_gop_2016 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">total_votes_2016 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">per_dem_2016 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">per_gop_2016 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff_2016 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-28"><a href="#cb96-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">per_dem_2012 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-29"><a href="#cb96-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">per_gop_2012 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-30"><a href="#cb96-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">diff_2012 =</span> <span class="fu">col_double</span>(),</span>
<span id="cb96-31"><a href="#cb96-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">winner =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-32"><a href="#cb96-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">partywinner16 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-33"><a href="#cb96-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">winner12 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-34"><a href="#cb96-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">partywinner12 =</span> <span class="fu">col_character</span>(),</span>
<span id="cb96-35"><a href="#cb96-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">flipped =</span> <span class="fu">col_character</span>()</span>
<span id="cb96-36"><a href="#cb96-36" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The list now consists of four tibbles in a list which need to be bound together. You can achieve this using <code>list_rbind()</code>. Its counterpart is <code>list_cbind()</code> which binds columns together. It matches rows by position.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>election_data <span class="ot">&lt;-</span> file_list <span class="sc">|&gt;</span> <span class="fu">list_rbind</span>()</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(election_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3,141
Columns: 32
$ id               &lt;dbl&gt; 17001, 17003, 17005, 17007, 17009, 17011, 17013, 1701…
$ name             &lt;chr&gt; "Adams County", "Alexander County", "Bond County", "B…
$ state            &lt;chr&gt; "IL", "IL", "IL", "IL", "IL", "IL", "IL", "IL", "IL",…
$ census_region    &lt;chr&gt; "Midwest", "Midwest", "Midwest", "Midwest", "Midwest"…
$ pop_dens         &lt;chr&gt; "[   50,  100)", "[   10,   50)", "[   10,   50)", "[…
$ pop_dens4        &lt;chr&gt; "[ 45,  118)", "[ 17,   45)", "[ 45,  118)", "[118,71…
$ pop_dens6        &lt;chr&gt; "[ 45,   82)", "[ 25,   45)", "[ 45,   82)", "[ 82,  …
$ pct_black        &lt;chr&gt; "[ 2.0, 5.0)", "[25.0,50.0)", "[ 5.0,10.0)", "[ 2.0, …
$ pop              &lt;dbl&gt; 66988, 7492, 17269, 53869, 6832, 33840, 4956, 14715, …
$ female           &lt;dbl&gt; 51.3, 49.5, 47.5, 50.2, 35.5, 51.0, 49.7, 50.1, 49.1,…
$ white            &lt;dbl&gt; 93.7, 60.6, 90.9, 93.2, 78.6, 96.8, 98.8, 96.7, 93.2,…
$ black            &lt;dbl&gt; 3.7, 36.1, 6.5, 2.6, 19.1, 0.8, 0.3, 1.1, 4.4, 12.8, …
$ travel_time      &lt;dbl&gt; 16.6, 25.6, 23.6, 30.1, 18.9, 20.4, 39.6, 23.8, 22.2,…
$ land_area        &lt;dbl&gt; 855.20, 235.51, 380.28, 280.72, 305.61, 869.03, 253.8…
$ hh_income        &lt;dbl&gt; 45073, 26972, 48163, 60893, 42194, 48977, 50436, 4798…
$ su_gun4          &lt;chr&gt; "[ 0, 5)", "[ 5, 8)", "[ 0, 5)", "[ 0, 5)", "[ 0, 5)"…
$ su_gun6          &lt;chr&gt; "[ 4, 7)", "[ 7, 8)", "[ 4, 7)", "[ 0, 4)", "[ 0, 4)"…
$ fips             &lt;dbl&gt; 17001, 17003, 17005, 17007, 17009, 17011, 17013, 1701…
$ votes_dem_2016   &lt;dbl&gt; 7633, 1262, 2066, 8952, 475, 6010, 739, 2437, 1617, 4…
$ votes_gop_2016   &lt;dbl&gt; 22732, 1496, 4884, 12261, 1776, 9264, 1719, 4428, 321…
$ total_votes_2016 &lt;dbl&gt; 31770, 2820, 7462, 22604, 2336, 16303, 2556, 7354, 50…
$ per_dem_2016     &lt;dbl&gt; 0.2402581, 0.4475177, 0.2768695, 0.3960361, 0.2033390…
$ per_gop_2016     &lt;dbl&gt; 0.7155178, 0.5304965, 0.6545162, 0.5424261, 0.7602740…
$ diff_2016        &lt;dbl&gt; 15099, 234, 2818, 3309, 1301, 3254, 980, 1991, 1599, …
$ per_dem_2012     &lt;dbl&gt; 0.3152466, 0.5610873, 0.4122471, 0.4625697, 0.3331922…
$ per_gop_2012     &lt;dbl&gt; 0.6670705, 0.4248927, 0.5591853, 0.5195706, 0.6397121…
$ diff_2012        &lt;dbl&gt; 10744, 476, 1075, 1216, 724, 33, 360, 107, 657, 5292,…
$ winner           &lt;chr&gt; "Trump", "Trump", "Trump", "Trump", "Trump", "Trump",…
$ partywinner16    &lt;chr&gt; "Republican", "Republican", "Republican", "Republican…
$ winner12         &lt;chr&gt; "Romney", "Obama", "Romney", "Romney", "Romney", "Rom…
$ partywinner12    &lt;chr&gt; "Republican", "Democrat", "Republican", "Republican",…
$ flipped          &lt;chr&gt; "No", "Yes", "No", "No", "No", "No", "No", "Yes", "No…</code></pre>
</div>
</div>
<p>However, the topic of this script is different joins. The <code>dplyr</code> package offers six different joins: <code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, <code>full_join()</code>, <code>semi_join()</code>, and <code>anti_join()</code>. The former four are mutating joins, they add columns. The latter two can be used to filter rows in a data set. Below is an overview from the <code>dplyr</code> cheat sheet:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/joins.png" class="img-fluid figure-img"></p>
<figcaption>Overview of the different joins</figcaption>
</figure>
</div>
<p>In the following, I will illustrate this using the election data. I split up the data set into three: data on the elections 2016 and 2012, and demographic data. The column they have in common is the county’s respective name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="ot">&lt;-</span> election_data <span class="sc">|&gt;</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, state, votes_dem_2016<span class="sc">:</span>diff_2016, winner, partywinner16)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>election_data12 <span class="ot">&lt;-</span> election_data <span class="sc">|&gt;</span> </span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, state, per_dem_2012<span class="sc">:</span>partywinner12)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>demographic_data <span class="ot">&lt;-</span> election_data <span class="sc">|&gt;</span> </span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, state, pop<span class="sc">:</span>hh_income) <span class="sc">|&gt;</span> </span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2000</span>) <span class="co">#you will see later why I do this</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="left_join-and-right_join" class="level4">
<h4 class="anchored" data-anchor-id="left_join-and-right_join"><code>left_join()</code> and <code>right_join()</code></h4>
<p>If we want to add the demographic data to the election data 2016, we can use a <code>left_join()</code> or a <code>right_join()</code>. The former adds all columns of <code>y</code> to <code>x</code>, the latter all columns of <code>x</code> to <code>y</code>. Here, I want to add the demographic data to the election data 2016. Therefore, I use a <code>left_join()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(demographic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name, state)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,141 × 17
   name        state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Adams Coun… IL              7633          22732            31770        0.240
 2 Alexander … IL              1262           1496             2820        0.448
 3 Bond County IL              2066           4884             7462        0.277
 4 Boone Coun… IL              8952          12261            22604        0.396
 5 Brown Coun… IL               475           1776             2336        0.203
 6 Bureau Cou… IL              6010           9264            16303        0.369
 7 Calhoun Co… IL               739           1719             2556        0.289
 8 Carroll Co… IL              2437           4428             7354        0.331
 9 Cass County IL              1617           3216             5054        0.320
10 Champaign … IL             49694          33235            89196        0.557
# ℹ 3,131 more rows
# ℹ 11 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;, pop &lt;dbl&gt;, female &lt;dbl&gt;, white &lt;dbl&gt;, black &lt;dbl&gt;,
#   travel_time &lt;dbl&gt;, land_area &lt;dbl&gt;, hh_income &lt;dbl&gt;</code></pre>
</div>
</div>
<p>If the column that both data sets have in common has the same name, there’s no need to provide it. If this is not the case, you need to provide it in a character vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">county =</span> name) <span class="sc">|&gt;</span> </span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(demographic_data, <span class="at">by =</span> <span class="fu">join_by</span>(<span class="st">"county"</span> <span class="sc">==</span> <span class="st">"name"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in right_join(rename(election_data16, county = name), demographic_data, : Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10,348 × 18
   county    state.x votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;     &lt;chr&gt;            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Adams Co… IL                7633          22732            31770        0.240
 2 Adams Co… IL                7633          22732            31770        0.240
 3 Adams Co… IL                7633          22732            31770        0.240
 4 Adams Co… IL                7633          22732            31770        0.240
 5 Adams Co… IL                7633          22732            31770        0.240
 6 Adams Co… IL                7633          22732            31770        0.240
 7 Adams Co… IL                7633          22732            31770        0.240
 8 Adams Co… IL                7633          22732            31770        0.240
 9 Adams Co… IL                7633          22732            31770        0.240
10 Alexande… IL                1262           1496             2820        0.448
# ℹ 10,338 more rows
# ℹ 12 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;, state.y &lt;chr&gt;, pop &lt;dbl&gt;, female &lt;dbl&gt;, white &lt;dbl&gt;,
#   black &lt;dbl&gt;, travel_time &lt;dbl&gt;, land_area &lt;dbl&gt;, hh_income &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Here, the problem is that the same counties exist in different states. Therefore, all combinations are returned. Hence, I need to specify two arguments: the county’s name and state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">county =</span> name) <span class="sc">|&gt;</span> </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(demographic_data, <span class="at">by =</span> <span class="fu">join_by</span>(<span class="st">"county"</span> <span class="sc">==</span> <span class="st">"name"</span>, <span class="st">"state"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 17
   county      state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Adams Coun… IL              7633          22732            31770        0.240
 2 Alexander … IL              1262           1496             2820        0.448
 3 Bond County IL              2066           4884             7462        0.277
 4 Boone Coun… IL              8952          12261            22604        0.396
 5 Brown Coun… IL               475           1776             2336        0.203
 6 Bureau Cou… IL              6010           9264            16303        0.369
 7 Calhoun Co… IL               739           1719             2556        0.289
 8 Carroll Co… IL              2437           4428             7354        0.331
 9 Cass County IL              1617           3216             5054        0.320
10 Champaign … IL             49694          33235            89196        0.557
# ℹ 1,990 more rows
# ℹ 11 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;, pop &lt;dbl&gt;, female &lt;dbl&gt;, white &lt;dbl&gt;, black &lt;dbl&gt;,
#   travel_time &lt;dbl&gt;, land_area &lt;dbl&gt;, hh_income &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Left joins return all rows which are in <code>x</code>. If a column is in <code>x</code> but not in <code>y</code>, an <code>NA</code> will be included at this position. Right joins work vice versa and return all rows which are in <code>y</code>.</p>
</section>
<section id="inner_join" class="level4">
<h4 class="anchored" data-anchor-id="inner_join"><code>inner_join()</code></h4>
<p>An <code>inner_join()</code> returns all rows which are in <code>x</code> and <code>y</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(demographic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name, state)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 17
   name        state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Adams Coun… IL              7633          22732            31770        0.240
 2 Alexander … IL              1262           1496             2820        0.448
 3 Bond County IL              2066           4884             7462        0.277
 4 Boone Coun… IL              8952          12261            22604        0.396
 5 Brown Coun… IL               475           1776             2336        0.203
 6 Bureau Cou… IL              6010           9264            16303        0.369
 7 Calhoun Co… IL               739           1719             2556        0.289
 8 Carroll Co… IL              2437           4428             7354        0.331
 9 Cass County IL              1617           3216             5054        0.320
10 Champaign … IL             49694          33235            89196        0.557
# ℹ 1,990 more rows
# ℹ 11 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;, pop &lt;dbl&gt;, female &lt;dbl&gt;, white &lt;dbl&gt;, black &lt;dbl&gt;,
#   travel_time &lt;dbl&gt;, land_area &lt;dbl&gt;, hh_income &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="full_join" class="level4">
<h4 class="anchored" data-anchor-id="full_join"><code>full_join()</code></h4>
<p>A <code>full_join()</code> returns rows and columns from both <code>x</code> and <code>y</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(demographic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name, state)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,141 × 17
   name        state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Adams Coun… IL              7633          22732            31770        0.240
 2 Alexander … IL              1262           1496             2820        0.448
 3 Bond County IL              2066           4884             7462        0.277
 4 Boone Coun… IL              8952          12261            22604        0.396
 5 Brown Coun… IL               475           1776             2336        0.203
 6 Bureau Cou… IL              6010           9264            16303        0.369
 7 Calhoun Co… IL               739           1719             2556        0.289
 8 Carroll Co… IL              2437           4428             7354        0.331
 9 Cass County IL              1617           3216             5054        0.320
10 Champaign … IL             49694          33235            89196        0.557
# ℹ 3,131 more rows
# ℹ 11 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;, pop &lt;dbl&gt;, female &lt;dbl&gt;, white &lt;dbl&gt;, black &lt;dbl&gt;,
#   travel_time &lt;dbl&gt;, land_area &lt;dbl&gt;, hh_income &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="semi_join" class="level4">
<h4 class="anchored" data-anchor-id="semi_join"><code>semi_join()</code></h4>
<p>Filtering joins only keep the cases from <code>x</code>, no data set is added.</p>
<p>The <code>semi_join()</code> returns all rows from <code>x</code> with matching values in <code>y</code>. You can compare it to a <code>right_join()</code> but without adding the columns of <code>y</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(demographic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name, state)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,000 × 10
   name        state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Adams Coun… IL              7633          22732            31770        0.240
 2 Alexander … IL              1262           1496             2820        0.448
 3 Bond County IL              2066           4884             7462        0.277
 4 Boone Coun… IL              8952          12261            22604        0.396
 5 Brown Coun… IL               475           1776             2336        0.203
 6 Bureau Cou… IL              6010           9264            16303        0.369
 7 Calhoun Co… IL               739           1719             2556        0.289
 8 Carroll Co… IL              2437           4428             7354        0.331
 9 Cass County IL              1617           3216             5054        0.320
10 Champaign … IL             49694          33235            89196        0.557
# ℹ 1,990 more rows
# ℹ 4 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="anti_join" class="level4">
<h4 class="anchored" data-anchor-id="anti_join"><code>anti_join()</code></h4>
<p><code>anti_join()</code> returns all rows from <code>x</code> with no matching rows in <code>y</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(demographic_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name, state)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,141 × 10
   name        state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 Onslow Cou… NC             17156          36342            55364        0.310
 2 Orange Cou… NC             59105          18373            79830        0.740
 3 Pamlico Co… NC              2427           4225             6772        0.358
 4 Pasquotank… NC              8455           8082            16964        0.498
 5 Pender Cou… NC              9086          17317            27072        0.336
 6 Perquimans… NC              2291           4143             6595        0.347
 7 Person Cou… NC              7772          11116            19303        0.403
 8 Pitt County NC             40967          35191            78264        0.523
 9 Polk County NC              3715           6738            10723        0.346
10 Randolph C… NC             13074          49156            63615        0.206
# ℹ 1,131 more rows
# ℹ 4 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="bind_rows-and-bind_cols" class="level3">
<h3 class="anchored" data-anchor-id="bind_rows-and-bind_cols"><code>bind_rows()</code> and <code>bind_cols()</code></h3>
<p>Binding tibbles together is made easy using the <code>bind_*()</code> functions. <code>bind_rows()</code> binds them together by rows, <code>bind_cols()</code> by columns. For the former, it is important that column names are matching. Otherwise, the non-matching ones will be added as separate columns and NAs introduced. IDs can be added by using the <code>.id =</code> argument, where the name of the id column can be specified.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>election_data16 <span class="sc">|&gt;</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(demographic_data) <span class="sc">|&gt;</span> </span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(election_data16 <span class="sc">|&gt;</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">anti_join</span>(demographic_data),</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">.id =</span> <span class="st">"id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(name, state)`
Joining with `by = join_by(name, state)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,141 × 11
   id    name  state votes_dem_2016 votes_gop_2016 total_votes_2016 per_dem_2016
   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;        &lt;dbl&gt;
 1 1     Adam… IL              7633          22732            31770        0.240
 2 1     Alex… IL              1262           1496             2820        0.448
 3 1     Bond… IL              2066           4884             7462        0.277
 4 1     Boon… IL              8952          12261            22604        0.396
 5 1     Brow… IL               475           1776             2336        0.203
 6 1     Bure… IL              6010           9264            16303        0.369
 7 1     Calh… IL               739           1719             2556        0.289
 8 1     Carr… IL              2437           4428             7354        0.331
 9 1     Cass… IL              1617           3216             5054        0.320
10 1     Cham… IL             49694          33235            89196        0.557
# ℹ 3,131 more rows
# ℹ 4 more variables: per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner &lt;chr&gt;,
#   partywinner16 &lt;chr&gt;</code></pre>
</div>
</div>
<p>For <code>bind_cols()</code>, the length has to be the same. Duplicated column names will be changed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>election_data12 <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(election_data16)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `name` -&gt; `name...1`
• `state` -&gt; `state...2`
• `winner` -&gt; `winner...6`
• `partywinner16` -&gt; `partywinner16...7`
• `name` -&gt; `name...10`
• `state` -&gt; `state...11`
• `winner` -&gt; `winner...18`
• `partywinner16` -&gt; `partywinner16...19`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3,141 × 19
   name...1         state...2 per_dem_2012 per_gop_2012 diff_2012 winner...6
   &lt;chr&gt;            &lt;chr&gt;            &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     
 1 Adams County     IL               0.315        0.667     10744 Trump     
 2 Alexander County IL               0.561        0.425       476 Trump     
 3 Bond County      IL               0.412        0.559      1075 Trump     
 4 Boone County     IL               0.463        0.520      1216 Trump     
 5 Brown County     IL               0.333        0.640       724 Trump     
 6 Bureau County    IL               0.489        0.491        33 Trump     
 7 Calhoun County   IL               0.419        0.559       360 Trump     
 8 Carroll County   IL               0.496        0.482       107 Trump     
 9 Cass County      IL               0.422        0.557       657 Trump     
10 Champaign County IL               0.520        0.452      5292 Clinton   
# ℹ 3,131 more rows
# ℹ 13 more variables: partywinner16...7 &lt;chr&gt;, winner12 &lt;chr&gt;,
#   partywinner12 &lt;chr&gt;, name...10 &lt;chr&gt;, state...11 &lt;chr&gt;,
#   votes_dem_2016 &lt;dbl&gt;, votes_gop_2016 &lt;dbl&gt;, total_votes_2016 &lt;dbl&gt;,
#   per_dem_2016 &lt;dbl&gt;, per_gop_2016 &lt;dbl&gt;, diff_2016 &lt;dbl&gt;, winner...18 &lt;chr&gt;,
#   partywinner16...19 &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="further-links-3" class="level3">
<h3 class="anchored" data-anchor-id="further-links-3">Further links</h3>
<ul>
<li><a href="https://r4ds.had.co.nz/transform.html">Chapter in R4DS</a></li>
<li>More on window functions in the vignette: <code>vignette("window-functions")</code></li>
<li>Again, <a href="https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf">the cheatsheet</a></li>
<li>A <a href="https://www.youtube.com/watch?v=jWjqLW-u3hc">tutorial on YouTube</a></li>
<li>Another introduction can be found <a href="https://stat545.com/join-cheatsheet.html">here</a>.</li>
<li>The <a href="https://r4ds.had.co.nz/relational-data.html">chapter in R4DS</a> has some nice diagrams.</li>
<li>You can also consult the <code>introverse</code> package if you need help with the packages covered here – <code>introverse::show_topics("dplyr")</code> will give you an overview of <code>dplyr</code>’s functions, and <code>get_help("name of function")</code> will help you with the respective function.</li>
</ul>
</section>
<section id="exercises-3" class="level3">
<h3 class="anchored" data-anchor-id="exercises-3">Exercises</h3>
<p>Open the IMDb file.</p>
<ol type="1">
<li>Find the duplicated movie. How could you go across this?</li>
<li>Which director has made the longest movie?</li>
<li>What’s the highest ranked movie?</li>
<li>Which movie got the most votes?</li>
<li>Which movie had the biggest revenue in 2016?</li>
<li>How much revenue did the movies in the data set make each year in total?</li>
<li>Filter movies following some conditions:
<ol type="a">
<li>More runtime than the average runtime (hint: you could also use <code>mutate()</code> before).</li>
<li>Movies directed by J. J. Abrams.</li>
<li>More votes than the median of all of the votes.</li>
<li>The movies which have the most common value (the mode) in terms of rating (<code>mode()</code> does exist but will not work in the way you might like it to work – run the script below and use the <code>my_mode</code> function).</li>
</ol></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="do">## helper function for mode</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>my_mode <span class="ot">&lt;-</span> <span class="cf">function</span>(x){ </span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    ta <span class="ot">=</span> <span class="fu">table</span>(x)</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    tam <span class="ot">=</span> <span class="fu">max</span>(ta)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(ta <span class="sc">==</span> tam))</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>         mod <span class="ot">=</span> <span class="cn">NA</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span>(<span class="fu">is.numeric</span>(x))</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>    mod <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">names</span>(ta)[ta <span class="sc">==</span> tam])</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>         mod <span class="ot">=</span> <span class="fu">names</span>(ta)[ta <span class="sc">==</span> tam]</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(mod)</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization">Visualizations with <code>ggplot2</code></h2>
<blockquote class="blockquote">
<p>“The purpose of visualization is insight, not pictures.” – Ben A. Shneiderman</p>
</blockquote>
<p>In R, the dominant package for visualizing data is <code>ggplot2</code> which belongs to the tidyverse.</p>
<section id="the-layered-grammar-of-graphics" class="level3">
<h3 class="anchored" data-anchor-id="the-layered-grammar-of-graphics">The “layered grammar of graphics”</h3>
<p><code>ggplot2</code> works with tibbles and the data needs to be in a tidy format. It builds graphics using “the layered grammar of graphics.” <span class="citation" data-cites="wickham_layered_2010">(<a href="#ref-wickham_layered_2010" role="doc-biblioref">Wickham 2010</a>)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>publishers <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/publishers_with_places.csv"</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>publishers_filtered <span class="ot">&lt;-</span> publishers <span class="sc">|&gt;</span> </span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span> </span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb127-6"><a href="#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This implies that you start with a base layer – the initial <code>ggplot2</code> call.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>publishers_filtered <span class="sc">|&gt;</span> </span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The initial call produces an empty coordinate system. It can be filled with additional layers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> publishers_filtered) <span class="sc">+</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> city)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Unlike the remainder of the tidyverse, <code>ggplot2</code> uses a <code>+</code> instead of the pipe <code>|&gt;</code>. If you use the pipe by accident, it will not work and an (informative) error message will appear.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(data = publishers_filtered) |&gt; </span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_bar(aes(x = city)) </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-layers" class="level3">
<h3 class="anchored" data-anchor-id="the-layers">The layers</h3>
<p>In general, a call looks like this:</p>
<p>As you might have seen above, I provided the data in the initial <code>ggplot</code> call. Then, when I added the layer – the <code>geom_bar()</code> for a bar plot – I had to provide the mapping – which variables I wanted to plot – using <code>aes()</code>. This is referred to as the <code>aesthetics</code>. In my case, I wanted the cities to be projected to the x-axis. Since I was using <code>geom_bar</code> to create a bar plot, the number of occurrences of the respective cities were automatically counted and depicted on the y-axis. There are more <code>geom_*</code> functions and they all create different plots. Whether you can use them or not depends on the data you have at hand and/or the number of variables you want to plot. In the following, I will give you a brief overview of the most important geoms.</p>
<section id="one-variable" class="level4">
<h4 class="anchored" data-anchor-id="one-variable">One variable</h4>
<p>If you only want to display one variable, the x- or y-axis, as you choose, will depict the variable’s value. The counterpart will display the frequency or density of those values.</p>
<section id="one-variable-discrete" class="level5">
<h5 class="anchored" data-anchor-id="one-variable-discrete">One variable – discrete</h5>
<p>Here, the only possible kind of visualization is a bar plot as shown above. If the visualization should look more fancy, e.g., with colored bars, you have several arguments at hand. If they should not be different for different kinds of data, they need to be specified outside the <code>aes()</code>. There are always different arguments and you can look them up using <code>?&lt;GEOM_FUNCTION&gt;</code> and then looking at the Aesthetics section. Apart from that, you can also look at the <a href="https://rstudio.com/wp-content/uploads/2015/12/ggplot2-cheatsheet-2.0.pdf"><code>ggplot2</code> cheatsheet</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> publishers_filtered) <span class="sc">+</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> city), <span class="at">fill =</span> <span class="st">"blue"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="one-variable-continuous" class="level5">
<h5 class="anchored" data-anchor-id="one-variable-continuous">One variable – continuous</h5>
<p>If you want to display a continuous variable’s distribution of values, you can use a histogram. Its <code>geom_*</code> function is <code>geom_histogram()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>billboard <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/billboard.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 317 Columns: 79
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr   (2): artist, track
dbl  (65): wk1, wk2, wk3, wk4, wk5, wk6, wk7, wk8, wk9, wk10, wk11, wk12, wk...
lgl  (11): wk66, wk67, wk68, wk69, wk70, wk71, wk72, wk73, wk74, wk75, wk76
date  (1): date.entered

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>song_tbl <span class="ot">&lt;-</span> billboard <span class="sc">|&gt;</span> </span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(artist, track) <span class="sc">|&gt;</span> </span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">song_id =</span> <span class="fu">row_number</span>())</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>rank_tbl <span class="ot">&lt;-</span> billboard <span class="sc">|&gt;</span> </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"wk"</span>), </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"week"</span>, </span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">"wk"</span>, </span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"rank"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">week =</span> <span class="fu">as.numeric</span>(week),</span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">date =</span> date.entered <span class="sc">+</span> (week<span class="dv">-1</span>) <span class="sc">*</span> <span class="dv">7</span>) <span class="sc">|&gt;</span> </span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(song_tbl, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"artist"</span>, <span class="st">"track"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(song_id, date, week, rank)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How does the distribution of songs over the weeks look like?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> rank_tbl) <span class="sc">+</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> week))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A smoothed histogram is <code>geom_density()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> rank_tbl) <span class="sc">+</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> week))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="two-variables" class="level4">
<h4 class="anchored" data-anchor-id="two-variables">Two variables</h4>
<p>In the majority of cases, you will want to display the relationship between two variables, one on the x- and the other one on the y-axis.</p>
<section id="both-continuous" class="level5">
<h5 class="anchored" data-anchor-id="both-continuous">Both continuous</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>county_data_midwest <span class="ot">&lt;-</span> socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(census_region <span class="sc">==</span> <span class="st">"Midwest"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If both variables are continuous, the easiest option is to use a scatter plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you don’t like dots, the <code>shape =</code> argument allows you to change the shape of the data points. There are also other arguments to change, for instance, transparency (<code>alpha =</code>) or size (<code>size =</code>). Find an overview of the allowed aesthetic specifications <a href="https://ggplot2.tidyverse.org/articles/ggplot2-specs.html">here</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016), </span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="st">"cross"</span>, </span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, it might make sense to color the points according to a categorical variable (state, in this case). If so, a legend is added which maps the colors to their respective values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Since I look at the relationship between votes for the Republicans and the Democrats, and the U.S. is a two-party system, there is a fairly clear relationship between them both. This can also be depicted using <code>geom_smooth()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, <code>color = state</code> has a different effect: each dimension of the categorical variable gets its own line.</p>
<p>If you do not want it to be smoothed, just use <code>geom_line()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016), <span class="at">color =</span> <span class="st">"grey"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="discrete-x-continuous-y" class="level5">
<h5 class="anchored" data-anchor-id="discrete-x-continuous-y">Discrete X, continuous Y</h5>
<p>In this case, different categories of data will be put on the x-axis and some of their properties will be displayed on the y-axis. The probably most prominent example for this type of plot is a box plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> per_gop_2016))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="both-discrete" class="level5">
<h5 class="anchored" data-anchor-id="both-discrete">Both discrete</h5>
<p>It is rarely the case that you want to depict two categorical variables in one plot. If so, you can use <code>geom_jitter()</code>. It is related to <code>geom_point()</code>. The difference is that with <code>geom_jitter()</code>, a little bit of noise is added to the dots, making them appear distinct.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> winner))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As opposed to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> state, <span class="at">y =</span> winner))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="making-graphs-publishable" class="level3">
<h3 class="anchored" data-anchor-id="making-graphs-publishable">Making graphs “publishable”</h3>
<p>So far, I have only added one layer to the plot. This suffices for the most basic visualizations. The good thing about R and RMarkdown is, however, that you can write entire publications only using their means. Hence, the plots need to look awesome. This section is dedicated to how you can achieve this. First, I will touch upon how you can make them look good using <code>scales</code>. <code>labs()</code> allow you to add titles, captions, and axis labels. Finally, <code>facet_*</code> allows you to plot multiple plots into one.</p>
<section id="scales" class="level4">
<h4 class="anchored" data-anchor-id="scales">Scales</h4>
<p>Scales can be used to take control of how the data’s values are mapped to the aesthetic’s visual values. You can find a more exhaustive tutorial on them <a href="https://www3.nd.edu/~steve/computing_with_data/12_Scales_themes/scales_themes.html">here</a>.</p>
<ul>
<li><code>scale_*_continuous</code> – for dealing with continuous values. (you can find an exhaustive list of colors in R <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf">here</a>)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> county_data_midwest) <span class="sc">+</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> white)) <span class="sc">+</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"green"</span>,</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">high =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li><code>scale_*_discrete</code> – for dealing with discrete values</li>
<li><code>scale_*_manual</code> – manually mapping discrete values to visual values</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IA"</span>, <span class="st">"IL"</span>, <span class="st">"IN"</span>, <span class="st">"KS"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"green"</span>, </span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"purple"</span>),</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"State"</span>,</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Kansas"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="adding-titles-captions-etc." class="level4">
<h4 class="anchored" data-anchor-id="adding-titles-captions-etc.">Adding titles, captions, etc.</h4>
<p>Now you have modified the scales and colors – there is a lot more to be modified if you want to – but you have not added a meaningful title, a nice caption (where were the data obtained?), and the axes do not have proper names, too. This can be achieved using <code>labs()</code> (which is the abbreviation for labels).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IA"</span>, <span class="st">"IL"</span>, <span class="st">"IN"</span>, <span class="st">"KS"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"green"</span>, </span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"purple"</span>),</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">name =</span> <span class="st">"State"</span>,</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Kansas"</span>)) <span class="sc">+</span></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relationship between percentages of votes for Democrats and Republicans in selected states in the Midwest"</span>) <span class="sc">+</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Percentage of votes for the Democrats in 2016"</span>) <span class="sc">+</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Percentage of votes for the Republicans in 2016"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Well, that doesn’t look good, the title is too long. Inserting <code>\n</code> – for new line – will do the trick.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IA"</span>, <span class="st">"IL"</span>, <span class="st">"IN"</span>, <span class="st">"KS"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"green"</span>, <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"purple"</span>),</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"State"</span>,</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Kansas"</span>)) <span class="sc">+</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relationship between percentages of votes for Democrats </span><span class="sc">\n</span><span class="st">and Republicans in selected states in the Midwest"</span>) <span class="sc">+</span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">"Percentage of votes for the Democrats in 2016"</span>) <span class="sc">+</span></span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">"Percentage of votes for the Republicans in 2016"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>However, providing it with three different layers just for labeling is pretty tedious. This is where <code>labs()</code> comes in handy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"IA"</span>, <span class="st">"IL"</span>, <span class="st">"IN"</span>, <span class="st">"KS"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> state)) <span class="sc">+</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"IA"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"IL"</span> <span class="ot">=</span> <span class="st">"green"</span>, <span class="st">"IN"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"KS"</span> <span class="ot">=</span> <span class="st">"purple"</span>),</span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="st">"State"</span>,</span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">waiver</span>(),</span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Iowa"</span>, <span class="st">"Illinois"</span>, <span class="st">"Indiana"</span>, <span class="st">"Kansas"</span>)) <span class="sc">+</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Relationship between percentages of votes for Democrats </span><span class="sc">\n</span><span class="st">and Republicans in selected states in the Midwest"</span>,</span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">caption =</span> <span class="st">"Data obtained from the socviz R package"</span>,</span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Percentage of votes for the Democrats in 2016"</span>,</span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Percentage of votes for the Republicans in 2016"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="facets" class="level4">
<h4 class="anchored" data-anchor-id="facets">Facets</h4>
<p>The original data set consists of four different census regions. If I were to compare them, I could color them accordingly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> census_region)) <span class="sc">+</span></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_discrete</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Despite the coloring according to the different states, it is still hard to assess whether there really are differences. Apart from that, I would like to assess the impact the percentage of white people in the population has. This would be easier if I put them into individual graphs. I can achieve this using so-called facets. Facets enable me to divide the plot into subplots based on categorical variables. <code>facet_wrap()</code> puts them into a rectangular layout. The categorical variable needs to be provided prefixed with a tilde <code>~</code>, <code>nrow</code> determines the number of rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> white)) <span class="sc">+</span></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"green"</span>,</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(census_region),</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">nrow =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Apart from that, I can also spread it out using two different variables. Here, I will look at differences in the distribution of whites in the counties split up by who won in 2016 and 2012. This can be achieved using <code>facet_grid(categorical_variable_1~categorical_variable_2)</code>. The former one will be put into rows, the latter into columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb159-4"><a href="#cb159-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> white)) <span class="sc">+</span></span>
<span id="cb159-5"><a href="#cb159-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb159-6"><a href="#cb159-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb159-7"><a href="#cb159-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"green"</span>,</span>
<span id="cb159-8"><a href="#cb159-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb159-9"><a href="#cb159-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(winner<span class="sc">~</span>winner12)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If you want to facet using only one variable, put a dot at where the other variable would stand otherwise…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>socviz<span class="sc">::</span>county_data <span class="sc">|&gt;</span> </span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span> </span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> per_dem_2016, <span class="at">y =</span> per_gop_2016, <span class="at">color =</span> white)) <span class="sc">+</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"green"</span>,</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(.<span class="sc">~</span>winner)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="2_r_catch-up_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>… or just use <code>facet_wrap()</code>.</p>
</section>
</section>
<section id="exporting-graphics" class="level3">
<h3 class="anchored" data-anchor-id="exporting-graphics">Exporting graphics</h3>
<p>If you include the graphics in an RMarkdown document, make sure you use the proper chunk options (i.e., <code>{r echo=FALSE, message=FALSE, warning=FALSE}</code>).</p>
<p>If you, however, want to export it and put it into an MS Word document or so, you can just use the <code>ggsave()</code> function. By default, it just takes the last plot that has been created and saves it to a path that needs to be specified. If it contains a file extension, <code>ggsave()</code> just uses this one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"mtcars.pdf"</span>, <span class="at">device =</span> <span class="st">"pdf"</span>) <span class="co">#save it to pdf</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"mtcars.png"</span>) <span class="co">#save it to png</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"mtcars.pdf"</span>, <span class="at">width =</span> <span class="dv">4</span>, <span class="at">height =</span> <span class="dv">4</span>) <span class="co">#specify width and height -- in inches by default</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"mtcars.pdf"</span>, <span class="at">width =</span> <span class="dv">20</span>, <span class="at">height =</span> <span class="dv">20</span>, <span class="at">units =</span> <span class="st">"cm"</span>) <span class="co">#change unit using the units argument</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="further-readings" class="level3">
<h3 class="anchored" data-anchor-id="further-readings">Further readings</h3>
<ul>
<li><a href="https://github.com/rstudio/cheatsheets/blob/main/data-visualization-2.1.pdf">ggplot2 cheatsheet.</a></li>
<li><a href="https://ggplot2-book.org">ggplot2 – the book.</a></li>
<li>The <a href="http://www.cookbook-r.com/Graphs/">graphic cookbook for R</a>.</li>
<li>Another <a href="http://r-statistics.co/ggplot2-Tutorial-With-R.html">tutorial</a>.</li>
<li>A <a href="https://socviz.co">full-on online course by Kieran Healy</a> (comes with an R package as well).</li>
<li>Need some inspiration? Check out the <a href="https://r-graph-gallery.com">graph gallery</a>.</li>
<li>The <code>ggsave()</code> function <a href="https://ggplot2.tidyverse.org/reference/ggsave.html">in further detail</a>.</li>
<li>You can also consult the <code>introverse</code> package. <code>introverse::show_topics("ggplot2")</code> will give you overviews of the respective package’s functions, and <code>get_help("name of function")</code> will help you with the respective function.</li>
</ul>
</section>
<section id="exercises-4" class="level3">
<h3 class="anchored" data-anchor-id="exercises-4">Exercises</h3>
<p>Use the IMDb file.</p>
<p>Try to think about how you could answer the following questions graphically. If you fail, take a look at the hints.</p>
<ol type="1">
<li>Do higher rated movies generate more revenue?
<ol type="a">
<li>Plot revenue and rating as a scatter plot.</li>
<li>Do you think there is a correlation? How could you make stronger claims about it? Maybe even graphically?</li>
<li>Interpret the plot.</li>
<li>Add a nice title and labels.</li>
</ol></li>
<li>How evenly are the different years’ movies represented? (Why would it be pointless to make claims about the productivity of directors?)
<ol type="a">
<li>Make a bar plot.</li>
<li>Interpret the plot.</li>
<li>Add a nice title and labels.</li>
</ol></li>
<li>Which year was the best for cinema fetishists? (When could they watch the most highest rated movies?)
<ol type="a">
<li>Make a box plot.</li>
<li>Interpret the plot.</li>
<li>Add a nice title and labels.</li>
</ol></li>
</ol>
</section>
</section>
<section id="iteration" class="level2">
<h2 class="anchored" data-anchor-id="iteration">Iteration</h2>
<p>We also will work with lists. Lists can contain elements of different lengths (which distinguishes them from tibbles). This makes them especially suitable for web scraping. Other than (atomic) vectors they are not just vectorized since they can contain elements of all different kinds of format.</p>
<p>To iterate over lists, we have the <code>map()</code> family from the <code>purrr</code> package, which applies functions over lists. <code>pluck()</code> extracts elements from the list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>raw_list <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">first_element =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">10</span><span class="sc">:</span><span class="dv">42</span>)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(raw_list) <span class="co"># shows you the elements of the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 3
 $ first_element: int [1:4] 1 2 3 4
 $              : int [1:3] 4 5 6
 $              : int [1:33] 10 11 12 13 14 15 16 17 18 19 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(raw_list, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$first_element
[1] 2.5

[[2]]
[1] 5

[[3]]
[1] 26</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(raw_list, <span class="sc">~</span>{<span class="fu">mean</span>(.x) <span class="sc">|&gt;</span> <span class="fu">sqrt</span>()})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$first_element
[1] 1.581139

[[2]]
[1] 2.236068

[[3]]
[1] 5.09902</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(raw_list, mean) <span class="co"># by specifying the type of output, you can reduce the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>first_element                             
          2.5           5.0          26.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>raw_list <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="dv">1</span>) <span class="sc">==</span> raw_list <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="st">"first_element"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE TRUE</code></pre>
</div>
</div>
<p>This can also be achieved using a loop. Here, you use an index to loop over objects and do something to their elements. Typically, you create an empty list before and put the new output at the respective new position.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>new_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">length</span>(raw_list))</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(raw_list)){</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  new_list[[i]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(raw_list[[i]])</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="functionalprogramming" class="level2">
<h2 class="anchored" data-anchor-id="functionalprogramming">Flow Control, Functional programming, and iterations</h2>
<p>So far, you have learned heaps of data wrangling and analyses, but no real customization of R. This will change now, as you will be introduced to functions. Furthermore, the operations have only been applied to one singular object (read vector or data.frame/tibble). Iteration means that you perform the same operation on multiple objects/data sets/you name it.</p>
<p>Today’s session will all be about following the DRY principle. DRY stands for Don’t Repeat Yourself.</p>
<p>“Why not?,” you may ask. Well, the problem with copy-and-pasting code is that you have to change all the variable names in every instance of your code. RStudio has a nice Search-and-Replace function which might facilitate that, but this practice still bears the danger of writing code that contains errors. This is where you will need to make use of the tools that R offers to iterate over a couple of elements, perform operations on them, and return the results. An example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>example_strings <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"this"</span>, <span class="st">"is"</span>, <span class="st">"how"</span>, <span class="st">"a"</span>, <span class="st">"for"</span>, <span class="st">"loop"</span>, <span class="st">"works"</span>)</span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(example_strings)) {</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(example_strings[[i]])</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"
[1] "is"
[1] "how"
[1] "a"
[1] "for"
[1] "loop"
[1] "works"</code></pre>
</div>
</div>
<p>Another option – from the tidyverse – is the <code>purrr</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(example_strings, print)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"
[1] "is"
[1] "how"
[1] "a"
[1] "for"
[1] "loop"
[1] "works"</code></pre>
</div>
</div>
<p>So, what has this code done? In both cases, it has taken the function <code>print()</code> and applied it to every element of our vector. Copying-and-pasting would have looked like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "is"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">3</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "how"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">4</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">5</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "for"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">6</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "loop"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">7</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "works"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">7</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "works"</code></pre>
</div>
</div>
<p>Damn, I pasted the last instance twice. In this case, the mistake is obvious, but oftentimes it is not.</p>
<p>In the following, I will provide you a more extensive introduction into conditional statements, functions, loops, and the <code>purrr</code> (and it’s parallelized counter-part <code>furrr</code>) package.</p>
<section id="flow-control" class="level3">
<h3 class="anchored" data-anchor-id="flow-control">Flow control</h3>
<p>Sometimes you want your code to only run in specific cases. For <code>mutate()</code>, I have already showed you conditional imputation of values with <code>case_when()</code>. A more generalized approach for conditionally running code in R are <code>if</code> statements. They look as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (conditional_statement evaluates to <span class="cn">TRUE</span>) {</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  do_something</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>They also have an extension – <code>if…else</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (conditional_statement evaluates to <span class="cn">TRUE</span>) {</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  do_something</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  do_something_else</span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Imagine that I want R to tell me whether a number it draws is smaller than or equal to five:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="dv">5</span>) {</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"x is smaller than or equals 5"</span>)</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>} </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, x is 3, so the if statement returns something. If this is not the case, nothing happens:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="dv">5</span>) {</span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"x is smaller than or equals 5"</span>)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "x is smaller than or equals 5"</code></pre>
</div>
</div>
<p>Now I could extend it by another <code>if</code> statement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="dv">5</span>) {</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"x is smaller than or equals 5"</span>)</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&gt;</span> <span class="dv">5</span>) {</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"x is greater than 5"</span>)</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "x is greater than 5"</code></pre>
</div>
</div>
<p>Here, x is 10, so only the second if statement returns something.</p>
<p>But the <code>else</code> allows me to take a shortcut and write it more concisely:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="dv">5</span>) {</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"x is smaller than or equals 5"</span>)</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"x is greater than 5"</span>)</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "x is greater than 5"</code></pre>
</div>
</div>
<p>Please note that the condition inside the if statement needs to be a vector of type logical (hence, either <code>TRUE</code> or <code>FALSE</code>). Apart from that, only vectors of length 1 are allowed. The following will not work:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>)) {</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"example"</span>)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>} <span class="co">#This will throw an error!!!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<p>So far, every call you have made within R contained a function. Even the most basic operations, such as <code>c()</code> for building vectors, rely on functions. Functions are the verbs of R, they <em>do</em> something to your objects. Hence, you as someone who obeys the principles of DRY can make good use of them. Whenever you need to copy code to perform certain tasks to an object, you can also put those tasks into a function and just provide the function with the objects.</p>
<p>Imagine you want to rescale some variables in a tibble (an example I took from the OG version of R4DS <span class="citation" data-cites="wickham_data_2016">(<a href="#ref-wickham_data_2016" role="doc-biblioref">Wickham and Grolemund 2016</a>)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>a <span class="ot">&lt;-</span> (df<span class="sc">$</span>a <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> </span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">max</span>(df<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>a, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>b <span class="ot">&lt;-</span> (df<span class="sc">$</span>b <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> </span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">max</span>(df<span class="sc">$</span>b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>b, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>c <span class="ot">&lt;-</span> (df<span class="sc">$</span>c <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> </span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">max</span>(df<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>d <span class="ot">&lt;-</span> (df<span class="sc">$</span>d <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> </span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">max</span>(df<span class="sc">$</span>d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(df<span class="sc">$</span>d, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Given that you now know how to loop over the tibble, you can certainly reduce the amount of copy-pasting here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>),</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(df)) {</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>  df[[i]] <span class="ot">&lt;-</span> (df[[i]] <span class="sc">-</span> <span class="fu">min</span>(df[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> </span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">max</span>(df[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(df[[i]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb204-11"><a href="#cb204-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>However, the operation within the loop is generalizable: it always only takes a vector of numeric values as input, performs some actions on them and returns another vector of the same length, but rescaled into a range from 0 to 1. Hence, the operation fulfills the requirements for putting it into a function.</p>
<p>Doing so has some advantages:</p>
<ul>
<li>If an error occurs, you can simply change the function in one place – when you define it – instead of changing all the occurrences in your code</li>
<li>It will certainly make your code easier to read – <code>rescale0to1</code> is a more concise description than <code>(x - min(x, na.rm = TRUE)) / (max(x, na.rm = TRUE) - min(x, na.rm = TRUE))</code> (–&gt; you see what I did here? I already replaced the arguments with a generic variable. You can use it to write the function yourself.)</li>
</ul>
<section id="writing-your-own-functions" class="level4">
<h4 class="anchored" data-anchor-id="writing-your-own-functions">Writing your own functions</h4>
<p>When you define functions in R, you need to follow a certain structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>function_name <span class="ot">&lt;-</span> <span class="cf">function</span>(argument_1, argument_2, argument_n) {</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  function_body</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The <code>function_name</code> is the thing you will call (e.g., <code>mean()</code>). In general, it should be a verb, it should be concise, and it should be in_snakecase.</li>
<li>The <code>argument</code>s are what you need to provide the function with (e.g., <code>mean(</code><em>1:10</em><code>)</code>).</li>
<li>The <code>function body</code> contains the operations which are performed to the arguments. It can contain other functions as well – which need to be defined beforehand (e.g., <code>sum(1:10) / length(1:10)</code>)). It is advisable to split up the function body into as little pieces as you can.</li>
</ul>
</section>
<section id="an-example-roulette" class="level4">
<h4 class="anchored" data-anchor-id="an-example-roulette">An example: Roulette</h4>
<p>In the following, I will guide you through a quick example on how you could use functions to play an extremely basic game of Roulette with R. You provide it with two values (how much you bet and which number you choose) and R takes care of the rest.</p>
<p>So what does the function need to do? First, it needs to draw a number between 0 and 36. Second, it needs to compare the bet and its corresponding number. Third, it needs to return the respective result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a>play_roulette <span class="ot">&lt;-</span> <span class="cf">function</span>(bet, number) {</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>  draw <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">36</span>, <span class="dv">1</span>)</span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">winning_number =</span> draw,</span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">your_number =</span> number,</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">your_bet =</span> bet,</span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">your_return =</span> <span class="cf">if</span> (number <span class="sc">==</span> draw) {</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>      bet <span class="sc">*</span> <span class="dv">36</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a><span class="fu">play_roulette</span>(<span class="at">bet =</span> <span class="dv">1</span>, <span class="at">number =</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  winning_number your_number your_bet your_return
           &lt;int&gt;       &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
1             15          35        1           0</code></pre>
</div>
</div>
<p>But how to make sure that I do not bet on a number which I cannot bet on (i.e., numbers greater than 36)? Or, put differently, how to forbid values? Use <code>stop()</code>. Besides, how to set default values for the arguments? Just use <code>argument = default</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>play_roulette_restricted <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">bet =</span> <span class="dv">1</span>, number) {</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (number <span class="sc">&gt;</span> <span class="dv">36</span>) <span class="fu">stop</span>(<span class="st">"You can only bet on numbers between 0 and 36."</span>)</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  draw <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">36</span>, <span class="dv">1</span>)</span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">winning_number =</span> draw,</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">your_number =</span> number,</span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">your_bet =</span> bet,</span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">your_return =</span> <span class="cf">if</span> (number <span class="sc">==</span> draw) {</span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>      bet <span class="sc">*</span> <span class="dv">36</span></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(tbl_return)</span></span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a><span class="fu">play_roulette_restricted</span>(<span class="at">number =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  winning_number your_number your_bet your_return
           &lt;int&gt;       &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
1              1           3        1           0</code></pre>
</div>
</div>
<p>The function returns the results of the last call, i.e., the tibble. If you want to be more concrete about what it should return – or make an earlier return – use <code>return()</code>. The function will stop as soon as it hits a <code>return()</code> statement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>play_roulette_basic <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">bet =</span> <span class="dv">1</span>, number) {</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (number <span class="sc">&gt;</span> <span class="dv">36</span>) <span class="fu">stop</span>(<span class="st">"You can only bet on numbers between 0 and 36."</span>)</span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  draw <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">36</span>, <span class="dv">1</span>)</span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (number <span class="sc">==</span> draw) {</span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">str_c</span>(<span class="st">"Nice, you won"</span>, <span class="fu">as.character</span>(bet <span class="sc">*</span> <span class="dv">36</span>), <span class="st">"Dollars"</span>, <span class="at">sep =</span> <span class="st">" "</span>))</span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"I'm sorry, you lost."</span>)</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a><span class="fu">play_roulette_basic</span>(<span class="at">number =</span> <span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "I'm sorry, you lost."</code></pre>
</div>
</div>
</section>
<section id="functional-programming-with-tidyverse-functions" class="level4">
<h4 class="anchored" data-anchor-id="functional-programming-with-tidyverse-functions">Functional programming with <code>tidyverse</code> functions</h4>
<p>The majority of <code>dplyr</code> verbs uses so-called tidy evaluation which is a framework for controlling how expressions and variables in your code are evaluated by the tidyverse functions. The two main things here are <strong>data masking</strong> and <strong>tidy selection</strong>. The former facilitates computing on values within the data set and refers to functions such as <code>filter()</code>, where you can just type in variable names instead of tediously typing <code>name_of_df$var_name</code>. The latter aims to facilitate working with the columns in the data set. It is provided by the <code>tidyselect</code> package and allows you, for instance, to work with code such as <code>tbl |&gt; select(starts_with("a"))</code>. More examples can be acquired using <code>?dplyr_tidy_select</code>.</p>
<p>I will not go into detail here but rather stick to what implications this has to you. If you are interested in the theoretical underpinnings, read the chapter on “Metaprogramming” in <a href="http://adv-r.had.co.nz">Advanced R by Hadley Wickham</a>.</p>
<p>If your function takes a user-supplied variable as an argument, you need to consider this arguments in the pipeline. For instance, the following function calculates the mean, median, and standard deviation of a variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>my_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, var) {</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>  tbl <span class="sc">|&gt;</span> </span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">mean</span>({{ var }}),</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">median =</span> <span class="fu">median</span>({{ var }}),</span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd =</span> <span class="fu">sd</span>({{ var }})</span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> <span class="fu">my_summary</span>(cyl) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mean median       sd
1 6.1875      6 1.785922</code></pre>
</div>
</div>
<p>If the variable names are supplied in a character vector, you need <code>all_of()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>summarize_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(data, vars) {</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="fu">across</span>({{ vars }}, mean))</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> </span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">|&gt;</span> </span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize_mean</span>(<span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"hp"</span>, <span class="st">"mpg"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 4
$ cyl &lt;dbl&gt; 4, 6, 8
$ n   &lt;int&gt; 11, 7, 14
$ hp  &lt;dbl&gt; 82.63636, 122.28571, 209.21429
$ mpg &lt;dbl&gt; 26.66364, 19.74286, 15.10000</code></pre>
</div>
</div>
<p>Another handy thing is changing the variable names in the output depending on the input names. Here, you can use <a href="https://github.com/tidyverse/glue">glue</a> syntax and <code>:=</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>my_summary_w_names <span class="ot">&lt;-</span> <span class="cf">function</span>(tbl, var){</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  tbl <span class="sc">|&gt;</span> </span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(</span>
<span id="cb216-4"><a href="#cb216-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"mean_{{ var }}"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">mean</span>({{ var }}),</span>
<span id="cb216-5"><a href="#cb216-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"median_{{ var }}"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">median</span>({{ var }}),</span>
<span id="cb216-6"><a href="#cb216-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sd_{{ var }}"</span> <span class="sc">:</span><span class="er">=</span> <span class="fu">sd</span>({{ var }})</span>
<span id="cb216-7"><a href="#cb216-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb216-8"><a href="#cb216-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb216-9"><a href="#cb216-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-10"><a href="#cb216-10" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">|&gt;</span> <span class="fu">my_summary_w_names</span>(cyl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  mean_cyl median_cyl   sd_cyl
1   6.1875          6 1.785922</code></pre>
</div>
</div>
<p>Find more on programming with <code>dplyr</code> in <a href="https://cran.r-project.org/web/packages/dplyr/vignettes/programming.html">this vignette</a>.</p>
</section>
<section id="further-readings-1" class="level4">
<h4 class="anchored" data-anchor-id="further-readings-1">Further readings</h4>
<p>If you want to learn more about functional programming, check out the following resources:</p>
<ul>
<li>The <a href="https://r4ds.had.co.nz/functions.html">R4DS chapter</a></li>
<li><a href="https://www.tutorialspoint.com/r/r_functions.htm">A basic tutorial</a></li>
<li>A <a href="https://b-rodrigues.github.io/modern_R/defining-your-own-functions.html#writing-your-own-functions">book chapter</a> about control-flow and functions</li>
<li><a href="http://adv-r.had.co.nz/Functional-programming.html">Hadley on functional programming</a></li>
</ul>
</section>
</section>
<section id="iteration-1" class="level3">
<h3 class="anchored" data-anchor-id="iteration-1">Iteration</h3>
<p>Strictly speaking, there are three kinds of loops: <code>for</code>, <code>repeat</code>, and <code>while</code>. I will touch upon <code>for</code> and <code>while</code>, because they are more straight-forward than <code>repeat</code>. <code>repeat loops</code> will repeat a task until you tell it to stop by hitting the escape button or adding a condition up front. Interactive programming – sitting in front of your machine and hitting the escape button to break a loop – is no desired practice and <code>while loops</code> have internalized the condition already. Hence, <code>repeat loops</code> do not appear to have any advantage and I leave them out deliberately.</p>
<section id="for-loops" class="level4">
<h4 class="anchored" data-anchor-id="for-loops"><code>for</code> loops</h4>
<p><code>for</code> loops are the sort of loops you will have to work with more often as they allow you to loop <em>over</em> a predefined number of elements. For this sake, I will briefly revise how you index vectors, lists, and tibbles.</p>
<p>The ith element of a vector can be accessed by using either <code>[[i]]</code> or <code>[i]</code>.</p>
<p>The ith element of a list can be obtained by using <code>[[i]]</code> – <code>[i]</code> would return a sub-list instead of the element. The second element of the ith element in a list (if it were a vector or a list) can be obtained using <code>[[i]][[2]]</code> etc.</p>
<p>The ith column of a tibble can be accessed as a vector using <code>[[i]]</code>. The second value of the ith column of a tibble can be accessed using <code>[[i]][[2]]</code></p>
<p>How does that matter for <code>for</code> loops? Remember the example I showed you in the beginning? All a <code>for</code> loop does is iterating over a vector of values and imputing them instead of a placeholder.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>example_strings <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"this"</span>, <span class="st">"is"</span>, <span class="st">"how"</span>, <span class="st">"a"</span>, <span class="st">"for"</span>, <span class="st">"loop"</span>, <span class="st">"works"</span>)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> example_strings) {</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(i)</span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"
[1] "is"
[1] "how"
[1] "a"
[1] "for"
[1] "loop"
[1] "works"</code></pre>
</div>
</div>
<p>For a more general approach, you can also loop over the indices of the vector using <code>seq_along()</code> which creates a <code>seq</code>uence <code>along</code> a vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(example_strings) <span class="co"># seq_along looks like this</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5 6 7</code></pre>
</div>
</div>
<p>This is especially useful if you want to modify the elements of a vector or a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(example_strings)) {</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(example_strings[[i]])</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"
[1] "is"
[1] "how"
[1] "a"
[1] "for"
[1] "loop"
[1] "works"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Hence, the first iteration looks like this.</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="fu">seq_along</span>(example_strings)[[<span class="dv">1</span>]]]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># translates to</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(example_strings[[<span class="dv">1</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "this"</code></pre>
</div>
</div>
<p>Now that you have seen the general approach for using a <code>for</code> loop, how can you use them in practice for data manipulation? Whenever you use a <code>for</code> loop, you need to follow a three step approach:</p>
<ul>
<li>Output: In the beginning, you need to create a vector that we can fill with output. You also need to determine the length of the vector in the beginning. This is due to efficiency: if you were to grow the vector by every iteration (using <code>c</code>), the loop becomes very slow. This is especially important if you work with large data sets. An example for creating an empty vector of a certain length is <code>output &lt;- vector(mode = "numeric", length = length_of_output)</code>.</li>
<li>Sequence: <code>i in seq_along(variable)</code> tells the <code>for loop</code> what to loop over.<br>
</li>
<li>Body: The actual code. Performs the operation on the respective instance and stores the resulting value in the pre-defined output vector at position <code>i</code>.</li>
</ul>
<p><code>for loops</code> are considered slow. They are not, at least not if you stick to the following rules:</p>
<ul>
<li>Always pre-allocate space – make sure that R does not have to expand your objects</li>
<li>Do as much as you can outside the loop – every operation inside the loop will be repeated every time the loop is repeated</li>
</ul>
<p>In general, you will come across three different problems with <code>for loops</code>.</p>
<ul>
<li>Modifying an existing object</li>
<li>Length of output is unknown</li>
<li>Sequences are of unknown length</li>
</ul>
<section id="modifying-the-existing-object" class="level5">
<h5 class="anchored" data-anchor-id="modifying-the-existing-object">Modifying the existing object</h5>
<p>Sometimes you want to modify an existing object rather than creating a new one. This is useful when working with large datasets or when you need to update values in place.</p>
<p>Basic example: Standardizing columns Let’s say you have a dataset with test scores that you want to standardize (mean = 0, sd = 1):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">math =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">92</span>, <span class="dv">78</span>, <span class="dv">88</span>, <span class="dv">95</span>),</span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">science =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">80</span>, <span class="dv">92</span>, <span class="dv">88</span>),</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">english =</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">90</span>, <span class="dv">85</span>, <span class="dv">86</span>, <span class="dv">92</span>)</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"math"</span>, <span class="st">"science"</span>, <span class="st">"english"</span>)) {</span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>  scores[[col]] <span class="ot">&lt;-</span> (scores[[col]] <span class="sc">-</span> <span class="fu">mean</span>(scores[[col]])) <span class="sc">/</span> <span class="fu">sd</span>(scores[[col]])</span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>scores <span class="sc">|&gt;</span> </span>
<span id="cb228-13"><a href="#cb228-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(math, science, english), </span>
<span id="cb228-14"><a href="#cb228-14" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">sd =</span> sd)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
  math_mean math_sd science_mean science_sd english_mean english_sd
      &lt;dbl&gt;   &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1  8.88e-16       1     7.22e-17          1    -9.77e-16          1</code></pre>
</div>
</div>
</section>
<section id="length-of-output-is-unknown" class="level5">
<h5 class="anchored" data-anchor-id="length-of-output-is-unknown">Length of output is unknown</h5>
<p>Sometimes, you do not know how long your output object is. This is, for instance, if you simulate vectors of random length. Normally, you would just put the values into a vector. However, if you do not know the length, then you would have to ask R to grow the vector every iteration. But this is extremely inefficient.</p>
<p>For this, the solution is <code>lists</code>. You always know how many iterations your loop will have. Hence, you can create a list of this exact length and then just store the results in the list (as lists do not care about the length of the singular elements). Afterwards, you can <code>unlist()</code> or <code>flatten_*()</code> the list into a vector.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>a_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">10</span>L)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(a_list)) {</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>  a_list[[i]] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(len)</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>a_list <span class="sc">|&gt;</span> </span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="co"># or unlist(a_list)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  0.69760871  0.54999735 -0.40273198 -0.19159377 -1.19452788 -0.05315882
 [7] -1.43192024 -2.01016571  0.33832922  0.65128696  2.43315152  1.19133821
[13]  0.92244282  0.62109737  0.35633348 -0.47471847  0.06599349 -0.50247778
[19]  2.18711916 -0.58172745  0.70008023  1.49217658 -0.05210512 -0.19593462
[25] -0.64906975 -1.10976723  0.84927420 -0.01394090  0.16863694  0.86926335
[31] -0.79866986 -0.50375053  2.31559832 -0.69220912  0.49335047 -0.05760147
[37]  1.82420830  0.08005964 -0.63140930 -1.51328812 -0.63609983  0.22630153
[43]  1.01369035 -1.17194831  0.66871433 -1.65010093 -0.36585225 -0.31611833
[49] -1.94824605  0.92005752 -0.62287159 -0.17827861  0.78695133 -0.58054783
[55]  0.91825114</code></pre>
</div>
</div>
<p>If we wanted to add the information in a tibble, we could add it during the run and use <code>bind_rows()</code> afterwards.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>a_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">10</span>L)</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(a_list)) {</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>  len <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span>)</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>  a_list[[i]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">run =</span> i,</span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">rnorm</span>(len)</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> a_list <span class="sc">|&gt;</span> </span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 55 × 2
     run  values
   &lt;int&gt;   &lt;dbl&gt;
 1     1  0.700 
 2     1 -1.20  
 3     1 -0.499 
 4     2  0.0976
 5     3 -0.119 
 6     3  2.39  
 7     3  0.735 
 8     3  0.474 
 9     3 -0.234 
10     3 -0.854 
# ℹ 45 more rows</code></pre>
</div>
</div>
</section>
<section id="unknown-sequence-length" class="level5">
<h5 class="anchored" data-anchor-id="unknown-sequence-length">Unknown sequence length</h5>
<p>Sometimes, you also do not know how long your input sequence is. Instead, you want to loop until a certain condition is met. This is for instance the case when looping across multiple pages in web-scraping. Here, <code>while</code> loops come in handy (but this is the only use case I could think of).</p>
<p>The basic structure of <code>while loops</code> is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (condition) {</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>  code</span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>What could an example look like?<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> The following loop keeps running until three heads appeared in a row and the condition is met.</p>
<p>Please note that both vectors which are to be modified within the loop – <code>indicator</code> and <code>head</code> – need to be created beforehand. If I had not created <code>head</code> beforehand, the loop would not have started because there would not have been any vector to assess the length.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>indicator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>head <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="fu">length</span>(head) <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sample</span>(<span class="dv">2</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="st">"head"</span></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="st">"tail"</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="st">"head"</span>) {</span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>    head <span class="ot">&lt;-</span> <span class="fu">c</span>(head, <span class="dv">1</span>)</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(head) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a>  indicator <span class="ot">&lt;-</span> indicator <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this case, you still want to pre-allocate space. Hence, you could also use a list here. You can just do a very long list and afterwards cut it down to size using <code>purrr::compact()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a>indicator <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a>values <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode =</span> <span class="st">"list"</span>, <span class="at">length =</span> <span class="dv">1000</span>)</span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a>head <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="fu">length</span>(head) <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sample</span>(<span class="dv">2</span>, <span class="dv">1</span>) <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="st">"head"</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="st">"tail"</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x <span class="sc">==</span> <span class="st">"head"</span>) {</span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a>    head <span class="ot">&lt;-</span> <span class="fu">c</span>(head, <span class="dv">1</span>)</span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">length</span>(head) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a>  values[[indicator <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> x</span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a>  indicator <span class="ot">&lt;-</span> indicator <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-19"><a href="#cb236-19" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>values <span class="sc">|&gt;</span> <span class="fu">tail</span>(<span class="dv">5</span>) <span class="co">#last 5 values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
NULL

[[2]]
NULL

[[3]]
NULL

[[4]]
NULL

[[5]]
NULL</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>values <span class="sc">|&gt;</span> <span class="fu">compact</span>() <span class="co">#removes all NULL elements</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "tail"

[[2]]
[1] "head"

[[3]]
[1] "head"

[[4]]
[1] "tail"

[[5]]
[1] "head"

[[6]]
[1] "head"

[[7]]
[1] "head"</code></pre>
</div>
</div>
</section>
</section>
<section id="purrrmap" class="level4">
<h4 class="anchored" data-anchor-id="purrrmap">purrr::map()</h4>
<p>Loops are good because they make everything very explicit. However, it is often tedious to type. The <code>purrr</code> package provides functions which enable you to iterate over vectors, data frames/tibbles, and lists. Apart from that, it has a lot of functions to work with lists as well. I will only cover the former functions. If you are interested in using <code>purrr</code> for working with lists, check out <a href="https://jennybc.github.io/purrr-tutorial/">this extensive tutorial by Jenny Bryan</a>.</p>
<p>In the beginning of this chapter, I used the <code>walk()</code> function. This function is related to <code>map()</code> as it iterates over a vector and applies a function to its respective elements. The difference is that <code>walk()</code> doesn’t store the results, <code>map()</code> does.</p>
<section id="the-basics" class="level5">
<h5 class="anchored" data-anchor-id="the-basics">The basics</h5>
<p>The structure of the <code>map()</code> function looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(vector or list, <span class="cf">function</span>(, <span class="cf">if</span> you need it, additional arguments of <span class="cf">function</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>map()</code> always returns a list.</p>
<p>If you want the output to be in a different format, there are different, type-specific <code>map()</code> functions.</p>
<ul>
<li><code>map_dfr()</code> returns a data frame – by binding the rows</li>
<li><code>map_dfc()</code> returns a data frame – by binding the columns</li>
<li><code>map_dbl()</code> returns a double vector</li>
<li><code>map_chr()</code> returns a character vector</li>
<li><code>map_lgl()</code> returns a logical vector</li>
</ul>
<p>In the following I will demonstrate the function of <code>map()</code> with a simple example. The basic vector I will map over is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a>example_dbl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">1.3</span>, <span class="fl">1.8</span>, <span class="fl">1.9</span>, <span class="fl">2.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the first example, I just add 10 to the vector. In order to do so, I first need to create a function which adds 10.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>add_10 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(example_dbl, add_10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 11.5

[[2]]
[1] 11.3

[[3]]
[1] 11.8

[[4]]
[1] 11.9

[[5]]
[1] 12.3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(example_dbl, add_10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.5 11.3 11.8 11.9 12.3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(example_dbl, add_10) <span class="co"># does not make sense though</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Automatic coercion from double to character was deprecated in purrr 1.0.0.
ℹ Please use an explicit call to `as.character()` within `map_chr()` instead.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "11.500000" "11.300000" "11.800000" "11.900000" "12.300000"</code></pre>
</div>
</div>
</section>
<section id="anonymous-functions" class="level5">
<h5 class="anchored" data-anchor-id="anonymous-functions">Anonymous functions</h5>
<p>In the former example, I did specify the function beforehand. <code>map()</code> also allows you to define the function within the call using a so-called anonymous function <code>\(x)</code>. The function’s argument is pre-defined (x in this case, but could be any placeholder) which stands for the respective input.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(example_dbl, \(x){</span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.5 11.3 11.8 11.9 12.3</code></pre>
</div>
</div>
<p>You can also map across tibbles. Here, you iterate over columns. For instance, calculating a mean for each column of the <code>cars_tbl</code> would have looked like this in <code>purrr</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a>cars_tbl <span class="ot">&lt;-</span> mtcars</span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(cars_tbl, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$mpg
[1] 20.09062

$cyl
[1] 6.1875

$disp
[1] 230.7219

$hp
[1] 146.6875

$drat
[1] 3.596563

$wt
[1] 3.21725

$qsec
[1] 17.84875

$vs
[1] 0.4375

$am
[1] 0.40625

$gear
[1] 3.6875

$carb
[1] 2.8125</code></pre>
</div>
</div>
<p>When I put it into a tibble, names are preserved:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dfc</span>(cars_tbl, mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 11
    mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1  20.1  6.19  231.  147.  3.60  3.22  17.8 0.438 0.406  3.69  2.81</code></pre>
</div>
</div>
</section>
<section id="mapping-over-multiple-arguments" class="level5">
<h5 class="anchored" data-anchor-id="mapping-over-multiple-arguments">Mapping over multiple arguments</h5>
<p>Sometimes you want to apply things to multiple arguments. Think for example of the <code>sample()</code>function. It requires at least two arguments: the size of the sample you draw and the element space <code>x</code> you draw the sample from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, sample, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 4

[[2]]
[1]  1 10

[[3]]
[1]  7  6 10

[[4]]
[1] 1 6 6 6

[[5]]
[1] 7 5 5 5 6</code></pre>
</div>
</div>
<p>However, the <code>map2()</code> functions do not provide you with the possibility to control the type of output you get. You can take care of this using <code>flatten_*()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="dv">10</span>, <span class="dv">5</span>, sample) <span class="sc">|&gt;</span> <span class="fu">flatten_dbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6 4 8 3 2</code></pre>
</div>
</div>
<p>If you provide it with a vector which is longer than 1, <code>map2()</code> will not perform the operation on every possible combination of the two vectors. Instead, it iterates over both vectors simultaneously, hence, the first iteration uses the first two values, the second iteration the second two values etc. Also note that it matches the arguments by position, not by name, hence the second argument is the size of the sample, the first one the element space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>), sample) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1]  7  8  4  5 10

[[2]]
[1] 1 3 5</code></pre>
</div>
</div>
<p>If you want to use an anonymous function, you can do so as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map2</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>), <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>), \(x, y) <span class="fu">sample</span>(x, <span class="at">size =</span> y))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 4 8 6 7 2

[[2]]
[1] 5 1 3</code></pre>
</div>
</div>
<p>If you want to map over more than two arguments, <code>pmap()</code> is the way to go. If you work with functions which need multiple values as arguments, you can store the vectors containing the respective values in a tibble. You should name the columns according to the function’s arguments.</p>
<p>An example here is drawing numbers from a normal distribution – <code>rnorm()</code>. The function takes three arguments: <code>n</code>– the number of values to be drawn, <code>mean</code>, and <code>sd</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fl">0.5</span></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(rnorm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] 0.2762588 1.2662280 0.4966849 1.3585467 0.7492659 0.7907689 0.3105248
 [8] 1.1213886 1.4226768 0.1782507

[[2]]
 [1] 2.509489 2.476223 2.410380 2.813266 2.116919 2.392606 1.324271 1.782913
 [9] 1.659243 2.718527

[[3]]
 [1] 3.433201 2.123642 2.645378 3.158825 3.418090 4.271263 3.200257 3.017893
 [9] 3.141365 2.606872

[[4]]
 [1] 3.914835 4.595926 4.682905 3.619700 3.513134 4.954899 3.123541 4.477846
 [9] 5.167031 4.550836

[[5]]
 [1] 5.545990 5.142692 4.220136 5.427874 5.213967 4.856378 4.899412 5.450255
 [9] 3.873000 4.740156

[[6]]
 [1] 5.818541 6.971764 6.147575 6.582609 6.121836 6.226723 6.257705 5.418025
 [9] 5.531128 6.076174

[[7]]
 [1] 6.859280 6.594688 6.866800 7.426123 6.291120 6.845510 7.212836 6.980094
 [9] 6.177029 7.468289

[[8]]
 [1] 8.743606 8.803838 8.125447 8.136227 8.075560 8.486074 8.504599 7.792865
 [9] 7.557125 8.727168

[[9]]
 [1] 8.815799 9.599489 9.429286 9.243450 8.937363 9.010900 8.082863 9.765383
 [9] 9.820104 8.174236

[[10]]
 [1] 10.015095  9.715463 10.305483 10.754284  9.661376 10.500636 10.617799
 [8] 10.823392  9.387472  9.728401</code></pre>
</div>
</div>
<p>If you want to use an anonymous function, you can do so as well:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span>,</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sd =</span> <span class="fl">0.5</span></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(\(n, mean, sd) <span class="fu">rnorm</span>(n, mean, sd))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
 [1] 0.7772323 0.0416125 0.9735931 0.9834894 1.0114624 0.3249466 1.0569058
 [8] 1.3214937 1.1249126 0.9573270

[[2]]
 [1] 1.4034810 2.1781413 2.0860438 2.9868643 1.4047264 1.5553486 1.5861139
 [8] 1.3575352 1.3621371 0.7242431

[[3]]
 [1] 4.093959 2.798665 4.107978 1.874788 3.051627 3.409510 3.433766 3.728983
 [9] 2.355771 2.556102

[[4]]
 [1] 2.433150 4.199967 4.212392 4.328054 4.488375 4.602977 4.691167 4.146277
 [9] 4.189498 4.097553

[[5]]
 [1] 5.140349 5.092283 4.738515 5.529182 4.269838 5.013457 4.620869 4.823738
 [9] 4.207710 4.723280

[[6]]
 [1] 6.245906 5.058408 5.516441 5.472807 6.025419 5.685291 6.462158 6.550718
 [9] 6.566605 5.717003

[[7]]
 [1] 7.087744 6.923719 6.899486 6.571321 7.224902 6.843166 7.430276 6.926348
 [9] 6.838748 6.860724

[[8]]
 [1] 8.402492 7.871721 7.946986 8.426621 8.797195 8.227491 7.582142 8.157361
 [9] 8.107146 7.558428

[[9]]
 [1] 9.694184 9.786892 9.286632 9.995288 8.535659 9.185741 8.114063 9.860151
 [9] 8.876233 8.891865

[[10]]
 [1] 10.696122 11.047684 10.039567 10.655035  9.739268  9.559926  9.317054
 [8] 10.097944  9.665217 10.051768</code></pre>
</div>
</div>
</section>
<section id="speeding-up-with-furrr" class="level5">
<h5 class="anchored" data-anchor-id="speeding-up-with-furrr">Speeding up with <code>furrr</code></h5>
<p>If you work with large data sets or have to perform a lot of iterations, you might want to speed up your code. The <code>furrr</code> package provides the same functionality as <code>purrr</code>, but allows for parallelization. This means that it can split up the tasks and distribute them across multiple CPU cores.</p>
<p>Its functionalities are the same as in <code>purrr</code>, just with a <code>future_</code> prefix. In order to use it, you need to set up a plan first. Here, I use <code>multisession</code>, which works on all platforms (Windows, Mac, Linux). If you work on a Linux machine, you can also use <code>multicore</code>, which is faster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb270"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(furrr)</span>
<span id="cb270-2"><a href="#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession) <span class="co">#set up parallelization</span></span>
<span id="cb270-3"><a href="#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">future_map_dbl</span>(example_dbl, add_10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.5 11.3 11.8 11.9 12.3</code></pre>
</div>
</div>
<p>Note that speed benefits are not apparent when working with small data sets or few iterations. The overhead of setting up parallel processes can outweigh the benefits. However, if you work with large data sets or have to perform a lot of iterations, you will see a speed increase.</p>
<p>Let’s make <code>add_10</code> slow and benchmark <code>furrr</code> and <code>purrr</code> using the <code>tictoc</code> package. I have set the sleep time to 0.5 seconds to make the difference more apparent. My laptop has 8 cores, hence I create 24 tasks which will be distributed across the 8 workers (3 tasks per worker).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb272"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">needs</span>(tictoc)</span>
<span id="cb272-2"><a href="#cb272-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-3"><a href="#cb272-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create more tasks than workers</span></span>
<span id="cb272-4"><a href="#cb272-4" aria-hidden="true" tabindex="-1"></a>example_long <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span> </span>
<span id="cb272-5"><a href="#cb272-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-6"><a href="#cb272-6" aria-hidden="true" tabindex="-1"></a>add_10_slow <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb272-7"><a href="#cb272-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="fl">0.5</span>)  <span class="co"># Shorter sleep time</span></span>
<span id="cb272-8"><a href="#cb272-8" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> <span class="dv">10</span></span>
<span id="cb272-9"><a href="#cb272-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb272-10"><a href="#cb272-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-11"><a href="#cb272-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Sequential version</span></span>
<span id="cb272-12"><a href="#cb272-12" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">"Sequential (purrr)"</span>)</span>
<span id="cb272-13"><a href="#cb272-13" aria-hidden="true" tabindex="-1"></a>result_seq <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(example_long, add_10_slow)</span>
<span id="cb272-14"><a href="#cb272-14" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sequential (purrr): 12.084 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parallel version</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tic</span>(<span class="st">"Parallel (furrr)"</span>)</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a>result_par <span class="ot">&lt;-</span> <span class="fu">future_map_dbl</span>(example_long, add_10_slow)</span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel (furrr): 2.993 sec elapsed</code></pre>
</div>
</div>
<p>You can see that the parallel version is much faster than the sequential one. However, the speed increase is not linear. This is due to the overhead of setting up parallel processes. Setting up worker processes, transferring data between them, and collecting results all take time. With my 0.5 second tasks, this overhead becomes a significant fraction of the total runtime. Also, following Amdahl’s Law, not everything can be parallelized. Some parts like initial setup and final result collection must run sequentially. This creates a fundamental limit on speedup. Finally, there are system constraints, as my CPU shares resources with other processes, memory bandwidth can become a bottleneck, and modern CPUs can’t maintain peak single-core performance across all cores simultaneously.</p>
<p>So, when should we use <code>furrr</code>?</p>
<ul>
<li>When you have a large number of tasks that can be executed independently.</li>
<li>When each task takes a significant amount of time to complete.</li>
<li>When you have access to a multi-core machine.</li>
</ul>
<p>When should we avoid <code>furrr</code>?</p>
<ul>
<li>When tasks are very quick to execute (the overhead of parallelization may outweigh the benefits).</li>
<li>When tasks depend on each other (parallelization won’t help).</li>
<li>When working in an environment where parallel processing is restricted (e.g., some cloud services or shared servers).</li>
<li>When debugging (parallel code can be harder to debug).</li>
</ul>
</section>
</section>
<section id="further-links-4" class="level4">
<h4 class="anchored" data-anchor-id="further-links-4">Further links</h4>
<ul>
<li><a href="https://rstudio-education.github.io/hopr/loops.html#for-loops">Chapter about loops in Hands-on Programming with R</a></li>
<li>On <a href="https://resbaz.github.io/2014-r-materials/lessons/30-control-flow/">control flow</a></li>
<li>A <a href="http://www.rebeccabarter.com/blog/2019-08-19_purrr/">basic introduction to <code>purrr::map</code></a></li>
<li>The <a href="https://r4ds.had.co.nz/iteration.html#introduction-14">corresponding chapter in R4DS</a></li>
</ul>



</section>
</section>
</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-henry_purrr_2020" class="csl-entry" role="listitem">
Henry, Lionel and Hadley Wickham. 2020. <span>“Purrr: <span>Functional Programming Tools</span>.”</span>
</div>
<div id="ref-hester_fs_2021" class="csl-entry" role="listitem">
Hester, Jim, Hadley Wickham, and Gábor Csárdi. 2021. <span>“Fs: <span>Cross-Platform File System Operations Based</span> on ’Libuv’.”</span>
</div>
<div id="ref-muller_tibble_2020" class="csl-entry" role="listitem">
Müller, Kirill, Hadley Wickham, and Romain François. 2020. <span>“Tibble: <span>Simple Data Frames</span>.”</span>
</div>
<div id="ref-wickham_layered_2010" class="csl-entry" role="listitem">
Wickham, Hadley. 2010. <span>“<a href="https://doi.org/10.1198/jcgs.2009.07098">A <span>Layered Grammar</span> of <span>Graphics</span></a>.”</span> <em>Journal of Computational and Graphical Statistics</em> 19(1):3–28.
</div>
<div id="ref-wickham_tidy_2014" class="csl-entry" role="listitem">
Wickham, Hadley. 2014. <span>“<a href="https://doi.org/10.18637/jss.v059.i10">Tidy <span>Data</span></a>.”</span> <em>Journal of Statistical Software</em> 59(10).
</div>
<div id="ref-wickham_dplyr_2020" class="csl-entry" role="listitem">
Wickham, Hadley. 2020a. <span>“Dplyr: <span>A Grammar</span> of <span>Data Manipulation</span>.”</span>
</div>
<div id="ref-wickham_tidyr_2020" class="csl-entry" role="listitem">
Wickham, Hadley. 2020b. <span>“Tidyr: <span>Tidy Messy Data</span>.”</span>
</div>
<div id="ref-wickham_welcome_2019" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy McGowan, Romain François, Garrett Grolemund, Alex Hayes, Lionel Henry, Jim Hester, Max Kuhn, Thomas Pedersen, Evan Miller, Stephan Bache, Kirill Müller, Jeroen Ooms, David Robinson, Dana Seidel, Vitalie Spinu, Kohske Takahashi, Davis Vaughan, Claus Wilke, Kara Woo, and Hiroaki Yutani. 2019. <span>“<a href="https://doi.org/10.21105/joss.01686">Welcome to the <span>Tidyverse</span></a>.”</span> <em>Journal of Open Source Software</em> 4(43):1686.
</div>
<div id="ref-wickham_data_2016" class="csl-entry" role="listitem">
Wickham, Hadley and Garrett Grolemund. 2016. <em>R for Data Science: Import, Tidy, Transform, Visualize, and Model Data</em>. First edition. Sebastopol, CA: O’Reilly.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>This becomes especially painful if you teach R to your students and have to grade 20 submissions and, hence, have to paste your personal directory’s file path into each of these submissions.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>which can be found <a href="https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html">here</a> or using <code>vignette("tidy-data", package = "tidyr")</code><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>If you want to run the code on your machine, download the files behind the following links and store them in a folder called <code>socviz_us</code> which is again stored in a folder named <code>data</code> which lives in the same folder as the .qmd file.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>I have taken this example from the R for Data Science book. I hardly ever work with <code>while loops</code>. The only use case from my day-to-day work is web-scraping, where I want to loop over pages until a certain threshold is reached. Therefore, I could not really come up with an example myself.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/fellennert\.github\.io\/toolbox_css\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025, Felix Lennert (<a href="mailto:felix.lennert@uni-leipzig.de">felix.lennert@uni-leipzig.de</a>)</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>